"use strict";"undefined"==typeof O&&(window.O={}),function(t){var e=function(t){this.object=t,this.dependents={},this.allDependents={},this.cache={},this.observers={},this.changed=null,this.depth=0,this.pathObservers={},this.bindings={},this.inits={},this.isInitialised=!1,t.__meta__=this},i=t.meta=function(t){var i=t.__meta__;return i?i.object!==t&&(i=Object.create(i),i.object=t,i.cache={},i.observers=Object.create(i.observers),i.changed=null,i.depth=0,i.bindings=Object.create(i.bindings),i.inits=Object.create(i.inits),t.__meta__=i):i=new e(t),i},n=0;t.guid=function(t){if(null===t)return"null";switch(typeof t){case"boolean":return t?"true":"false";case"number":return"num:"+t.toString(36);case"string":return"str:"+t;case"undefined":return"undefined"}return t instanceof Date?"date:"+ +t:t.__guid__||(t.__guid__="id:"+(n+=1).toString(36))};var s=t.mixin=function(t,e,n){if(e){var s,r,o,a,h=!n;for(s in e)"__meta__"===s||!h&&t.hasOwnProperty(s)||(r=t[s],o=e[s],r&&r.__teardownProperty__&&(a||(a=i(t)),r.__teardownProperty__(a,s,t)),o&&o.__setupProperty__&&(a||(a=i(t)),o.__setupProperty__(a,s,t)),t[s]=o)}return t},r=t.extend=function(t,e,i){for(var n in e)!e.hasOwnProperty(n)||i&&t.hasOwnProperty(n)||(t[n]=e[n]);return t},o=t.merge=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t.hasOwnProperty(i)&&t[i]&&e[i]&&"object"==typeof t[i]&&"object"==typeof e[i]?o(t[i],e[i]):t[i]=e[i]);return t},a=t.clone=function(t){var e,i,n=t;if(t&&"object"==typeof t)if(t instanceof Array)for(n=[],e=t.length;e--;)n[e]=a(t[e]);else if(t instanceof Date)n=new Date(t);else{n={};for(i in t)n[i]=a(t[i])}return n},h=t.isEqual=function(t,e){var i,n,s,r;if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){if(!(t instanceof Array)){if(t instanceof Date)return+t===+e;if(r=t.constructor,t.constructor!==e.constructor)return!1;if(r.isEqual)return r.isEqual(t,e);for(s in t)if(!h(t[s],e[s]))return!1;for(s in e)if(!h(t[s],e[s]))return!1;return!0}if(e instanceof Array&&t.length===e.length){for(i=0,n=t.length;n>i;i+=1)if(!h(t[i],e[i]))return!1;return!0}}return!1};t.Class=function(t){var e,i,n,s=t.Extends,r=t.Mixin,o=t.init||(s?function(){s.apply(this,arguments)}:function(){});if(s&&(e=s.prototype,o.parent=e,o.prototype=Object.create(e),o.prototype.constructor=o,delete t.Extends),r){for(r instanceof Array||(r=[r]),i=0,n=r.length;n>i;i+=1)o.implement(r[i],!0);delete t.Mixin}return o.implement(t,!0),o};var c=/^\d+$/;t.sortByProperties=function(e){e instanceof Array||(e=[e]);var i=e.length;return function(n,s){var r,o,a,h,u,l=!!n.get;for(r=0;i>r;r+=1)if(o=e[r],a=l?n.get(o):n[o],h=l?s.get(o):s[o],u=typeof a,u===typeof h){if("boolean"===u&&a!==h)return a?-1:1;if("string"===u)if(c.test(a)&&c.test(h))a=+a,h=+h;else if(t.i18n)return t.i18n.compare(a,h);if(h>a)return-1;if(a>h)return 1}return 0}},Function.prototype.implement=function(t,e){return s(this.prototype,t,!e),this},Function.prototype.extend=function(t,e){return r(this,t,!e),this}}(O),Array.implement({get:function(t){return this[t]},set:function(t,e){return this[t]=e,this},getObjectAt:function(t){return this[t]},setObjectAt:function(t,e){return this[t]=e,this},include:function(t){for(var e=0,i=this.length;i>e&&this[e]!==t;)e+=1;return this[e]=t,this},erase:function(t){for(var e=this.length;e--;)this[e]===t&&this.splice(e,1);return this}}),function(t){var e=function(t){return t%4===0&&t%100!==0||t%400===0},i=[31,28,31,30,31,30,31,31,30,31,30,31],n=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:Z|(?:([+\-])(\d{2})(?::(\d{2}))?)?)?)?$/;Date.extend({fromJSON:function(t){var e=t?n.exec(t):null;return e?new Date(Date.UTC(+e[1]||0,(+e[2]||1)-1,+e[3]||1,+e[4]||0,+e[5]||0,+e[6]||0,+e[7]||0)+(e[8]?6e4*("+"===e[8]?-1:1)*(60*(+e[9]||0)+(+e[10]||0)):0)):null},getDaysInMonth:function(t,n){return 1===t&&e(n)?29:i[t]},getDaysInYear:function(t){return e(t)?366:365},isLeapYear:e});var s=function(t,e,i){return e||t>9?t:(i||"0")+t},r=864e5,o={second:1e3,minute:6e4,hour:36e5,day:r,week:6048e5};Date.implement({isToday:function(t){var e=new Date,i=e.getDate(),n=e.getMonth(),s=e.getFullYear();return t?this.getUTCFullYear()===s&&this.getUTCMonth()===n&&this.getUTCDate()===i:this.getFullYear()===s&&this.getMonth()===n&&this.getDate()===i},isOnSameDayAs:function(t,e){return e?t.getUTCFullYear()===this.getUTCFullYear()&&t.getUTCMonth()===this.getUTCMonth()&&t.getUTCDate()===this.getUTCDate():t.getFullYear()===this.getFullYear()&&t.getMonth()===this.getMonth()&&t.getDate()===this.getDate()},getDayName:function(e,i){var n=t.i18n&&t.i18n.get((e?"abbreviatedD":"d")+"ayNames"),s=i?this.getUTCDay():this.getDay();return n?n[s]:s},getMonthName:function(e,i){var n=t.i18n&&t.i18n.get((e?"abbreviatedM":"m")+"onthNames"),s=i?this.getUTCMonth():this.getMonth();return n?n[s]:s},getDayOfYear:function(t){var e=t?Date.UTC(this.getUTCFullYear(),0,1):+new Date(this.getFullYear(),0,1);return~~((this.getTime()-e)/r)+1},getWeekNumber:function(t,e){var i=e?this.getUTCDay():this.getDay(),n=this.getDayOfYear(e)-1,s=((t||0)-i).mod(7)||7;return Math.floor((n+s)/7)},getISOWeekNumber:function(t,e){null==t&&(t=1);var i,n,s=e?new Date(Date.UTC(this.getUTCFullYear(),0,4)):new Date(this.getFullYear(),0,4),o=e?s.getUTCDay():s.getDay(),a=s-(o-t).mod(7)*r,h=Math.floor((this-a)/6048e5)+1;return 53===h&&(i=e?this.getUTCDate():this.getDate(),n=e?this.getUTCDay():this.getDay(),i-(n-t).mod(7)>28&&(h=1)),h||new Date((e?this.getUTCFullYear():this.getFullYear())-1,11,31,12).getISOWeekNumber(t,!1)},add:function(t,e){return"year"===e?this.setFullYear(this.getFullYear()+t):"month"===e?this.setMonth(this.getMonth()+t):this.setTime(this.getTime()+t*(o[e||"day"]||0)),this},subtract:function(t,e){return this.add(-t,e)},format:function(e,i){var n=this;return e?e.replace(/%(\-)?([%A-Za-z])/g,function(e,r,o){var a,h;switch(o){case"a":return n.getDayName(!0,i);case"A":return n.getDayName(!1,i);case"b":return n.getMonthName(!0,i);case"B":return n.getMonthName(!1,i);case"c":return t.i18n?t.i18n.date(n,"fullDateAndTime"):n.toLocaleString();case"C":return s(~~((i?n.getUTCFullYear():n.getFullYear())/100),r);case"d":return s(i?n.getUTCDate():n.getDate(),r);case"D":return n.format("%m/%d/%y",i);case"e":return s(i?n.getUTCDate():n.getDate(),r," ");case"h":return n.getMonthName(!0,i);case"H":return s(i?n.getUTCHours():n.getHours(),r);case"I":return a=i?n.getUTCHours():n.getHours(),a?s(13>a?a:a-12,r):12;case"j":return a=n.getDayOfYear(i),r?a:100>a?"0"+s(a):s(a);case"m":return s((i?n.getUTCMonth():n.getMonth())+1,r);case"M":return s(i?n.getUTCMinutes():n.getMinutes(),r);case"n":return"\n";case"p":return h=(i?n.getUTCHours():n.getHours())<12?"am":"pm",t.i18n?t.i18n.get(h+"Designator"):h.toUpperCase();case"r":return n.format("%I:%M:%S %p",i);case"R":return n.format("%H:%M",i);case"S":return s(i?n.getUTCSeconds():n.getSeconds(),r);case"t":return"	";case"T":return n.format("%H:%M:%S",i);case"u":return(i?n.getUTCDay():n.getDay())||7;case"U":return s(this.getWeekNumber(0,i),r);case"V":return s(this.getISOWeekNumber(1,i),r);case"w":return i?n.getUTCDay():n.getDay();case"W":return s(this.getWeekNumber(1,i),r);case"x":return t.i18n?t.i18n.date(n,"date"):n.format("%d/%m/%y",i);case"X":return t.i18n?t.i18n.date(n,"time"):n.format("%H:%M",i);case"y":return(i?n.getUTCFullYear():n.getFullYear()).toString().slice(2);case"Y":return i?n.getUTCFullYear():n.getFullYear();case"Z":return(/\((.*)\)/.exec(n.toString())||[""]).pop();case"%":return o;default:return e}}):this.toString()}})}(O),Number.implement({limit:function(t,e){return t>this?t:this>e?e:this+0},mod:function(t){var e=this%t;return 0>e?e+t:e}}),function(){Object.extend({values:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return e},keyOf:function(t,e){for(var i in t)if(t[i]===e)return i},filter:function(t,e){var i,n={};for(i in t)e[i]&&(n[i]=t[i]);return n},zip:function(t,e){for(var i=Math.min(t.length,e.length),n={};i--;)n[t[i]]=e[i];return n},fromQueryString:function(t){var e={};return t.split("&").forEach(function(t){var i=t.split("=").map(decodeURIComponent);e[i[0]]=i[1]}),e}})}(),RegExp.email=/\b([\w\-.%+]+@(?:[\w\-]+\.)+[A-Z]{2,})\b/i,RegExp.url=/\b(?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’])/i,function(t){var e=/%(\+)?(?:'(.))?(-)?(\d+)?(?:\.(\d+))?(?:\$(\d+))?([%sn@])/g;String.implement({format:function(){e.lastIndex=0;for(var i,n,s,r,o,a,h="",c=0,u=1;i=e.exec(this);){switch(h+=this.slice(c,i.index),c=i.index+i[0].length,n=arguments[(parseInt(i[6],10)||u)-1],i[7]){case"%":h+="%";continue;case"s":s=n;break;case"n":s=i[1]&&n>=0?"+":"",s+=i[5]!==t?n.toFixed(i[5]):n+"";break;case"@":s=n.toString()}if(r=(i[4]||0)-s.length,r>0){for(o=i[2]||" ",a=o;r-=1;)a+=o;i[3]?s+=a:s=a+s}h+=s,u+=1}return h+=this.slice(c)},repeat:function(t){for(var e=this,i="";t;)t%2===1&&(i+=e),t>1&&(e+=e),t>>=1;return i},escapeHTML:function(){return this.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")},escapeRegExp:function(){return this.replace(/([\-.*+?\^${}()|\[\]\/\\])/g,"\\$1")},capitalise:function(){return this.charAt(0).toUpperCase()+this.slice(1)},camelCase:function(){return this.replace(/\-([a-z])/g,function(t,e){return e.toUpperCase()})},hyphenate:function(){return this.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})},contains:function(t,e){return(e?(e+this+e).indexOf(e+t+e):this.indexOf(t))>-1},hash:function(){for(var t=this.length,e=1&t,i=t-e,n=0;i>n;n+=2)t+=this.charCodeAt(n),t=t<<16^(this.charCodeAt(n+1)<<11^t),t+=t>>11;return e&&(t+=this.charCodeAt(i),t^=t<<11,t+=t>>17),t^=t<<3,t+=t>>5,t^=t<<4,t+=t>>17,t^=t<<25,t+=t>>6},md5:function(){var t=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],e=[3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745],i=function(t){var e,i,n,s="";for(e=0,i=t.length;i>e;e+=1)n=t.charCodeAt(e),128>n?s+=t.charAt(e):2048>n?(s+=String.fromCharCode(n>>6|192),s+=String.fromCharCode(63&n|128)):(s+=String.fromCharCode(n>>12|224),s+=String.fromCharCode(n>>6&63|128),s+=String.fromCharCode(63&n|128));return s},n=function(t){var e,i,n,s,r=t.length,o=[0];for(e=0,i=0,n=0;r>i;i+=1)o[e]|=t.charCodeAt(i)<<n,n+=8,32===n&&(n=0,o[e+=1]=0);for(o[e]|=128<<n,e+=1,s=e+16-((e+2)%16||16);s>e;e+=1)o[e]=0;return o[e]=r<<3,o[e+1]=r>>>29,o},s=function(t,e){var i=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(i>>16);return n<<16|65535&i},r=function(t,e){return t<<e|t>>>32-e},o="0123456789abcdef",a=function(t){var e,i="";for(e=0;32>e;e+=8)i+=o[t>>e+4&15],i+=o[t>>e&15];return i};return function(){var o,h,c,u,l,d,f,g,p,v,m=n(i(this)),y=1732584193,w=4023233417,_=2562383102,b=271733878;for(h=0,c=m.length;c>h;h+=16){for(u=y,l=w,d=_,f=b,o=0;64>o;o+=1)16>o?(g=l&d|~l&f,p=o):32>o?(g=f&l|~f&d,p=(5*o+1)%16):48>o?(g=l^d^f,p=(3*o+5)%16):(g=d^(l|~f),p=7*o%16),v=f,f=d,d=l,l=s(l,r(s(u,s(g,s(e[o],m[h+p]))),t[o])),u=v;y=s(y,u),w=s(w,l),_=s(_,d),b=s(b,f)}return a(y)+a(w)+a(_)+a(b)}}()})}(),function(t,e){var i=Array.prototype.slice,n=t.meta,s=function(t){return function(){this.computedPropertyDidChange(t)}},r=function(e,i,n){var r,o,a,h,c,u=this.dependencies,l=e.dependents;for(e.hasOwnProperty("dependents")||(l=e.dependents=t.clone(l),e.allDependents={}),r=u.length;r--;)o=u[r],-1===o.indexOf(".")?(l[o]||(l[o]=[])).push(i):(a||(a="__"+i+"DidChange__",e.inits.Observers=(e.inits.Observers||0)+1),n[a]||(n[a]=s(i)),h||(h=e.pathObservers,e.hasOwnProperty("pathObservers")||(h=e.pathObservers=Object.create(h)),c=h[a],c?h.hasOwnProperty(a)||(c=h[a]=c.slice()):c=h[a]=[]),c.push(o))},o=function(e,i){var n,s,r,o,a,h=this.dependencies,c=e.dependents;for(e.hasOwnProperty("dependents")||(c=e.dependents=t.clone(c),e.allDependents={}),n=h.length;n--;)s=h[n],-1===s.indexOf(".")?c[s].erase(i):(r||(r="__"+i+"DidChange__",e.inits.Observers-=1),o||(o=e.pathObservers,e.hasOwnProperty("pathObservers")||(o=e.pathObservers=Object.create(o)),a=o[r],o.hasOwnProperty(r)||(a=o[r]=a.slice())),a.erase(s))};Function.implement({property:function(){return this.isProperty=!0,arguments.length&&(this.dependencies=i.call(arguments),this.__setupProperty__=r,this.__teardownProperty__=o),this},nocache:function(){return this.isVolatile=!0,this},doNotNotify:function(){return this.isSilent=!0,this}});var a=/^\d+$/,h=t.getFromPath=function(t,i){for(var n,s,r=0,o=i.length;o>r;){if(!t)return e;n=i.indexOf(".",r),-1===n&&(n=o),s=i.slice(r,n),t=t.getObjectAt&&a.test(s)?t.getObjectAt(+s):t.get?t.get(s):t[s],r=n+1}return t},c=function(t,e,i){var n=t[e];if(n)for(var s=n.length;s--;){var r=n[s];-1===i.indexOf(r)&&(i.push(r),c(t,r,i))}return i};t.ComputedProps={propertiesDependentOnKey:function(t){var e=n(this);return e.allDependents[t]||(e.allDependents[t]=c(e.dependents,t,[]))},propertyDidChange:function(t){for(var e=this.propertiesDependentOnKey(t),i=e.length,s=n(this).cache;i--;)delete s[e[i]];return this},computedPropertyDidChange:function(t){var e=n(this).cache,i=e[t];return delete e[t],this.propertyDidChange(t,i)},clearPropertyCache:function(){return n(this).cache={},this},set:function(t,i){var s,r,o=this[t];return o&&o.isProperty?(s=!!o.isSilent,i=o.call(this,i,t),o.isVolatile?o=e:(r=n(this).cache,o=r[t],r[t]=i)):(s=o===i,this[t]=i),s?this:this.propertyDidChange(t,o,i)},get:function(t){var i,s=this[t];return s&&s.isProperty?s.isVolatile?s.call(this,e,t):(i=n(this).cache,t in i?i[t]:i[t]=s.call(this,e,t)):s},getFromPath:function(t){return h(this,t)},increment:function(t,e){return this.set(t,this.get(t)+e)},toggle:function(t){return this.set(t,!this.get(t))}}}(O),function(t,e,i){var n=function(e,i,n,s){var r=s.lastIndexOf("*")+1,o=s.slice(r),a=r?s.slice(0,r-1):"",h=o.lastIndexOf(".");e[i+"Object"]=a?t.getFromPath(n,a):n,e[i+"Path"]=o,e[i+"PathBeforeKey"]=-1===h?"":o.slice(0,h),e[i+"Key"]=o.slice(h+1)},s=/^\d+$/,r=function(t){return t},o=t.Class({__setupProperty__:function(t,e){t.bindings[e]=this,t.inits.Bindings=(t.inits.Bindings||0)+1},__teardownProperty__:function(t,e){t.bindings[e]=null,t.inits.Bindings-=1},init:function(t){this.isConnected=!1,this.isSuspended=!0,this.isNotInSync=!0,this.willSyncForward=!0,this._fromPath=null,this._fromRoot=null,this._toPath=null,this._toRoot=null,this.fromObject=null,this.fromPath="",this.fromPathBeforeKey="",this.fromKey="",this.toObject=null,this.toPath="",this.toPathBeforeKey="",this.toKey="",this.isTwoWay=!1,this.transform=r,this.queue="bindings";for(var e in t)this[e]=t[e]},destroy:function(){this.disconnect(),this.isConnected=!0},from:function(t,e){var i="string"==typeof t;return this._fromRoot=i?e:t,this._fromPath=i?t:e,this},to:function(t,e){var i="string"==typeof t;return this._toRoot=i?e:t,this._toPath=i?t:e,this},_doNotDelayConnection:!1,connect:function(){if(this.isConnected)return this;this.isSuspended=!1,n(this,"from",this._fromRoot||this._toRoot,this._fromPath),n(this,"to",this._toRoot||this._fromRoot,this._toPath);var i=this.fromObject,s=this.toObject;return s instanceof e&&(this.queue="render"),this._doNotDelayConnection||i&&s?(i.addObserverForPath(this.fromPath,this,"fromDidChange"),this.sync(),this.isTwoWay&&s.addObserverForPath(this.toPath,this,"toDidChange"),this.isConnected=!0,this):(this._doNotDelayConnection=!0,t.RunLoop.queueFn("before",this.connect,this),this)},disconnect:function(){return this.isConnected?(this.fromObject.removeObserverForPath(this.fromPath,this,"fromDidChange"),this.isTwoWay&&this.toObject.removeObserverForPath(this.toPath,this,"toDidChange"),this.isConnected=!1,this.isSuspended=!0,this.isNotInSync=!0,this.willSyncForward=!0,this):this},suspend:function(){return this.isSuspended=!0,this},resume:function(){return this.isSuspended&&this.isConnected&&(this.isSuspended=!1,this.sync()),this},fromDidChange:function(){return this.needsSync(!0)},toDidChange:function(){return this.needsSync(!1)},needsSync:function(e){var i=this.queue,n=this.isNotInSync;return this.willSyncForward=e,this.isNotInSync=!0,n||this.isSuspended||(i?t.RunLoop.queueFn(i,this.sync,this,!0):this.sync()),this},sync:function(t){if(!t&&(!this.isNotInSync||this.isSuspended))return!1;this.isNotInSync=!1;var e,n,r=this.willSyncForward,o=r?"from":"to",a=r?"to":"from",h=this[a+"PathBeforeKey"],c=this[a+"Object"];return h&&(c=c.getFromPath(h)),c?(e=this[a+"Key"],n=this.transform.call(this,this[o+"Object"].getFromPath(this[o+"Path"]),r),n!==i&&(s.test(e)?c.setObjectAt(+e,n):c.set(e,n)),!0):!1}});t.Binding=o;var a=t.bind=function(t,e,i){var n=(new o).from(t,e);return i&&(n.transform=i),n};t.bindTwoWay=function(t,e,i){var n=a(t,e,i);return n.isTwoWay=!0,n}}(O,void 0!==typeof Element?Element:function(){}),function(t,e){var i=t.meta,n="__binding__";t.BoundProps={initBindings:function(){var t,n,s=i(this).bindings;for(t in s)(n=s[t])&&(s.hasOwnProperty(t)||(n=s[t]=Object.create(n)),this[t]=e,n.to(t,this).connect());return this},destroyBindings:function(){var t,e,n=i(this).bindings;for(t in n)(e=n[t])&&e.destroy();return this},registerBinding:function(e){return i(this).bindings[n+t.guid(e)]=e,this},deregisterBinding:function(t){var e=i(this).bindings,n=Object.keyOf(e,t);return delete e[n],this},suspendBindings:function(){var t,e,n=i(this).bindings;for(t in n)(e=n[t])&&e.suspend();return this},resumeBindings:function(){var t,e,n=i(this).bindings;for(t in n)(e=n[t])&&e.resume();return this}}}(O),function(t){var e=function(t,e){return e>t?-1:t>e?1:0},i=function(t,e){return e?function(i,n,s){return t.call(e,i,n,s)}:t},n={first:function(){return this.getObjectAt(0)},last:function(){return this.getObjectAt(this.get("length")-1)},indexOf:function(t,e){var i=this.get("length");for(e=0>e?Math.max(0,i+e):e||0;i>e;e+=1)if(this.getObjectAt(e)===t)return e;return-1},lastIndexOf:function(t,e){var i=this.get("length");for(e=0>e?i+e:e||i-1;e>=0;e-=1)if(this.getObjectAt(e)===t)return e;return-1},binarySearch:function(t,i){var n,s,r=0,o=this.get("length");for(i||(i=e);o>r;)n=r+o>>1,s=this.getObjectAt(n),i(s,t)<0?r=n+1:o=n;return r},contains:function(t){return this.indexOf(t)>-1},find:function(t,e){for(var n=i(t,e),s=0,r=this.get("length");r>s;s+=1){var o=this.getObjectAt(s);if(n(o,s,this))return o}return null},forEach:function(t,e){for(var n=i(t,e),s=0,r=this.get("length");r>s;s+=1)n(this.getObjectAt(s),s,this);return this},filter:function(t,e){for(var n=i(t,e),s=[],r=0,o=this.get("length");o>r;r+=1){var a=this.getObjectAt(r);n(a,r,this)&&s.push(a)}return s},map:function(t,e){for(var n=i(t,e),s=[],r=0,o=this.get("length");o>r;r+=1)s[r]=n(this.getObjectAt(r),r,this);return s},reduce:function(t,e){var i,n=0,s=this.get("length");if(!s&&1===arguments.length)throw new TypeError;for(arguments.length>=2?i=e:(i=this.getObjectAt(0),n=1);s>n;n+=1)i=t(i,this.getObjectAt(n),n,this);return i},every:function(t,e){for(var n=i(t,e),s=0,r=this.get("length");r>s;s+=1)if(!n(this.getObjectAt(s),s,this))return!1;return!0},some:function(t,e){for(var n=i(t,e),s=0,r=this.get("length");r>s;s+=1)if(n(this.getObjectAt(s),s,this))return!0;return!1}};Array.implement(n),t.Enumerable=n}(O),function(t){var e=t.meta,i=Array.prototype.slice,n="__event__",s=Object.prototype.toString;Function.implement({on:function(){return this.observes.apply(this,i.call(arguments).map(function(t){return n+t}))}});var r=t.Class({init:function(e,i,n){this.type=e,this.target=i,this.defaultPrevented=!1,this.propagationStopped=!1,t.extend(this,n)},preventDefault:function(){return this.defaultPrevented=!0,this},stopPropagation:function(){return this.propagationStopped=!0,this}});t.Event=r,t.EventTarget={nextEventTarget:null,on:function(t,i,s){i instanceof Function||(i={object:i,method:s}),t=n+t;var r=e(this).observers,o=r[t];return r.hasOwnProperty(t)||(o=r[t]=o?o.slice():[]),o.push(i),this},once:function(t,e){var i=function(n){e.call(this,n),this.off(t,i)};return this.on(t,i),this},fire:function(i,o){var a,h,c,u=this,l=n+i;for(o&&o instanceof r||(o&&/Event\]$/.test(s.call(o))?o.stopPropagation=function(){return this.propagationStopped=!0,this}:o=new r(i,u,o)),o.propagationStopped=!1;u;){for(h=e(u).observers[l],c=h?h.length:0;c--;)try{a=h[c],a instanceof Function?a.call(u,o):(a.object||u)[a.method](o)}catch(d){t.RunLoop.didError(d)}u=o.propagationStopped?null:u.get?u.get("nextEventTarget"):u.nextEventTarget}return this},off:function(t,i,s){t=n+t;var r=e(this).observers,o=r[t];if(o)if(r.hasOwnProperty(t)||(o=r[t]=o.slice()),i)if(i instanceof Function)o.erase(i);else for(var a=o.length;a--;){var h=o[a];h.object===i&&h.method===s&&o.splice(a,1)}else o.length=0;return this}}}(O),function(t){var e=t.Class({init:function(t){this.data=[],this.length=0,this.comparator=t},_up:function(t){var e,i,n,s=this.data,r=this.comparator;for(i=s[t];t&&(e=t-1>>1,n=s[e],!(r(i,n)>=0));)s[e]=i,s[t]=n,t=e;return t},_down:function(t){var e,i,n,s,r=this.data,o=this.length,a=this.comparator;for(e=r[t];;){if(i=(t<<1)+1,n=i+1,i>=o)break;if(s=r[i],o>n&&a(s,r[n])>0&&(s=r[n],i=n),a(e,s)<=0)break;r[i]=e,r[t]=s,t=i}return t},push:function(t){if(null!=t){var e=this.length;this.data[e]=t,this.length=e+1,this._up(e)}return this},pop:function(){var t,e=this.data,i=this.length;return i?(t=e[0],i-=1,e[0]=e[i],e[i]=null,this.length=i,this._down(0),t):null},peek:function(){return this.data[0]},remove:function(t){var e=this.data,i=this.length,n=null!=t&&i?e.lastIndexOf(t,i-1):-1;return 0>n?this:(i-=1,e[n]=e[i],e[i]=null,this.length=i,n!==i&&this._down(this._up(n)),this)}});t.Heap=e}(O),function(t,e){var i=Array.prototype.slice;t.MutableEnumerable={push:function(){var t=i.call(arguments);return this.replaceObjectsAt(this.get("length"),0,t),this.get("length")},pop:function(){var t=this.get("length");return 0===t?e:this.replaceObjectsAt(t-1,1)[0]},unshift:function(){var t=i.call(arguments);return this.replaceObjectsAt(0,0,t),this.get("length")},shift:function(){return 0===this.get("length")?e:this.replaceObjectsAt(0,1)[0]},splice:function(t,e){var n=i.call(arguments,2);return this.replaceObjectsAt(t,e,n)}}}(O),function(t,e,i){var n=e.requestAnimationFrame||e.oRequestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.msRequestAnimationFrame||function(){var t=0;return function(i){var n=Date.now(),s=Math.max(0,16-(n-t));t=n,e.setTimeout(function(){i(n+s)},s)}}(),s=function(t,e,i,n){this.time=t,this.period=e,this.fn=i,this.bind=n},r={mayRedraw:!1,_queueOrder:["before","bindings","middle","render","after"],_queues:{before:[],bindings:[],middle:[],render:[],after:[],nextLoop:[],nextFrame:[]},_timeouts:new t.Heap(function(t,e){return t.time-e.time}),_nextTimeout:0,_timer:null,_depth:0,flushQueue:function(t){var e,i,n,s,o=this._queues[t],a=o.length;if(a){for(this._queues[t]=[],e=0;a>e;e+=1){i=o[e],n=i[0],s=i[1];try{s?n.call(s):n()}catch(h){r.didError(h)}}return!0}return!1},flushAllQueues:function(){for(var t=this._queueOrder,e=0,i=t.length;i>e;){if(3===e&&!this.mayRedraw&&!document.hidden)return void this.invokeInNextFrame(this.flushAllQueues,this);e=this.flushQueue(t[e])?0:e+1}},queueFn:function(t,e,i,n){var s,o,a=this._queues[t],h=a.length;if(e){if(!n)for(s=0;h>s;s+=1)if(o=a[s],o[0]===e&&o[1]===i)return this;a[h]=[e,i]}else try{e()}catch(c){r.didError(c)}return this},invoke:function(t,e,i){this._depth+=1;try{i?t.apply(e,i):e?t.call(e):t()}catch(n){r.didError(n)}return 1===this._depth&&this.flushAllQueues(),this._depth-=1,this._depth||this.processTimeouts(),this},invokeInNextEventLoop:function(t,e){var n=this._queues.nextLoop;return n.length||i(o),n.push([t,e]),this},invokeInNextFrame:function(t,e){var i=this._queues.nextFrame;return i.length||n(h),i.push([t,e]),this},invokeAfterDelay:function(t,e,i){var n=new s(Date.now()+e,0,t,i);return this._timeouts.push(n),this._scheduleTimeout(),n},invokePeriodically:function(t,e,i){var n=new s(Date.now()+e,e,t,i);return this._timeouts.push(n),this._scheduleTimeout(),n},_scheduleTimeout:function(){var t,e=this._timeouts.peek(),i=e?e.time:0;i&&i!==this._nextTimeout&&(clearTimeout(this._timer),t=i-Date.now(),t>0?(this._timer=setTimeout(a,i-Date.now()),this._nextTimeout=i):this._nextTimeout=0)},processTimeouts:function(){for(var t,e,i=this._timeouts;i.length&&i.peek().time<=Date.now();)t=i.pop(),(e=t.period)&&(t.time=Date.now()+e,i.push(t)),this.invoke(t.fn,t.bind);return this._scheduleTimeout(),this},cancel:function(t){return this._timeouts.remove(t),this},didError:function(t){console.log(t.name,t.message,t.stack)}};t.RunLoop=r,Function.implement({queue:function(t){var e=this;return function(){return r.queueFn(t,e,this),this}},nextLoop:function(){var t=this;return function(){return r.invokeInNextEventLoop(t,this),this}},nextFrame:function(){var t=this;return function(){return r.invokeInNextFrame(t,this),this}},invokeInRunLoop:function(){var t=this;return function(){r.invoke(t,this,arguments)}}});var o=r.invoke.bind(r,r.flushQueue,r,["nextLoop"]),a=r.processTimeouts.bind(r),h=function(t){r.frameStartTime=t,r.mayRedraw=!0,r.invoke(r.flushQueue,r,["nextFrame"]),r.mayRedraw=!1}}(O,window,"undefined"!=typeof setImmediate?setImmediate:function(t){return setTimeout(t,0)}),function(t,e){var i=t.meta,n=function(t,e){for(var i,n,s,r=this.observedProperties,o=t.observers,a=r.length;a--;)i=r[a],-1===i.indexOf(".")?(n=o[i],o.hasOwnProperty(i)||(n=o[i]=n?n.slice():[]),n.push({object:null,method:e})):(s||(s=t.pathObservers,t.hasOwnProperty("pathObservers")||(s=t.pathObservers=Object.create(s)),s=s[e]=[],t.inits.Observers=(t.inits.Observers||0)+1),s.push(i))},s=function(t,e){for(var i,n,s,r,o,a=this.observedProperties,h=t.observers,c=a.length;c--;)if(i=a[c],-1===i.indexOf(".")){for(n=h[i],h.hasOwnProperty(i)||(n=h[i]=n.slice()),r=n.length;r--;)if(s=n[r],null===s.object&&s.method===e){n.splice(r,1);break}}else o||(o=t.pathObservers,t.hasOwnProperty("pathObservers")||(o=t.pathObservers=Object.create(o)),o[e]=null,t.inits.Observers-=1)};Function.implement({observes:function(){for(var t=this.observedProperties||(this.observedProperties=[]),e=arguments.length;e--;)t.push(arguments[e]);return this.__setupProperty__=n,this.__teardownProperty__=s,this}});var r=function(t,e){var n,s,r,o=i(t).pathObservers;for(n in o)if(s=o[n])for(r=s.length;r--;)t[e](s[r],t,n)},o=function(i,n,s,r,o){var a,h,c,u,l,d=n.observers[s],f=n.isInitialised,g=!1;if(d&&(l=d.length))for(d=d.slice();l--;)a=d[l],h=a.object||i,c=a.method,f?(u=a.path)?(o!==e||g||(o=/^\d+$/.test(s)?i.getObjectAt(parseInt(s,10)):i.get(s),g=!0),r&&r.removeObserverForPath(u,h,c),o&&o.addObserverForPath(u,h,c),h[c](i,s,r&&r.getFromPath(u),o&&o.getFromPath(u))):h[c](i,s,r,o):(o&&(u=a.path)&&o.addObserverForPath(u,h,c),h instanceof t.Binding&&(h[c](),h.sync()))},a=function(t,e,i){var n,s,r=e.observers["*"];if(r)for(s=r.length;s--;)n=r[s],(n.object||t)[n.method](t,i)};t.ObservableProps={initObservers:function(){r(this,"addObserverForPath")},destroyObservers:function(){r(this,"removeObserverForPath")},hasObservers:function(){var e,n,s,r,o=i(this).observers;for(e in o)for(n=o[e],s=n.length;s--;)if(r=n[s].object,r&&r!==this&&(!r instanceof t.Binding||r.toObject!==this))return!0;return!1},beginPropertyChanges:function(){return i(this).depth+=1,this},endPropertyChanges:function(){var t,e,n=i(this);if(1===n.depth)for(;t=n.changed;){n.changed=null;for(e in t)o(this,n,e,t[e].oldValue,t[e].newValue);n.observers["*"]&&a(this,n,t)}return n.depth-=1,this},propertyDidChange:function(t,e,n){var s,r=i(this),h=r.isInitialised,c=h?this.propertiesDependentOnKey(t):[],u=c.length,l=r.depth,d=r.observers["*"],f=!u&&!l&&!d,g=f?null:r.changed||{},p=r.cache;if(f)o(this,r,t,e,n);else{for(;u--;)s=c[u],g[s]||(g[s]={oldValue:p[s]}),delete p[s];if(g[t]={oldValue:g[t]?g[t].oldValue:e,newValue:n},r.depth)r.changed=g;else{for(s in g)o(this,r,s,g[s].oldValue,g[s].newValue);h&&d&&a(this,r,g)}}return this},addObserverForKey:function(t,e,n){var s=i(this).observers,r=s[t];return s.hasOwnProperty(t)||(r=s[t]=r?r.slice():[]),r.push({object:e,method:n}),this},removeObserverForKey:function(t,e,n){var s,r,o=i(this).observers,a=o[t];if(a){for(r=a.length;r--;)if(s=a[r],s.object===e&&s.method===n){a.splice(r,1);break}a.length||delete o[t]}return this},addObserverForPath:function(e,n,s){var r=e.indexOf(".");if(-1===r)this.addObserverForKey(e,n,s);else{var o=e.slice(0,r),a=this.get(o),h=e.slice(r+1),c=i(this).observers,u=c[o];c.hasOwnProperty(o)||(u=c[o]=u?u.slice():[]),u.push({path:h,object:n,method:s}),!a||a instanceof t.Binding||a.addObserverForPath(h,n,s)}return this},removeObserverForPath:function(t,e,n){var s=t.indexOf(".");if(-1===s)this.removeObserverForKey(t,e,n);else{var r,o,a=t.slice(0,s),h=this.get(a),c=t.slice(s+1),u=i(this).observers[a];if(u)for(o=u.length;o--;)if(r=u[o],r.path===c&&r.object===e&&r.method===n){u.splice(o,1);break}h&&h.removeObserverForPath(c,e,n)}return this}}}(O),function(t){var e=t.meta;t.Object=t.Class({Mixin:[t.ComputedProps,t.BoundProps,t.ObservableProps,t.EventTarget],init:function(i){this.isDestroyed=!1,t.mixin(this,i);var n,s=e(this),r=s.inits;for(n in r)r[n]&&this["init"+n]();s.isInitialised=!0},destroy:function(){var t,i=e(this).inits;for(t in i)i[t]&&this["destroy"+t]();this.isDestroyed=!0}})}(O),function(t,e){var i=t.meta;t.ObservableRange={rangeDidChange:function(t,n){n===e&&(n=t+1);var s,r,o=i(this);for(s in o.observers)r=parseInt(s,10),r>=t&&n>r&&this.propertyDidChange(s);for(var a=o.rangeObservers,h=a?a.length:0,c=this.get("length")||0;h--;){var u=a[h],l=u.range,d=l.start||0,f="end"in l?l.end:Math.max(c,n);0>d&&(d+=c),0>f&&(f+=c),n>d&&f>t&&u.object[u.method](this,t,n)}return this.computedPropertyDidChange("[]"),this},addObserverForRange:function(t,e,n){var s=i(this);return(s.rangeObservers||(s.rangeObservers=[])).push({range:t,object:e,method:n}),this},removeObserverForRange:function(t,e,n){for(var s=i(this).rangeObservers,r=s?s.length:0;r--;){var o=s[r];if(o.range===t&&o.object===e&&o.method===n){s.splice(r,1);break}}return this}}}(O),function(t,e){var i=Array.prototype.splice,n=Array.prototype.slice,s=t.Class({Extends:t.Object,Mixin:[t.ObservableRange,t.Enumerable,t.MutableEnumerable],init:function(t,e){this._array=t||[],this._length=this._array.length,s.parent.init.call(this,e)},"[]":function(t){if(t){var e=this._array,i=this._length,n=t.length,s=0,r=n;for(this._array=t,this._length=n;n>s&&t[s]===e[s];)s+=1;if(n===i)for(var o=r-1;r>s&&t[o]===e[o];)r=o,o-=1;else r=Math.max(i,n),this.propertyDidChange("length",i,n);s!==r&&this.rangeDidChange(s,r)}return this._array.slice()}.property(),getObjectAt:function(t){return this._array[t]},length:function(t){var e=this._length;return"number"==typeof t&&t!==e&&(this._array.length=t,this._length=t,e>t&&this.rangeDidChange(t,e),e=t),e}.property().nocache(),setObjectAt:function(t,e){this._array[t]=e;var i=this._length;return t>=i&&(this._length=t+1,this.propertyDidChange("length",i,t+1)),this.rangeDidChange(t),this},replaceObjectsAt:function(t,e,s){var r,o,a,h,c=this._length,u=this._array;if(s=s?n.call(s):[],t>=c)for(a=0,h=s.length;h>a;a+=1)u[t+a]=s[a];else s.unshift(t,e),r=i.apply(u,s);return o=u.length,c!==o?(this._length=o,this.propertyDidChange("length",c,o),this.rangeDidChange(t,Math.max(c,o))):this.rangeDidChange(t,t+e),r||[]},sort:function(t){return this._array.sort(t),this.rangeDidChange(0,this._length),this},reverse:function(){return this._array.reverse(),this.rangeDidChange(0,this._length),this},concat:function(){var t,e,i,n=[];for(t=0,e=arguments.length;e>t;t+=1)i=arguments[t],n[t]=i instanceof s?i._array:i;
return Array.prototype.concat.apply(this._array,n)},join:function(t){return this._array.join(t)},slice:function(t,e){return this._array.slice(t,e)}});t.ObservableArray=s}(O),function(t,e){t.Transform={toBoolean:function(t){return!!t},toString:function(t){return null!=t?t+"":""},toInt:function(t){return parseInt(t,10)||0},toFloat:function(t){return parseFloat(t)},invert:function(t){return!t},defaultValue:function(t){return function(i){return i!==e?i:t}},undefinedToNull:function(t){return t===e?null:t},isEqualToValue:function(t){return function(i,n){return n?i===t:i?t:e}}}}(O),function(t){var e=navigator.userAgent.toLowerCase(),i=["other","0"],n=/ip(?:ad|hone|od)/.test(e)?"ios":(/android|webos/.exec(e)||/mac|win|linux/.exec(navigator.platform.toLowerCase())||i)[0],s=(/chrome|opera|safari|firefox|msie/.exec(e)||i)[0],r=parseFloat((/(?:version\/|chrome\/|firefox\/|msie\s|os )(\d+(?:[._]\d+)?)/.exec(e)||i)[1].replace("_",".")),o={chrome:"-webkit-",firefox:"-moz-",msie:"-ms-",opera:"-o-",safari:"-webkit-",other:"-webkit-"},a={};!function(){var t,i,h,c=document.createElement("div"),u=c.style,l={"box-shadow":{name:"box-shadow",value:"0 0 0 #000"},transform:{name:"transform",value:"translateX(0)"},transform3d:{name:"transform",value:"translateZ(0)"},transition:{name:"transition",value:"all .3s"},perspective:{name:"perspective",value:"1px"},"user-select":{name:"user-select",value:"none"}},d=o[s];for(t in l)i=l[t],h=i.name+":"+i.value,u.cssText=h,u.length?a[t]=i.name:(u.cssText=d+h,a[t]=u.length?d+i.name:null);u.cssText="display:flex",u.length?a.flexbox="flex":(u.cssText="display:"+d+"flex",a.flexbox=c.style.length?d+"flex":null),h=a.transition,["delay","timing","duration","property"].forEach(function(t){a["transition-"+t]=h?h+"-"+t:null}),c=null,u=null,("ios"===n&&6>r||/windows nt 5.1/.test(e))&&(a.transform3d=!1)}(),t.UA={platform:n,isMac:"mac"===n,isWin:"win"===n,isLinux:"linux"===n,isIOS:"ios"===n,isAndroid:"android"===n,browser:s,version:r,chrome:"chrome"===s?r:0,firefox:"firefox"===s?r:0,msie:"msie"===s?r:0,opera:"opera"===s?r:0,safari:"safari"===s?r:0,operaMobile:/opera mobi/.test(e)?r:0,operaMini:window.operamini?r:0,cssProps:a,cssPrefix:o[s],canTouch:"ontouchstart"in document.documentElement}}(O),function(t){var e=function(t,e,i,n){var s=3*t,r=3*(i-t)-s,o=1-s-r,a=3*e,h=3*(n-e)-a,c=1-a-h,u=function(t){return t*(s+t*(r+t*o))},l=function(t){return s+t*(2*r+3*o*t)},d=function(t){var e,i=t;do e=i,i-=(u(i)-t)/l(i);while(Math.abs(i-e)>1e-4);return i};return function(t){var e=d(t);return e*(a+e*(h+e*c))}.extend({cssName:"cubic-bezier("+t+","+e+","+i+","+n+")"})};t.Easing={linear:function(t){return t}.extend({cssName:"linear"}),ease:e(.25,.1,.25,1),easeIn:e(.42,0,1,1),easeOut:e(0,0,.58,1),easeInOut:e(.42,0,.58,1)}}(O),function(t){var e=[],i=function(){var n,s,r,o,a,h,c,u=e,l=u.length,d=t.RunLoop.frameStartTime;if(l)for(t.RunLoop.invokeInNextFrame(i);l--;){for(n=u[l],s=n.length,r=s>1,r&&(a=n[0].object,a.beginPropertyChanges());s--;)o=n[s],h=d-o.startTime,h===d&&(o.startTime=d,h=0),c=o.duration,c>h?o.drawFrame(o.ease(h/c),h):(o.drawFrame(1,c),o.stop());r&&a.endPropertyChanges()}},n=t.meta;t.Animation=t.Class({init:function(e){this.duration=this.duration,this.ease=this.ease,this.isRunning=!1,this.startTime=0,this.startValue=null,this.endValue=null,this.deltaValue=null,t.extend(this,e)},duration:300,ease:t.Easing.ease,animate:function(s,r,o){if(this.isRunning&&this.stop(),null!=r&&(this.duration=r),null!=o&&(this.ease=o),!this.prepare(s))return this;var a=this.object,h=n(a),c=h.animations||(h.animations=[]);return this.startTime=0,e.length||t.RunLoop.invokeInNextFrame(i),c.length||e.push(c),c.push(this),this.isRunning=!0,a.willAnimate&&a.willAnimate(this),this},prepare:function(t){return"object"==typeof t?(this.startValue=t.startValue,this.endValue=t.endValue):(this.startValue=this.object.get(this.property),this.endValue=t),this.deltaValue=this.endValue-this.startValue,!!this.deltaValue},drawFrame:function(t){var e=1>t?this.startValue+t*this.deltaValue:this.endValue;this.object.set(this.property,e)},stop:function(){if(this.isRunning){var t=this.object,i=n(t).animations;i.erase(this),i.length||e.erase(i),this.isRunning=!1,t.didAnimate&&t.didAnimate(this)}return this}})}(O),function(t){t.AnimatableView={animateLayer:!0,animateLayerDuration:300,animateLayerEasing:t.Easing.ease,animating:0,willAnimate:function(){this.increment("animating",1)},didAnimate:function(){this.increment("animating",-1)},layerAnimation:function(){var e=t.UA.cssProps.transition?t.CSSStyleAnimation:t.StyleAnimation;return new e({object:this,element:this.get("layer")})}.property(),redrawLayerStyles:function(e,i){var n,s,r=this.get("layerStyles"),o=this.get("layerAnimation"),a=t.Element.setStyle;if(this.get("animateLayer")&&this.get("isInDocument"))o.current||(o.current=i||r),o.animate(r,this.get("animateLayerDuration"),this.get("animateLayerEasing"));else{o.stop(),o.current=r,a(e,"transition-property","none");for(n in r)s=r[n],s!==i[n]&&a(e,n,s)}for(n in i)n in r||a(e,n,null)}}}(O),function(t){var e={animations:{},register:function(e,i){this.animations[t.guid(e)]=i},deregister:function(e){delete this.animations[t.guid(e)]},handleEvent:function(e){var i=this.animations[t.guid(e.target)],n=e.propertyName;i&&(e.stopPropagation(),i.transitionEnd(Object.keyOf(t.UA.cssProps,n)||n,e.elapsedTime))}.invokeInRunLoop()};["transitionend","webkitTransitionEnd","oTransitionEnd"].forEach(function(t){document.addEventListener(t,e,!0)});var i=t.Class({init:function(e){this._deadMan=null,this.duration=300,this.ease=t.Easing.ease,this.isRunning=!1,this.animating=[],this.current=null,t.extend(this,e)},animate:function(i,n,s){this.isRunning&&this.stop(),null!=n&&(this.duration=n),null!=s&&(this.ease=s);var r,o,a=this.element,h=this.current,c=this.animating,u=this.object,l=t.Element.setStyle;this.current=i;for(r in i)o=i[r],o!==h[r]&&(c.push(r),l(a,r,o));return c.length&&(l(a,"transition","all "+this.duration+"ms "+this.ease.cssName),this.isRunning=!0,this._deadMan=t.RunLoop.invokeAfterDelay(this.stop,this.duration+100,this),u&&u.willAnimate&&u.willAnimate(this),e.register(a,this)),this},transitionEnd:function(t){var e=this.animating,i=e.indexOf(t);i>-1&&(e.splice(i,1),e.length||this.stop())},stop:function(){if(this.isRunning){this.isRunning=!1,this.animating.length=0,t.RunLoop.cancel(this._deadMan),e.deregister(this.element),t.Element.setStyle(this.element,"transition","none");var i=this.object;i&&i.didAnimate&&i.didAnimate(this)}return this}});t.CSSStyleAnimationController=e,t.CSSStyleAnimation=i}(O),function(t){var e=/(\-?\d*\.\d+|\-?\d+)/,i=function(t,e){return 1&e?parseFloat(t):t},n={display:{calcDelta:function(t,e){return"none"===e?t:e},calcValue:function(t,e,i){return t?e:i}},transform:{calcDelta:function(t,n){var s=t.split(e).map(i),r=n.split(e).map(i);return s.length!==r.length&&(s=[t],r=[n]),{start:s,delta:r.map(function(t,e){return 1&e?t-s[e]:0})}},calcValue:function(t,e){var i,n,s=e.start,r=e.delta,o=s[0];for(i=1,n=s.length;n>i;i+=2)o+=s[i]+t*r[i],o+=s[i+1];return o}}},s={display:1,top:1,right:1,bottom:1,left:1,width:1,height:1,transform:1,opacity:1},r=t.Class({Extends:t.Animation,prepare:function(e){var i,r,o,a,h=this.animated=[],c=this.startValue=this.current,u=this.current=t.clone(c),l=this.deltaValue={},d=this.units={};this.endValue=e;for(i in e)r=c[i]||0,o=e[i]||0,r!==o&&(s[i]?(h.push(i),a=n[i],a?l[i]=a.calcDelta(r,o):(d[i]="string"==typeof r&&r.replace(/[\.\-\d]/g,"")||"string"==typeof o&&o.replace(/[\.\-\d]/g,"")||0,r=c[i]=parseInt(r,10),l[i]=parseInt(o,10)-r)):(u[i]=o,t.Element.setStyle(this.element,i,o)));return!!h.length},drawFrame:function(e){for(var i,s,r,o,a,h,c,u=this.animated,l=u.length,d=this.startValue,f=this.endValue,g=this.deltaValue,p=this.units,v=this.current,m=this.element,y=t.Element.setStyle;l--;)i=u[l],r=d[i]||0,o=f[i]||0,a=g[i],h=p[i],c=n[i],s=v[i]=1>e?c?c.calcValue(e,a,r,o):r+e*a+h:o,y(m,i,s)}});t.StyleAnimation=r}(O),function(t){var e={keys:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",144:"numlock"},lookupKey:function(t,i){var n,s=t.keyCode||t.which,r="keypress"===t.type,o=r&&s>32&&0!==t.which&&0!==t.charCode,a=String.fromCharCode(s).toLowerCase(),h=!o&&e.keys[s]||a;!o&&s>111&&124>s&&(h="f"+(s-111));var c="";return i||(n=!r||/[a-z]/.test(h),t.altKey&&n&&(c+="alt-"),t.ctrlKey&&(c+="ctrl-"),t.metaKey&&(c+="meta-"),t.shiftKey&&n&&(c+="shift-")),c+h}};t.DOMEvent=e}(O),function(t,e){var i,n,s,r,o,a,h={"class":"className",className:"className",defaultValue:"defaultValue","for":"htmlFor",html:"innerHTML",text:"textContent",unselectable:"unselectable",value:"value"},c={autofocus:1,checked:1,defaultChecked:1,disabled:1,hidden:1,multiple:1,readOnly:1,required:1,selected:1};Element.prototype.get=function(t){var e=h[t];return e?this[e]:c[t]?!!this[t]:this.getAttribute(t)},Element.prototype.set=function(t,e){var i,n=h[t];if(n)this[n]=null==e?"":""+e;else if(c[t])this[t]=!!e;else if("styles"===t)s(this,e);else if("children"===t){for(;i=this.lastChild;)this.removeChild(i);o(this,e)}else null==e?this.removeAttribute(t):this.setAttribute(t,""+e);return this};var u={opacity:1,zIndex:1},l=function(){var i,n,s=t.UA.cssProps,r={"float":document.body.style.cssFloat!==e?"cssFloat":"styleFloat"};for(i in s)n=s[i],n&&(n=n.camelCase(),"Ms"===n.slice(0,2)&&(n="m"+n.slice(1)),r[i.camelCase()]=n);return r}(),d=document,f=!!d.addEventListener.isFake,g=16,p=null;t.Element={forView:function(t){var e=p;return p=t,e},create:i=function(e,i,n){var s,a,h,c,u;if(i instanceof Array&&(n=i,i=null),/[#.]/.test(e))for(h=e.split(/([#.])/),e=h[0],i||(i={}),s=1,a=h.length;a>s+1;s+=2)c=h[s+1],"#"===h[s]?i.id=c:i.className=i.className?i.className+" "+c:c;return u=d.createElement(e),!f||"input"!==e&&"select"!==e&&"textarea"!==e||u.addEventListener("select"===e?"change":"propertychange",t.ViewEventsController,!1),i&&r(u,i),n&&o(u,n),u},setAttributes:r=function(i,n){var s,r;for(s in n)r=n[s],r!==e&&(r instanceof t.Binding?(r.to(s,i).connect(),p&&p.registerBinding(r)):i.set(s,r));return i},appendChildren:o=function(e,i){i instanceof Array||(i=[i]);var n,s,r;for(n=0,s=i.length;s>n;n+=1)r=i[n],r&&(r instanceof Array?o(e,r):r instanceof t.View?p.insertView(r,e):("object"!=typeof r&&(r=d.createTextNode(r)),e.appendChild(r)));return e},hasClass:function(t,e){return t.className.contains(e," ")},addClass:function(t,e){var i=t.className;return i.contains(e," ")||(t.className=(i?i+" ":"")+e),this},removeClass:function(t,e){var i=t.className,n=(" "+i+" ").indexOf(" "+e+" ");return n>-1&&(t.className=i.slice(0,n&&n-1)+i.slice(n+e.length)),this},setStyle:n=function(i,n,s){if(s!==e){n=n.camelCase(),n=l[n]||n,"number"!=typeof s||u[n]||(s+="px");try{i.style[n]=s}catch(r){t.RunLoop.didError({name:"Element#setStyle",message:"Invalid value set",details:"Style: "+n+"\nValue: "+s+"\nEl id: "+i.id+"\nEl class: "+i.className})}}return this},setStyles:s=function(t,e){for(var i in e)n(t,i,e[i]);return this},contains:function(t,e){var i=t.compareDocumentPosition(e);return!i||!!(i&g)},nearest:function(t,e,i){if(i||(i=t.ownerDocument.documentElement),"string"==typeof e){var n=e.toUpperCase();e=function(t){return t.nodeName===n}}for(;t&&!e(t);){if(!t||t===i)return null;t=t.parentNode}return t},getPosition:a=function(t,e){var i=t.getBoundingClientRect(),n={top:i.top,left:i.left};return e&&(i=a(e),"BODY"===e.nodeName&&(e=e.parentNode),n.top-=i.top-e.scrollTop,n.left-=i.left-e.scrollLeft),n}},Object.toCSSString=function(i){var n,s,r="";for(n in i)s=i[n],s!==e&&("number"!=typeof s||u[n]||(s+="px"),n=n.hyphenate(),n=t.UA.cssProps[n]||n,r+=n,r+=":",r+=s,r+=";");return r}}(O),function(t){t.Stylesheet={create:function(e,i){var n=document,s=n.documentElement.firstChild,r=t.Element.create("style",{type:"text/css",id:e});return r.styleSheet?(s.appendChild(r),r.styleSheet.cssText=i):(r.appendChild(n.createTextNode(i)),s.appendChild(r)),r}}}(O),function(t){var e=t.UA.isMac,i={alt:e?"⌥":"Alt-",cmd:e?"⌘":"Ctrl-",meta:e?"⌘":"Meta-",shift:e?"⇧":"Shift-",enter:e?"↵":"Enter",backspace:e?"⌫":"Backspace"};t.formatKeyForPlatform=function(t){return t.split("-").map(function(t){return i[t]||t.capitalise()}).join("")};var n={checkbox:1,radio:1,file:1,submit:1},s={},r=t.Class({Extends:t.Object,init:function(e){this.isEnabled=!0,this._shortcuts={},r.parent.init.call(this,e);var i=t.ViewEventsController;i.kbShortcuts=this,i.addEventTarget(this,-10)},destroy:function(){var e=t.ViewEventsController;e.kbShortcuts===this&&delete t.ViewEventsController.kbShortcuts,e.removeEventTarget(this),r.parent.destroy.call(this)},register:function(t,i,n){t=t.replace("cmd-",e?"meta-":"ctrl-");var s=this._shortcuts;return(s[t]||(s[t]=[])).push([i,n]),this},deregister:function(t,i,n){t=t.replace("cmd-",e?"meta-":"ctrl-");for(var s,r=this._shortcuts[t],o=r?r.length:0,a=o;a--;)s=r[a],s[0]===i&&s[1]===n&&(1===o?delete this._shortcuts[t]:r.splice(a,1));return this},getHandlerForKey:function(t){var e=this._shortcuts[t];return e&&this.get("isEnabled")?e[e.length-1]:null},trigger:function(e){var i,r,o=e.target,a=o.nodeName,h=e.ctrlKey||e.metaKey;if(h||!("TEXTAREA"===a||"SELECT"===a||"INPUT"===a&&!n[o.type]||e.targetView instanceof t.RichTextView)){if(r=t.DOMEvent.lookupKey(e),"keydown"===e.type)s[r]=!0;else if(s[r])return;i=this.getHandlerForKey(r),i&&(i[0][i[1]](e),e.doDefault||e.preventDefault())}}.on("keydown","keypress")});t.GlobalKeyboardShortcuts=r}(O),function(t){var e=function(t){var e=t.href,i=e.indexOf("#/");return i>-1?e.slice(i+2):""},i=function(t,e){return t.pathname.slice(e.length)},n=t.Class({Extends:t.Object,title:document.title,currentPath:"",useHash:!history.pushState||"file:"===location.protocol,baseUrl:"/",encodedState:"",mayGoBack:!0,replaceState:!1,routes:[],init:function(t,s){n.parent.init.call(this,t),s||(s=window);var r=s.location,o=this.useHash&&e(r)||i(r,this.baseUrl);this.set("currentPath",o),this.restoreStateFromUrl(o),s.addEventListener(this.useHash?"hashchange":"popstate",this,!1),this._win=s},setTitle:function(){document.title=this.get("title")}.observes("title"),handleEvent:function(){var t=this._win.location,n=this.useHash?e(t):i(t,this.baseUrl);this.get("mayGoBack")&&n!==this.get("currentPath")&&(this.set("currentPath",n),this.restoreStateFromUrl(n))}.invokeInRunLoop(),restoreStateFromUrl:function(t){var e,i,n,s,r=this.get("routes");for(e=0,i=r.length;i>e;e+=1)if(n=r[e],s=n.url.exec(t)){this.beginPropertyChanges(),n.handle.apply(this,s),this.endPropertyChanges();break}return this},encodeStateToUrl:function(){var t,e,i,n,s,r,o=this.get("encodedState"),a=this.get("replaceState"),h=this._win;if(this.get("currentPath")!==o){if(this.set("currentPath",o),this.useHash)t=h.location,a?(i=t.href,n=i.indexOf("#"),n>-1&&(i=i.slice(0,n)),t.replace(i+"#/"+o)):t.hash="#/"+o;else{e=h.history,s=this.get("title"),r=this.getUrlForEncodedState(o);try{a?e.replaceState(null,s,r):e.pushState(null,s,r)}catch(c){}}a&&this.set("replaceState",!1)}}.queue("after").observes("encodedState"),getUrlForEncodedState:function(t){return this.get("baseUrl")+t}});t.Router=n}(O),function(t){var e=t.Class({Extends:t.Object,init:function(t){this._images={all:{}},this._styles={all:{}},this._activeStylesheets={},this.theme="",e.parent.init.call(this,t)},changeTheme:function(t,e){var i,n=this._activeStylesheets;for(i in n)n[i]&&(this.addStylesheet(i,e),this.removeStylesheet(i,t))},imageDidLoad:function(t,e,i){var n=this._images[t]||(this._images[t]={});return n[e]=i,this},stylesheetDidLoad:function(t,e,i){var n=this._styles[t]||(this._styles[t]={});return n[e]=i,this},addStylesheet:function(e,i){i||(i=this.get("theme"));var n=this._styles[i],s=n[e]||this._styles.all[e],r=this._images[i]||{},o=this._images.all,a=this._activeStylesheets;return s&&(s=s.replace(/url\(([^)]+)\)/g,function(e,i){return"url("+(r[i]||o[i]||t.loc(i)||i)+")"}),t.Stylesheet.create(i+"-"+e,s),a[e]=(a[e]||0)+1),this},removeStylesheet:function(t,e){e||(e=this.get("theme"));var i=document.getElementById(e+"-"+t);return i&&(i.parentNode.removeChild(i),this._activeStylesheets[t]-=1),this},getImageSrc:function(t){var e=this._images,i=e[this.get("theme")]||{},n=e.all;return i[t]||n[t]||null}});t.ThemeManager=e}(O),function(t,e,i,n){var s=t.Class({Extends:t.Object,broadcastKey:"owm:broadcast",init:function(n){this.id=(new Date).format("%y%m%d%H%M%S")+Math.random(),this.isMaster=!1,this.isFocussed=8!==t.UA.msie&&i.hasFocus?i.hasFocus():!0,this._seenWCs={},s.parent.init.call(this,n),e.addEventListener("storage",this,!1),e.addEventListener("unload",this,!1),e.addEventListener("focus",this,!1),e.addEventListener("blur",this,!1),this.broadcast("wc:hello");var r=t.RunLoop,o=this,a=function c(){o.checkMaster(),o._checkTimeout=r.invokeAfterDelay(c,9e3)},h=function u(){o.sendPing(),o._pingTimeout=r.invokeAfterDelay(u,17e3)};this._checkTimeout=r.invokeAfterDelay(a,500),this._pingTimeout=r.invokeAfterDelay(h,17e3)},destroy:function(){t.RunLoop.cancel(this._pingTimeout).cancel(this._checkTimeout),e.removeEventListener("storage",this,!1),e.removeEventListener("unload",this,!1),e.removeEventListener("focus",this,!1),e.removeEventListener("blur",this,!1),this.broadcast("wc:bye"),s.parent.destroy.call(this)},handleEvent:function(t){switch(t.type){case"storage":if(t.key===this.get("broadcastKey"))try{var e=JSON.parse(t.newValue);e.wcId!==this.id&&this.fire(e.type,e)}catch(i){}break;case"unload":this.destroy();break;case"focus":this.set("isFocussed",!0);break;case"blur":this.set("isFocussed",!1)}}.invokeInRunLoop(),sendPing:function(){this.broadcast("wc:ping")},_hello:function(t){this._ping(t),t.wcId<this.id?this.checkMaster():this.sendPing()}.on("wc:hello"),_ping:function(t){this._seenWCs[t.wcId]=Date.now()}.on("wc:ping"),_bye:function(t){delete this._seenWCs[t.wcId],this.checkMaster()}.on("wc:bye"),checkMaster:function(){var t,e=Date.now(),i=!0,n=this._seenWCs,s=this.id;for(t in n)n[t]+23e3<e?delete n[t]:s>t&&(i=!1);this.set("isMaster",i)},broadcast:function(e,i){try{n.setItem(this.get("broadcastKey"),JSON.stringify(t.extend({wcId:this.id,type:e},i)))}catch(s){}}});t.WindowController=s}(O,window,document,localStorage),O.Status={EMPTY:1,READY:2,DESTROYED:4,NON_EXISTENT:8,LOADING:16,COMMITTING:32,NEW:64,DIRTY:128,OBSOLETE:256},function(t){var e=t.Status,i=e.READY,n=e.DESTROYED,s=function(t,e){return t-e},r=t.Class({Extends:t.Object,Mixin:[t.ObservableRange,t.Enumerable],id:function(){return t.guid(this)}.property().nocache(),init:function(e){var n,s=e.Type,o=e.sort,a=e.store||this.store;!o||o instanceof Function||(o=e.sort=t.sortByProperties(o)),n=a.findAll(s,e.filter,o),this._storeKeys=n,this._sort=n.sortFn,this._filter=n.filterFn,this.status=a.getTypeStatus(s)&i,this.length=n.length,r.parent.init.call(this,e),a.addQuery(this)},destroy:function(){this.set("status",n),this.get("store").removeQuery(this),r.parent.destroy.call(this)},is:function(t){return!!(this.get("status")&t)},"[]":function(){var t=this.get("store"),e=this.get("Type");return this._storeKeys.map(function(i){return t.materialiseRecord(i,e)})}.property().nocache(),indexOfId:function(t,e,n){var s,r=this.get("store").getRecord(this.get("Type"),t),o=-1;return r.is(i)&&(s=r.get("storeKey"),o=this._storeKeys.indexOf(s,e)),n&&n(o),o},getObjectAt:function(t){var e,i=this._storeKeys[t];return i&&(e=this.get("store").materialiseRecord(i,this.get("Type"))),e},refresh:function(t){return this.get("store").fetchAll(this.get("Type"),t),this},reset:function(){var t=this._storeKeys,e=this.get("store").findAll(this.get("Type"),this.filter,this.sort),i=Math.max(e.length,t.length);return this._storeKeys=e,this.beginPropertyChanges().set("length",e.length).rangeDidChange(0,i).endPropertyChanges().fire("query:reset")},storeDidChangeRecords:function(t){var e,n,r,o,a,h,c,u,l,d,f,g,p,v,m,y=this._filter,w=this._sort,_=this._storeKeys,b=[],T=[],D=[],S=[],C=this.get("length"),O=this.get("store"),x=function(t){return O.getIdFromStoreKey(t)||"#"+t};for(n=t.length;n--;)r=t[n],o=_.indexOf(r),a=O.getStatus(r)&i&&(!y||y(r)),o>-1?a?w&&(S.push(o),b.push(r)):S.push(o):a&&b.push(r);if(p=S.length,g=b.length,p)for(S.sort(s),e=0;p>e;e+=1)D[e]=_[S[e]];if(g||p)for(g&&w&&b.sort(w),v=C-p+g,h=new Array(v),e=0,c=0,u=0,l=0;v>e;e+=1){for(;p>u&&c===S[u];)u+=1,c+=1;w&&C>c&&g>l?(d=_[c],f=b[l],w(d,f)<0?(h[e]=d,c+=1):(h[e]=f,T[l]=e,l+=1)):C>c?(h[e]=_[c],c+=1):(h[e]=b[l],T[l]=e,l+=1)}if(g)for(T.sort(s),e=0;g>e;e+=1)b[e]=h[T[e]];for(n=Math.min(g,p);n--;)b[n]===D[n]&&T[n]===S[n]&&(b.splice(n,1),T.splice(n,1),D.splice(n,1),S.splice(n,1),g-=1,p-=1);return g||p?(this._storeKeys=h,m=Math.max(v,C),this.beginPropertyChanges().set("length",v).rangeDidChange(Math.min(g?T[0]:m,p?S[0]:m),v===C?Math.max(g?T[g-1]:0,p?S[p-1]:0)+1:m).endPropertyChanges().fire("query:updated",{removed:D.map(x),removedIndexes:S,added:b.map(x),addedIndexes:T}),!0):!1},getIdsForObjectsInRange:function(t,e,i){t=Math.max(0,t),e=Math.min(this.get("length"),e);var n=this.get("store");return i(this._storeKeys.slice(t,e).map(function(t){return n.getIdFromStoreKey(t)||"#"+t}),t,e),!1},getIdsForAllObjects:function(t){return this.getIdsForObjectsInRange(0,2147483647,t)}});t.LiveQuery=r}(O),function(t){var e=t.Class({Extends:t.Object,Mixin:t.Enumerable,init:function(t,i,n){this.store=t,this.Type=i,this.storeKeys=n,e.parent.init.call(this)},length:function(){return this.get("storeKeys").length}.property("storeKeys"),getObjectAt:function(t){var e,i=this.get("storeKeys")[t];return i&&(e=this.get("store").materialiseRecord(i,this.get("Type"))),e}});t.RecordArray=e}(O),function(t){var e=t.Class({Extends:t.Object,init:function(i){e.parent.init.call(this);var n,s,r,o,a,h,c,u=t.meta(i).attrs,l=t.meta(this),d=l.dependents=t.clone(l.dependents),f=0;for(n in u)if((s=u[n])&&(r=i[s],o=this[s]=r.validate?r.validate(i.get(s),s,i):null,o&&(f+=1),a=r.validityDependencies))for(h=a.length;h--;)c=a[h],d[c]||(d[c]=[],i.addObserverForKey(c,this,"attrDidChange")),d[c].push(s);this.errorCount=f,this._record=i},attrDidChange:function(e,i){var n,s,r=t.meta(this),o=r.changed={},a=r.dependents[i],h=a.length,c=this._record;for(this.beginPropertyChanges();h--;)n=a[h],s=c[n],o[n]={oldValue:this[n],newValue:this[n]=s.validate?s.validate(c.get(n),n,c):null};this.endPropertyChanges()},setRecordValidity:function(t,e){var i,n,s,r,o=this.get("errorCount");for(i in e)"errorCount"!==i&&(n=e[i],s=!n.oldValue,r=!n.newValue,s&&!r?o+=1:r&&!s&&(o-=1));this.set("errorCount",o)._record.set("isValid",!o)}.observes("*")}),i=t.Status,n=i.READY|i.NEW|i.DIRTY,s=t.Class({Extends:t.Object,init:function(t,e){this._noSync=!1,this._data=e?null:{},this.store=t,this.storeKey=e,s.parent.init.call(this)},status:function(){var t=this.get("storeKey");return t?this.get("store").getStatus(t):n}.property().nocache(),is:function(t){return!!(this.get("status")&t)},setObsolete:function(){var t=this.get("storeKey"),e=this.get("status");return t&&this.get("store").setStatus(t,e|i.OBSOLETE),this},setLoading:function(){var t=this.get("storeKey"),e=this.get("status");return t&&this.get("store").setStatus(t,e|i.LOADING),this},id:function(){var t=this.get("storeKey");return t?this.get("store").getIdFromStoreKey(t):this.get(this.constructor.primaryKey)}.property(),toJSON:function(){return this.get("storeKey")},toIdOrStoreKey:function(){return this.get("id")||"#"+this.get("storeKey")},saveToStore:function(){if(this.get("storeKey"))throw new Error("Record already created in store.");var e,i,n,s,r=this.constructor,o=this._data,a=this.get("store"),h=r.primaryKey||"id",c=this[h].key||h,u=a.getStoreKey(r,o[c]),l=t.meta(this).attrs;this._data=null;for(e in l)i=l[e],i&&(n=this[i],e in o||n.noSync||(s=n.defaultValue,void 0!==s&&(o[e]=s&&s.toJSON?s.toJSON():t.clone(s))));return a.createRecord(u,o).setRecordForStoreKey(u,this).fire("record:user:create",{record:this}),this.set("storeKey",u)},discardChanges:function(){if(this.get("status")===n)this.destroy();else{var t=this.get("storeKey");t&&this.get("store").revertData(t)}return this},refresh:function(){var t=this.get("storeKey");return t&&this.get("store").fetchData(t),this},destroy:function(){var t=this.get("storeKey");t&&this.get("isEditable")&&this.get("store").fire("record:user:destroy",{record:this}).destroyRecord(t)},getDoppelganger:function(t){return this.get("store")===t?this:t.materialiseRecord(this.get("storeKey"),this.constructor)},storeWillUnload:function(){s.parent.destroy.call(this)},stopSync:function(){return this._noSync=!0,this},startSync:function(){return this._noSync=!1,this},isEditable:!0,isValid:function(t){return void 0!==t?t:!this.get("errorForAttribute").get("errorCount")}.property(),errorToSet:function(t,e){var i=this[t];return i.validate?i.validate(e,t,this):null},errorForAttribute:function(){return new e(this)}.property()});t.Record=s}(O),function(t,e){var i=t.Status,n=i.EMPTY,s=i.READY,r=i.DESTROYED,o=i.NON_EXISTENT,a=i.LOADING,h=i.OBSOLETE,c=t.Class({Extends:t.Object,Mixin:[t.Enumerable,t.ObservableRange],id:function(){return t.guid(this)}.property().nocache(),sort:"",filter:"",Type:t.Record,is:function(t){return!!(this.get("status")&t)},setObsolete:function(){return this.set("status",this.get("status")|h)},setLoading:function(){return this.set("status",this.get("status")|a)},init:function(t){this._list=[],this._awaitingIdFetch=[],this._refresh=!1,this.state="",this.status=n,this.length=null,c.parent.init.call(this,t),this.get("store").addQuery(this)},destroy:function(){this.set("status",this.is(n)?o:r),this.get("store").removeQuery(this),c.parent.destroy.call(this)},refresh:function(t,e){var i=this.get("status");return t||i===n||i&h?(i&s&&(this._refresh=!0),this.get("source").fetchQuery(this,e)):e&&e(),this},reset:function(t,e){var i=this.get("length");return this._list.length=0,this._refresh=!1,this.set("state","").set("status",n).set("length",null).rangeDidChange(0,i),e&&this.get("source").fetchQuery(this),this.fire("query:reset")}.observes("sort","filter"),getObjectAt:function(t,i){var n=this.get("length");if(null===n||0>t||t>=n)return e;i||(i=this.fetchDataForObjectAt(t));var s=this._list[t];return s?this.get("store").getRecord(this.get("Type"),s,i):null},fetchDataForObjectAt:function(){return!1},indexOfId:function(t,e,i){var n=this._list.indexOf(t,e);return i&&(null===this.get("length")?this.get("source").fetchQuery(this,function(){i(this._list.indexOf(t,e))}.bind(this)):i(n)),n},getIdsForObjectsInRange:function(t,e,i){var n=this.get("length");return null===n?(this._awaitingIdFetch.push([t,e,i]),this.refresh(),!0):(0>t&&(t=0),e>n&&(e=n),i(this._list.slice(t,e),t,e),!1)},getIdsForAllObjects:function(t){return this.getIdsForObjectsInRange(0,2147483647,t)},_adjustIdFetches:function(t){var e,i,n,s,r,o,a,h,c=t.addedIndexes,u=t.removedIndexes,l=this._awaitingIdFetch;for(e=0,i=l.length;i>e;e+=1){for(n=l[e],s=n[0],r=n[1],o=0,a=u.length;a>o;o+=1)h=u[o],s>h&&(s-=1),r>h&&(r-=1);for(o=0,a=c.length;a>o;o+=1)h=c[o],s>=h&&(s+=1),r>h&&(r+=1);n[0]=s,n[1]=r}}.on("query:updated"),_idsWereFetched:function(){var t=this._awaitingIdFetch;t.length&&(t.forEach(function(t){this.getIdsForObjectsInRange(t[0],t[1],t[2])},this),t.length=0)}.queue("before").on("query:idsLoaded"),sourceWillFetchQuery:function(){var t=this._refresh;return this._refresh=!1,this.set("status",(this.get("status")|a)&~h),t},sourceDidFetchQuery:function(t){if(this.get("sort")===t.sort&&this.get("filter")===t.filter){this.set("state",t.state);var e,i=this._list,n=this._list=t.idList,r=this.get("length"),o=n.length,a=[],c=[],u=[],l=[],d=0,f=o-1,g=(r||0)-1,p=Math.min(o,r||0);if(null!==r){for(;p>d&&n[d]===i[d];)d+=1;for(;f>=0&&g>=0&&n[f]===i[g];)f-=1,g-=1;for(e=d;g>=e;e+=1)a.push(e),c.push(i[e]);for(e=d;f>=e;e+=1)u.push(e),l.push(n[e])}return f=o===r?f+1:Math.max(r||0,o),this.beginPropertyChanges().set("status",s|(this.is(h)?h:0)).set("length",o),f>d&&this.rangeDidChange(d,f),this.endPropertyChanges(),null!==r&&f>d&&this.fire("query:updated",{removed:c,removedIndexes:a,added:l,addedIndexes:u}),this.fire("query:idsLoaded")}}});t.RemoteQuery=c}(O),function(t,e){var i=t.Status,n=i.EMPTY,s=i.READY,r=i.DIRTY,o=i.LOADING,a=i.OBSOLETE,h=0,c=1,u=2,l=4,d=8,f=16,g=32,p=function(t,e){var i=t.map(function(t,i){return[t,e[i]]});i.sort(function(t,e){return t[0]-e[0]}),i.forEach(function(i,n){t[n]=i[0],e[n]=i[1]})},v=function(t,i){var n,s,r,o={},a=[],h=t.length,c=i.length;if(c<~~Math.log(h)+1)for(r=0;c>r;r+=1)a.push(t.indexOf(i[r]));else{for(r=0;h>r;r+=1)n=t[r],n&&(o[n]=r);for(r=0;c>r;r+=1)s=o[i[r]],a.push(s===e?-1:s)}return a},m=function(t,e,i,n){for(var s=[],r=[],o=0,a=0,h=t.length,c=e.length;h>o||c>a;)a>=c||h>o&&t[o]<e[a]?(s.push(t[o]),r.push(i[o]),o+=1):(s.push(e[a]),r.push(n[a]),a+=1);return[s,r]},y=function(t,e,i,n,s){var r,o,a,h,c,u,l=[],d=[];for(r=0,o=t.length;o>r;r+=1)if(a=t[r],h=e.binarySearch(a),a!==e[h]){for(a-=h,c=0,u=i.length;u>c&&a>=i[c];c+=1)a+=1;l.push(a),d.push(n[r])}return m(i,l,s,d)},w=function(t,e){var i=y(e.removedIndexes,t.addedIndexes,t.removedIndexes,e.removedIds,t.removedIds),n=y(t.addedIndexes,e.removedIndexes,e.addedIndexes,t.addedIds,e.addedIds);return{removedIndexes:i[0],removedIds:i[1],addedIndexes:n[0],addedIds:n[1],truncateAtFirstGap:t.truncateAtFirstGap||e.truncateAtFirstGap,total:e.total,upto:e.upto}},_=function(t){var e=t.removedIndexes;return t.removedIndexes=t.addedIndexes,t.addedIndexes=e,e=t.removedIds,t.removedIds=t.addedIds,t.addedIds=e,t.total=t.total+t.addedIds.length-t.removedIds.length,t},b=function(t,e,i,n){return i>t?e>i:n>t},T=function(t,e,i,n){for(var s,r,o,a,h=t*e,c=i*e,u=n.length;u--&&(s=n[u],r=s.start||0,"end"in s)&&(o=s.end,!(a=b(h,h+e,r-c,o+c))););return-1!==u},D=t.Class({Extends:t.RemoteQuery,windowSize:30,windowCount:function(){var t=this.get("length");return null===t?t:Math.floor((t-1)/this.get("windowSize"))+1}.property("length"),triggerPoint:10,optimiseFetching:!1,prefetch:1,canGetDeltaUpdates:!0,init:function(t){this._windows=[],this._indexOfRequested=[],this._waitingPackets=[],this._preemptiveUpdates=[],this._isAnExplicitIdFetch=!1,D.parent.init.call(this,t)},reset:function(t,e){this._windows.length=this._indexOfRequested.length=this._waitingPackets.length=this._preemptiveUpdates.length=0,this._isAnExplicitIdFetch=!1,D.parent.reset.call(this,t,e)}.observes("sort","filter"),indexOfId:function(t,e,i){var n,s,r=this._list.indexOf(t,e);if(i)if(0>r){if(s=this.get("windowCount"),null!==s){for(n=this._windows;s--&&n[s]&l;);if(0>s)return i(r),r}this._indexOfRequested.push([t,function(){i(this._list.indexOf(t,e))}.bind(this)]),this.get("source").fetchQuery(this)}else i(r);return r},getIdsForObjectsInRange:function(t,e,i){var n,s,r,o,a=this.get("length"),h=!0;if(null!==a)for(0>t&&(t=0),e>a&&(e=a),n=this._windows,s=this.get("windowSize"),r=Math.floor(t/s),o=Math.floor((e-1)/s)+1;o>r;r+=1)n[r]&l||(h=!1,this._isAnExplicitIdFetch=!0,this.fetchWindow(r,!1,0));else h=!1;return h?i(this._list.slice(t,e),t,e):this._awaitingIdFetch.push([t,e,i]),!h},fetchDataForObjectAt:function(t){var e=this.get("windowSize"),i=this.get("triggerPoint"),n=Math.floor(t/e),s=t%e;return this.fetchWindow(n,!0),i>s&&this.fetchWindow(n-1,!0),s+i>=e&&this.fetchWindow(n+1,!0),!0},fetchWindow:function(t,i,n){var s,r,o=this.get("status"),u=this._windows,f=!1;for(o&a&&this.refresh(),n===e&&(n=this.get("prefetch")),s=Math.max(0,t-n),r=Math.min(t+n+1,this.get("windowCount")||0);r>s;s+=1)o=u[s]||0,o===h&&(o=c,f=!0),s===t&&i&&d>o&&(o&l&&this.checkIfWindowIsFetched(s)?o=l|g:(o|=d,f=!0)),u[s]=o;return f&&this.get("source").fetchQuery(this),this},checkIfWindowIsFetched:function(t){for(var e=this.get("store"),i=this.get("Type"),s=this.get("windowSize"),r=this._list,o=t*s,h=Math.min(o+s,this.get("length"));h>o;o+=1)return e.getRecordStatus(i,r[o])&(n|a)?!1:!0},recalculateFetchedWindows:function(t,i){t||(t=0),i===e&&(i=this.get("length"));var n,s,r=this.get("windowSize"),o=this._windows,a=this._list,h=Math.floor((i-1)/r),c=i-1;for(t=Math.floor(t/r),o.length=h+1;h>=t;){for(n=h*r,s=(o[h]||0)&~g,s|=l;c>=n;){if(!a[c]){s&=~l;break}c-=1}o[h]=s,c=n-1,h-=1}return this;
},_normaliseUpdate:function(t){var e,i,n,s,r,o,a=this._list,h=t.removed||[],c=v(a,h),u=[],l=[],d=t.added||[];for(p(c,h),e=0;-1===c[e];e+=1);for(e&&(c=c.slice(e),h=h.slice(e)),t.truncateAtFirstGap=!!e,t.removedIndexes=c,t.removedIds=h,e=0,n=d.length;n>e;e+=1)s=d[e],r=s[0],o=s[1],i=h.indexOf(o),i>-1&&c[i]-i+l.length===r?(c.splice(i,1),h.splice(i,1)):(l.push(r),u.push(o));return t.addedIndexes=l,t.addedIds=u,"total"in t||(t.total=this.get("length")-c.length+l.length),t},_applyUpdate:function(t){var e,i,n,s,r,o=t.removedIndexes,a=t.removedIds,h=a.length,c=t.addedIndexes,u=t.addedIds,l=u.length,d=this._list,f=!(!l&&!h),g=this.get("length"),p=t.total,v=g;for(i=h;i--;)n=o[i],d.splice(n,1),v>n&&(v=n);if(t.truncateAtFirstGap){for(e=0;d[e];)e+=1;d.length=e,v>e&&(v=e)}for(r=d.length,e=0,i=l;i>e;e+=1)n=c[e],s=u[e],n>=r?(d[n]=s,r=n+1):(d.splice(n,0,s),r+=1),v>n&&(v=n);if(t.upto){if(i=d.lastIndexOf(t.upto)+1,!i)return this.reset();i!==r&&(f=!0,d.length=i)}return f&&this.recalculateFetchedWindows(v,p),this.set("length",p).rangeDidChange(v,Math.max(g,p)),this.fire("query:updated",{removed:a,removedIndexes:o,added:u,addedIndexes:c}),this._applyWaitingPackets(),this},_applyWaitingPackets:function(){for(var t,e=!1,i=this._waitingPackets,n=i.length,s=this.get("state");n--;)t=i.shift(),t.state!==s?e=!0:this.sourceDidFetchIdList(t);e&&this._fetchObservedWindows()},_fetchObservedWindows:function(){var e,i,n,s,r,o,a=t.meta(this).rangeObservers,h=this.get("length"),c=this.get("windowSize");if(a)for(o=a.length;o--;){r=a[o].range,e=r.start||0,i="end"in r?r.end:h,0>e&&(e+=h),0>i&&(i+=h),n=Math.floor(e/c),s=Math.floor((i-1)/c);for(;s>=n;n+=1)this.fetchWindow(n,!0)}},clientDidGenerateUpdate:function(t){return this._normaliseUpdate(t),t.truncateAtFirstGap=!1,this._applyUpdate(t),this._preemptiveUpdates.push(t),this.set("status",this.get("status")|r),this.refresh(!0),this},sourceDidFetchUpdate:function(){var e=function(t,e){var i=t.length;if(e.length!==i)return!1;for(;i--;)if(t[i]!==e[i])return!1;return!0},i=function(t,i){return t.total===i.total&&e(t.addedIndexes,i.addedIndexes)&&e(t.addedIds,i.addedIds)&&e(t.removedIndexes,i.removedIndexes)&&e(t.removedIds,i.removedIds)};return function(e){var n,s,a,h=this.get("state"),c=this.get("status"),u=this._preemptiveUpdates,l=u.length;if(this.set("status",c&~o),h===e.newState)return!l||c&r||(n=u.reduce(w),this._applyUpdate(_(n)),u.length=0),this;if(h!==e.oldState)return this.setObsolete();if(!t.isEqual(e.sort,this.get("sort"))||!t.isEqual(e.filter,this.get("filter")))return this;if(this.set("state",e.newState),l){for(s=[u[0]],a=1;l>a;a+=1)s[a]=w(s[a-1],u[a]);var d,f,g,v,m=this._normaliseUpdate({added:e.added,total:e.total,upto:e.upto}),y=e.removed,b=[],T=[],D=[],S=[],C=this._list,O=!1;for(n=s[l-1],a=0,l=y.length;l>a;a+=1)g=y[a],v=n.removedIds.indexOf(g),v>-1?(D.push(n.removedIndexes[v]),S.push(g)):(v=C.indexOf(g),v>-1?(b.push(v),T.push(g)):m.truncateAtFirstGap=!0);if(b.length){var x,k=w(n,{removedIndexes:b,removedIds:T,addedIndexes:[],addedIds:[]});for(b=T.map(function(t){return k.removedIndexes[k.removedIds.indexOf(t)]}),x=D.length,a=0,l=b.length;l>a;a+=1)D[x]=b[a],S[x]=T[a],x+=1}for(p(D,S),m.removedIndexes=D,m.removedIds=S,d=m.addedIndexes,f=m.addedIds,l=d.length;l--;)g=f[l],a=S.indexOf(g),a>-1&&D[a]-a+l===d[l]&&(D.splice(a,1),S.splice(a,1),d.splice(l,1),f.splice(l,1));if(!m.truncateAtFirstGap)if(S.length||f.length){for(l=s.length;l--;)if(i(m,s[l])){u.splice(0,l+1),O=!0;break}}else O=!0;O?c&r||!u.length?this._applyWaitingPackets():(n=u.reduce(w),this._applyUpdate(_(n)),u.length=0):(u.length=0,this._applyUpdate(w(_(n),m)))}else this._applyUpdate(this._normaliseUpdate(e));return this}}(),sourceDidFetchIdList:function(e){if(!t.isEqual(e.sort,this.get("sort"))||!t.isEqual(e.filter,this.get("filter")))return this;var i,r,o,a=this.get("state"),h=this.get("status"),c=this.get("length")||0,u=this.get("canGetDeltaUpdates"),d=e.position,f=e.total,g=e.idList,p=g.length,v=this._list,m=this._windows,y=this._preemptiveUpdates,b=!1,T=!0;if(a&&a!==e.state){if(u)return this._waitingPackets.push(e),this.setObsolete().refresh();v.length=m.length=y.length=0,b=!0}if(this.set("state",e.state),y.length){var D,S=y.reduce(w),C=S.addedIndexes,O=S.addedIds,x=S.removedIndexes;if(u){for(o=x.length;o--;)D=x[o]-d,p>D&&(D>=0?(g.splice(D,1),p-=1):d-=1);for(r=0,o=C.length;o>r;r+=1)if(D=C[r]-d,0>=D)d+=1;else{if(!(p>D))break;g.splice(D,0,O[r]),p+=1}f=S.total}else this._applyUpdate(_(S)),y.length=0}for(i=d+p,r=0;p>r;r+=1)v[d+r]=g[r];var k=this.get("windowSize"),E=Math.floor(d/k),I=d%k;if(I){for(r=E*k,o=r+I;o>r;r+=1)if(!v[r]){T=!1;break}T?p+=I:(E+=1,p-=k-I)}for(;(p-=k)>=0;)m[E]|=l,E+=1;return p+=k,p&&i===f&&p===f%k&&(m[E]|=l),this.beginPropertyChanges().set("length",f).set("status",h&n?s:h).endPropertyChanges().rangeDidChange(b?0:d,b?Math.max(c,i):i).fire("query:idsLoaded")},sourceWillFetchQuery:function(){var e,i,s,h,l,g,p,v=this.get("windowSize"),m=this._windows,y=this._isAnExplicitIdFetch,w=this._indexOfRequested,_=this._refresh,b=[],D=[],S=this.get("optimiseFetching"),C=(t.meta(this).rangeObservers||[]).map(function(t){return t.range}),O=_&&!this.get("canGetDeltaUpdates"),x=this.get("prefetch");for(this._isAnExplicitIdFetch=!1,this._indexOfRequested=[],this._refresh=!1,e=0,i=m.length;i>e;e+=1)s=m[e],s&(c|d)?(h=!S||T(e,v,x,C),s&d&&(s&=~d,h&&(p=e*v,l&&l.start+l.count===p?l.count+=v:b.push(l={start:p,count:v}),s|=u,s|=f),h||!y?s&=~c:s|=c),s&c&&((h||y)&&(p=e*v,g&&g.start+g.count===p?g.count+=v:D.push(g={start:p,count:v}),s|=u),s&=~c)):O&&(h=T(e,v,x,C),h&&(p=e*v,g&&g.start+g.count===p?g.count+=v:D.push(g={start:p,count:v}))),m[e]=s;return(_||this.is(n))&&this.set("status",(this.get("status")|o)&~(a|r)),{ids:D,records:b,indexOf:w,refresh:_,callback:function(){this._windows=this._windows.map(function(t){return t&~(u|f)}),this.set("status",this.get("status")&~o)}.bind(this)}}});t.WindowedRemoteQuery=D}(O),function(t,e){var i=function(t,e){switch(typeof t){case"string":return e===String;case"boolean":return e===Boolean;case"number":return e===Number}return t instanceof e},n=t.Class({__setupProperty__:function(e,i,n){var s,r=e.attrs;e.hasOwnProperty("attrs")||(r=e.attrs=r?Object.create(r):{}),this.isPrimaryKey&&(n.constructor.primaryKey=i,s=e.dependents,e.hasOwnProperty("dependents")||(s=e.dependents=t.clone(s),e.allDependents={}),(s[i]||(s[i]=[])).push("id")),r[this.key||i]=i},__teardownProperty__:function(t,e){t.attrs[this.key||e]=null},init:function(e){t.extend(this,e)},isProperty:!0,isVolatile:!1,isSilent:!0,noSync:!1,Type:null,isNullable:!0,key:null,isPrimaryKey:!1,willSet:function(t,e,n){if(!n.get("isEditable"))return!1;if(null===t){if(!this.isNullable)return!1}else if(this.Type&&!i(t,this.Type))throw new Error("Incorrect value type for record attribute");return!0},defaultValue:e,validate:null,validityDependencies:null,call:function(i,n,s){var r,o,a,h,c,u=i.get("store"),l=i.get("storeKey"),d=l?u.getData(l):i._data;if(d){if(r=this.key||s,a=d[r],n!==e&&this.willSet(n,s,i))return o=n&&n.toJSON?n.toJSON():n,t.isEqual(o,a)||(l?(h={},h[r]=o,u.updateData(l,h,!(this.noSync||i._noSync)),u.fire("record:user:update",{record:this})):(d[r]=o,i.computedPropertyDidChange(s),this.validate&&i.get("errorForAttribute").set(s,this.validate(n,s,i)))),n;c=this.Type}return a!==e?null!==a&&c&&c.fromJSON?c.fromJSON(a):a:this.defaultValue}});t.RecordAttribute=n,t.Record.attr=function(t,e){return e||(e={}),t&&!e.Type&&(e.Type=t),new n(e)}}(O),function(t){var e=Array.prototype.slice,i=t.Class({Extends:t.ObservableArray,init:function(t,e,n,s){this.record=t,this.propKey=e,this.Type=s,this.store=t.get("store"),this._updatingStore=!1,i.parent.init.call(this,n&&n.slice()),t.addObserverForKey(e,this,"updateListFromRecord")},destroy:function(){this.get("record").removeObserverForKey(this.get("propKey"),this,"updateListFromRecord"),i.parent.destroy.call(this)},toJSON:function(){return this._array.slice()},updateListFromRecord:function(){if(!this._updatingStore){var t=this.get("record"),e=this.get("propKey"),i=t[e].getRaw(t,e);this.set("[]",i?i.slice():[])}},getObjectAt:function(t){var e=i.parent.getObjectAt.call(this,t);return e?this.get("store").getRecord(this.get("Type"),"#"+e):null},setObjectAt:function(t,e){return this.replaceObjectsAt(t,1,[e]),this},replaceObjectsAt:function(t,n,s){s=s?e.call(s):[];var r=this.get("record"),o=this.get("propKey"),a=this.get("Type"),h=this.get("store"),c=i.parent.replaceObjectsAt.call(this,t,n,s.map(function(t){return t.get("storeKey")})).map(function(t){return h.getRecord(a,"#"+t)});return this._updatingStore=!0,r[o].setRaw(r,o,this._array.slice()),this._updatingStore=!1,c},add:function(t){var e=this._array.indexOf(t.get("storeKey"));return-1===e&&this.replaceObjectsAt(this.get("length"),0,[t]),this},remove:function(t){var e=this._array.indexOf(t.get("storeKey"));return e>-1&&this.replaceObjectsAt(e,1),this}}),n=t.Class({Extends:t.RecordAttribute,Type:Array,recordType:null,call:function(t,e,s){var r="_"+s+"RecordArray";return t[r]||(t[r]=new i(t,s,n.parent.call.call(this,t,void 0,s),this.recordType))},getRaw:function(t,e){return n.parent.call.call(this,t,void 0,e)},setRaw:function(t,e,i){return n.parent.call.call(this,t,i,e)}});t.ToManyAttribute=n,t.Record.toMany=function(t){return new n(t)}}(O),function(t,e){var i=t.Class({Extends:t.RecordAttribute,willSet:function(t,e,n){if(i.parent.willSet.call(this,t,e,n)){if(t&&!t.get("storeKey"))throw new Error("O.ToOneAttribute: Cannot set connection to record not saved to store.");return!0}return!1},call:function(t,e,n){var s=i.parent.call.call(this,t,e,n);return s&&"string"==typeof s&&(s=t.get("store").getRecord(this.Type,"#"+s)),s||null}});t.ToOneAttribute=i,t.Record.toOne=function(t){return new i(t)}}(O),function(t){var e=function(t,e){this.type=t,this.explanation=e};e.REQUIRED=1,e.TOO_SHORT=2,e.TOO_LONG=4,e.INVALID_CHAR=8,e.FIRST_CUSTOM_ERROR=16,t.ValidationError=e}(O),function(t){var e=t.Class({Extends:t.Object,fetchRecord:function(){return!1},fetchAllRecords:function(){return!1},refreshRecord:function(t,e,i){return this.fetchRecord(t,e,i)},fetchQuery:function(){return!1},commitChanges:function(){return!1}});t.Source=e}(O),function(t){var e=t.Class({Extends:t.Source,init:function(t){this.sources=[],e.parent.init.call(this,t)},addSource:function(t){return t.set("store",this.get("store")),this.get("sources").push(t),this},removeSource:function(t){return this.get("sources").erase(t),this},storeWasSet:function(){var t=this.get("store");this.sources.forEach(function(e){e.set("store",t)})}.observes("store"),fetchRecord:function(t,e,i){return this.get("sources").some(function(n){return n.fetchRecord(t,e,i)})},fetchAllRecords:function(t,e,i){return this.get("sources").some(function(n){return n.fetchAllRecords(t,e,i)})},refreshRecord:function(t,e,i){return this.get("sources").some(function(n){return n.refreshRecord(t,e,i)})},commitChanges:function(t,e){var i,n=0;return e&&(i=function(){(n-=1)||e()}),this.get("sources").forEach(function(e){e.commitChanges(t,i)&&(n+=1)}),this},fetchQuery:function(t,e){return this.get("sources").some(function(i){return i.fetchQuery(t,e)})}});t.AggregateSource=e}(O),function(t){var e=1,i=2,n=4,s=8,r=16,o=32,a=64,h=128,c=256,u=t.Status,l="O.Store Error: Cannot create existing record",d="O.Store Error: Cannot write to unready record",f="O.Store Error: Record loaded which has status destroyed or non-existent",g="O.Store Error: Source committed a create on a record not marked new",p="O.Store Error: Source commited a destroy on a record not marked destroyed",v=1,m=function(){return"k"+v++},y=function(t,e){return t(this._skToData[e],this,e)},w=function(t,e,i){var n=this._skToData,s=t(n[e],n[i],this);return s||~~e.slice(1)-~~i.slice(1)},_=t.isEqual,b=t.guid,T=t.RunLoop.invoke.bind(t.RunLoop),D={},S=function(e){var i,n,s,r,o,a=b(e),h=D[a];if(!h){i=e.prototype,n=t.meta(i).attrs,h=[];for(s in n)r=n[s],o=i[r],o instanceof t.ToOneAttribute&&h.push([s,1,o.Type]),o instanceof t.ToManyAttribute&&h.push([s,0,o.recordType]);D[a]=h}return h},C=function(t,e,i){return t.getStoreKey(e,i)},O=function(t,e,i){var n,s,r,o,a,h;for(n=0,s=e.length;s>n;n+=1)r=e[n],o=r[0],a=r[2],o in i&&(h=i[o],i[o]=h&&(1===r[1]?C(t,a,h):h.map(C.bind(null,t,a))))},x=function(t,e){return t.getIdFromStoreKey(e)||"#"+e},k=function(e,i,n){var s,r,o,a,h,c=S(i),u=n;for(s=0,r=c.length;r>s;s+=1)o=c[s],a=o[0],a in n&&(u===n&&(u=t.clone(n)),h=n[a],u[a]=h&&(1===o[1]?x(e,h):h.map(x.bind(null,e))));return u},E=t.Class({Mixin:t.EventTarget,autoCommit:!0,rebaseConflicts:!0,isNested:!1,init:function(e){this._skToRecord={},this._skToData={},this._skToStatus={},this._skToType={},this._typeToSkToId={},this._typeToIdToSk={},this._skToChanged={},this._skToCommitted={},this._skToRollback={},this._skToLastAccess={},this._created={},this._destroyed={},this._idToQuery={},this._liveQueries={},this._remoteQueries=[],this._queryTypesNeedRefresh=[],this._nestedStores=[],this._typeToChangedSks={},this._typeToStatus={},this._typeToClientState={},this._typeToServerState={},this._commitCallbacks=[],t.extend(this,e),e.source.set("store",this)},addNested:function(t){return this._nestedStores.push(t),this},removeNested:function(t){return this._nestedStores.erase(t),this},getStoreKey:function(t,e){var i=b(t),n=this._typeToIdToSk[i]||(this._typeToIdToSk[i]={}),s=this._typeToSkToId[i]||(this._typeToSkToId[i]={}),r=e&&n[e];return r||(r=m(),this._skToType[r]=t,s[r]=e,e&&(n[e]=r)),r},getIdFromStoreKey:function(t){var e=this._skToType[t];return e&&(this._typeToSkToId[b(e)]||{})[t]},getRecordStatus:function(t,i){var n=this._typeToIdToSk[b(t)];return n?this.getStatus(n[i]):e},getRecord:function(t,i,n){if(!t||!i)return null;var s="#"===i.charAt(0)?i.slice(1):this.getStoreKey(t,i),r=this.materialiseRecord(s,t);return n||this.getStatus(s)!==e||this.fetchData(s),this._skToLastAccess[s]=Date.now(),r},getOne:function(t,e){var i=this.findOne(t,e);return i?this.materialiseRecord(i,t):null},getAll:function(e,i,n){var s=this.findAll(e,i,n);return new t.RecordArray(this,e,s)},hasChanges:function(){var t;for(t in this._created)return!0;for(t in this._skToChanged)return!0;for(t in this._destroyed)return!0;return!1},commitChanges:function(e){e&&this._commitCallbacks.push(e),t.RunLoop.queueFn("middle",this._commitChanges,this)},_commitChanges:function(){this.fire("willCommit");var t,e,i,n,s,r,c,u,l,d=this._created,f=this._destroyed,g=this._skToData,p=this._skToStatus,v=this._skToType,m=this._typeToSkToId,y=this._skToChanged,w=this._skToCommitted,_=this._skToRollback,D=this._typeToClientState,S=this._typeToStatus,C={},O={},x={},E=this._commitCallbacks,I={},V=function(t){var e,i,n=b(t),s=x[n];return s||(e=t.primaryKey||"id",i=t.prototype[e].key||e,s=x[n]={primaryKey:i,create:{storeKeys:[],records:[]},update:{storeKeys:[],records:[],changes:[]},destroy:{storeKeys:[],ids:[]},state:D[n]},S[n]|=o,I[n]=t),s};for(t in d)r=p[t],i=v[t],e=g[t],e=k(this,i,e),c=V(i).create,c.storeKeys.push(t),c.records.push(e),this.setStatus(t,r&~h|o);for(t in y)r=p[t],i=v[t],e=g[t],n=y[t],r&o?C[t]=n:(_[t]=w[t],delete w[t],e=k(this,i,e),u=V(i).update,u.storeKeys.push(t),u.records.push(e),u.changes.push(n),this.setStatus(t,r&~h|o));for(t in f)r=p[t],i=v[t],s=m[b(i)][t],r&a?O[t]=1:(l=V(i).destroy,l.storeKeys.push(t),l.ids.push(s),this.setStatus(t,r&~h|o));this._skToChanged=C,this._created={},this._destroyed=O,this._commitCallbacks=[],this.source.commitChanges(x,function(){E.forEach(T);for(var t in I)S[t]&=~o,this._checkServerStatus(I[t])}.bind(this)),this.fire("didCommit")},discardChanges:function(){var t,e=this._created,i=this._destroyed,n=this._skToChanged,s=this._skToCommitted;for(t in e)this.destroyRecord(t);for(t in n)this.updateData(t,s[t],!0);for(t in i)this.undestroyRecord(t);return this._created={},this._destroyed={},this},getInverseChanges:function(){var e,i,n=this._created,s=this._destroyed,r=this._skToType,o=this._skToData,a=this._skToChanged,h=this._skToCommitted,c={create:[],update:[],destroy:[]};for(e in n)c.destroy.push(e);for(e in a)i=r[e],c.update.push([e,Object.filter(h[e],a[e])]);for(e in s)i=r[e],c.create.push([e,i,t.clone(o[e])]);return c},applyChanges:function(t){var e,i,n,s,r,o,a,h=t.create,c=t.update,u=t.destroy;for(n=0,s=h.length;s>n;n+=1)e=h[n],r=e[0],o=e[1],a=e[2],this.undestroyRecord(r,o,a);for(n=0,s=c.length;s>n;n+=1)i=c[n],r=i[0],a=i[1],this.updateData(r,a,!0);for(n=0,s=u.length;s>n;n+=1)r=u[n],this.destroyRecord(r)},getTypeStatus:function(t){return this._typeToStatus[b(t)]||e},getTypeState:function(t){return this._typeToClientState[b(t)]||null},getStatus:function(t){return this._skToStatus[t]||e},setStatus:function(t,e){var n=this.getStatus(t),s=this._skToRecord[t];return n!==e&&(this._skToStatus[t]=e,(n^e)&i&&this._recordDidChange(t),s&&s.propertyDidChange("status",n,e),this._nestedStores.forEach(function(i){i.parentDidChangeStatus(t,n,e)})),this},setRecordForStoreKey:function(t,e){return this._skToRecord[t]=e,this},materialiseRecord:function(t,e){return this._skToRecord[t]||(this._skToRecord[t]=new e(this,t))},mayUnloadRecord:function(t){var e=this._skToRecord[t],n=this.getStatus(t);return n&(o|a|h)||n&i&&e&&e.hasObservers()?!1:this._nestedStores.every(function(e){return e.mayUnloadRecord(t)})},willUnloadRecord:function(t){var e=this._skToRecord[t];return e&&e.storeWillUnload(),this._nestedStores.forEach(function(e){e.willUnloadRecord(t)}),this},unloadRecord:function(t){if(!this.mayUnloadRecord(t))return!1;this.willUnloadRecord(t);var e=b(this._skToType[t]),i=this._typeToSkToId[e][t];return delete this._skToRecord[t],delete this._skToData[t],delete this._skToStatus[t],delete this._skToType[t],delete this._skToRollback[t],delete this._typeToSkToId[e][t],i&&delete this._typeToIdToSk[e][i],delete this._skToLastAccess[t],!0},createRecord:function(s,r){var o=this.getStatus(s);return o!==e&&o!==n?(t.RunLoop.didError({name:l,message:"\nStatus: "+(Object.keyOf(u,o)||o)+"\nData: "+JSON.stringify(r)}),this):(this._created[s]=1,this._skToData[s]=r||{},this.setStatus(s,i|a|h),this.autoCommit&&this.commitChanges(),this)},destroyRecord:function(t){var e=this.getStatus(t);return e===(i|a|h)?(delete this._created[t],this.setStatus(t,n),this.unloadRecord(t)):e&i&&(e&h&&(this.setData(t,this._skToCommitted[t]),delete this._skToCommitted[t],delete this._skToChanged[t],this.isNested&&delete this._skToData[t]),this._destroyed[t]=1,this.setStatus(t,n|h|e&(o|a|c)),this.autoCommit&&this.commitChanges()),this},undestroyRecord:function(t,s,u){var l,d,f=this.getStatus(t);f===e||f===n?(l=s.primaryKey||"id",d=s.prototype[l].key||l,delete u[d],this._skToType[t]=s,this.createRecord(t,u)):(f&~(c|r))===(n|o)?this.setStatus(t,i|a|o):f&n&&(delete this._destroyed[t],this.setStatus(t,f&~(n|h)|i))},sourceStateDidChange:function(t,e){var i,n=b(t),s=this._typeToClientState[n],a=this._remoteQueries,h=a.length;if(s&&e!==s)if(this._typeToStatus[n]&(r|o))this._typeToServerState[n]=e;else{for(;h--;)i=a[h],i.get("Type")===t&&i.setObsolete();this.fetchAll(t,!0)}return this},_checkServerStatus:function(t){var e=b(t),i=this._typeToServerState[e];i&&(delete this._typeToServerState[e],this.sourceStateDidChange(t,i))},fetchAll:function(t,e){var i=b(t),n=this._typeToStatus[i],s=this._typeToClientState[i];return n&r||s&&!e||(this.source.fetchAllRecords(t,s,function(){this._typeToStatus[i]&=~r,this._checkServerStatus(t)}.bind(this)),this._typeToStatus[i]=n|r),this},fetchData:function(t){var i=this.getStatus(t);if(i&(r|a|n|s))return this;var o=this._skToType[t],h=b(o),u=this._typeToSkToId[h][t];return i&e?(this.source.fetchRecord(o,u),this.setStatus(t,e|r)):(this.source.refreshRecord(o,u),this.setStatus(t,i&~c|r)),this},getData:function(t){return this._skToData[t]},setData:function(t,e){if(this.getStatus(t)&i)this.updateData(t,e,!1);else{var n=Object.keys(e);this._skToData[t]=e,this._notifyRecordOfChanges(t,n),this._nestedStores.forEach(function(e){e.parentDidSetData(t,n)})}return this},updateData:function(e,n,s){var r,o,c,l,f,g,p=this.getStatus(e),v=this._skToData,m=this._skToCommitted,y=this._skToChanged,w=v[e],b=[],T=!1;if(!(p&i))return r=this._skToType[e],t.RunLoop.didError({name:d,message:"\nStatus: "+(Object.keyOf(u,p)||p)+"\nData: "+JSON.stringify(n)}),!1;if(this.isNested&&!v.hasOwnProperty(e)&&(v[e]=w=t.clone(w)),s&&p!==(i|a|h)){f=m[e]||(m[e]=t.clone(w)),g=y[e]||(y[e]={});for(o in n)c=n[o],l=w[o],_(c,l)||(w[o]=c,b.push(o),g[o]=!_(c,f[o]),T=T||g[o]);if(!T)for(o in g)if(g[o]){T=!0;break}T?(this.setStatus(e,p|h),this.autoCommit&&this.commitChanges()):(this.setStatus(e,p&~h),delete m[e],delete y[e],this.isNested&&delete v[e])}else for(o in n)c=n[o],l=w[o],_(c,l)||(w[o]=c,b.push(o));return this._notifyRecordOfChanges(e,b),this._nestedStores.forEach(function(t){t.parentDidUpdateData(e,b)}),this._recordDidChange(e),!0},revertData:function(t){var e=this._skToCommitted[t];return e&&this.updateData(t,e,!0),this},_notifyRecordOfChanges:function(e,i){var n,s,r,o,a,h=this._skToRecord[e],c=i.length;if(h){for(n=t.meta(h).attrs,h.beginPropertyChanges();c--;){if(s=i[c],r=n[s],!r){if("id"!==s)continue;r=s}o=h[r],h.computedPropertyDidChange(r),o.validate&&(a||(a=h.get("errorForAttribute")),a.set(r,o.validate(h.get(r),r,h)))}h.endPropertyChanges()}return this},sourceDidFetchRecords:function(s,a,c,l){for(var d,g,p,v,m,y=b(s),w=this._typeToClientState,_=a.length,T=s.primaryKey||"id",D=s.prototype[T].key||T,C=Date.now(),x={},k={},E=S(s);_--;)g=a[_],p=g[D],x[p]=!0,v=this.getStoreKey(s,p),m=this.getStatus(v),E.length&&O(this,E,g),m&i?k[p]=g:m&n&&m&(h|o)?(this._skToData[v]=g,this.setStatus(v,m&~r)):(m&e||(t.RunLoop.didError({name:f,message:"\nStatus: "+(Object.keyOf(u,m)||m)+"\nId: "+p}),this.setStatus(v,e)),this.setData(v,g),this.setStatus(v,i),this._skToLastAccess[v]=C);if(l){var I=this._typeToIdToSk[b(s)],V=[];for(p in I)x[p]||V.push(p);V.length&&this.sourceDidDestroyRecords(s,V)}return this.sourceDidFetchPartialRecords(s,k,!0),c&&(d=w[y],!l&&d&&d!==c?this.sourceStateDidChange(s,c):w[y]=c),this._typeToStatus[y]|=i,t.RunLoop.queueFn("middle",this.liveQueriesAreReady.bind(this,s)),this},sourceDidFetchPartialRecords:function(e,n,s){var o,a,u,l,d,f=b(e),g=this._skToData,p=this._skToStatus,v=this._typeToIdToSk[f]||{},m=this._typeToSkToId[f]||{},y=this._skToChanged,w=this._skToCommitted,T=e.primaryKey||"id",D=e.prototype[T].key||T,C=s?[]:S(e);for(o in n)if(a=v[o],u=p[a],l=n[o],u&i)if(u&c)this.setStatus(a,u&~r),this.fetchData(a);else{if(C.length&&O(this,C,l),u&h){if(l=t.extend(w[a],l),this.rebaseConflicts){var x,k=g[a],E=y[a],I={},V={},R=!0;for(x in k)x in E?(_(k[x],l[x])||(V[x]=!0,R=!1),I[x]=k[x]):I[x]=l[x];if(!R){y[a]=V,w[a]=l,this.setData(a,I),this.setStatus(a,i|h);continue}}delete y[a],delete w[a]}d=l[D],d&&d!==o&&(m[a]=d,delete v[o],v[d]=a),this.updateData(a,l,!1),this.setStatus(a,i)}return this},sourceCouldNotFindRecords:function(t,i){for(var r,o,a=i.length,c=this._skToCommitted,u=this._skToChanged;a--;)r=this.getStoreKey(t,i[a]),o=this.getStatus(r),o&e?this.setStatus(r,s):(o&h&&(this.setData(r,c[r]),delete c[r],delete u[r]),this.setStatus(r,n),this.unloadRecord(r));return this},sourceDidFetchUpdates:function(t,e,i,n,s){var r=b(t);return this._typeToClientState[r]===n?(e&&this.sourceDidModifyRecords(t,e),i&&this.sourceDidDestroyRecords(t,i),this._typeToClientState[r]=s):this.sourceStateDidChange(t,s),this},sourceDidModifyRecords:function(t,e){for(var n,s,r=this._skToStatus,o=this._typeToIdToSk[b(t)]||{},a=e.length;a--;)n=o[e[a]],s=r[n],s&i&&this.setStatus(n,s|c);return this},sourceDidDestroyRecords:function(t,e){for(var i,s=e.length;s--;)i=this.getStoreKey(t,e[s]),this.setStatus(i,n),this.unloadRecord(i);return this},sourceCommitDidChangeState:function(t,e,i){var n=b(t),s=this._typeToClientState;return s[n]===e?s[n]=i:(delete this._typeToServerState[n],this.sourceStateDidChange(t,i)),this},sourceDidCommitCreate:function(e){var i,n,s,r,h,c,u,l,d=this._skToType,f=this._typeToSkToId,p=this._typeToIdToSk;for(i in e)n=this.getStatus(i),n&a?(s=e[i],r=d[i],h=b(r),c=r.primaryKey||"id",u=r.prototype[c].key||c,l=s[u],f[h][i]=l,p[h][l]=i,this.updateData(i,s,!1),this.setStatus(i,n&~(o|a))):t.RunLoop.didError({name:g});return this.autoCommit&&this.commitChanges(),this},sourceDidNotCreate:function(t,e,s){for(var r,o,c=t.length,u=this._skToCommitted,l=this._skToChanged,d=this._created;c--;)r=t[c],o=this.getStatus(r),o&n?(this.setStatus(r,n),this.unloadRecord(r)):(o&h&&(delete u[r],delete l[r]),this.setStatus(r,i|a|h),d[r]=1,e&&s&&!this._notifyRecordOfError(r,s[c])&&this.destroyRecord(r));return this.autoCommit&&this.commitChanges(),this},sourceDidCommitUpdate:function(t){for(var i,n,s=t.length,r=this._skToRollback;s--;)i=t[s],n=this.getStatus(i),delete r[i],n!==e&&this.setStatus(i,n&~o);return this.autoCommit&&this.commitChanges(),this},sourceDidNotUpdate:function(t,s,r){for(var a,c,u,l,d,f,g=t.length,p=this._skToData,v=this._skToChanged,m=this._skToCommitted,y=this._skToRollback;g--;)if(a=t[g],c=this.getStatus(a),c&n&&y[a]&&(p[a]=y[a],delete y[a]),c&i){u=m[a]=y[a],delete y[a],f={},l=p[a],delete v[a];for(d in l)_(l[d],u[d])||(f[d]=!0,v[a]=f);v[a]?this.setStatus(a,c&~o|h):this.setStatus(a,c&~o),s&&r&&!this._notifyRecordOfError(a,r[g])&&this.revertData(a)}else c!==e&&this.setStatus(a,c&~o);return this.autoCommit&&this.commitChanges(),this},sourceDidCommitDestroy:function(e){for(var s,r,c=e.length;c--;)s=e[c],r=this.getStatus(s),(r&~h)===(i|a|o)?(r&h&&(delete this._skToCommitted[s],delete this._skToChanged[s]),this.setStatus(s,i|a|h),this._created[s]=1):r&n?(this.setStatus(s,n),this.unloadRecord(s)):t.RunLoop.didError({name:p});return this.autoCommit&&this.commitChanges(),this},sourceDidNotDestroy:function(e,s,r){for(var c,u,l=e.length,d=this._destroyed;l--;)c=e[l],u=this.getStatus(c),(u&~h)===(i|a|o)?this.setStatus(c,u&~(o|a)):u&n?(this.setStatus(c,u&~o|h),d[c]=1,s&&r&&!this._notifyRecordOfError(c,r[l])&&this.undestroyRecord(c)):t.RunLoop.didError({name:p});return this.autoCommit&&this.commitChanges(),this},_notifyRecordOfError:function(e,i){var n,s=this._skToRecord[e],r=!1;return s&&(n=new t.Event(i.type||"error",s,i),s.fire("record:commit:error",n),r=n.defaultPrevented),this._nestedStores.forEach(function(t){r=t._notifyRecordOfError(e,i)||r}),r},findAll:function(t,e,n){var s,r,o,a=this._typeToSkToId[b(t)]||{},h=this._skToStatus,c=[];for(s in a)h[s]&i&&c.push(s);return e&&(r=y.bind(this,e),c=c.filter(r),c.filterFn=r),n&&(o=w.bind(this,n),c.sort(o),c.sortFn=o),c},findOne:function(t,e){var n,s=this._typeToSkToId[b(t)]||{},r=this._skToStatus,o=e&&y.bind(this,e);for(n in s)if(r[n]&i&&(!o||o(n)))return n;return null},addQuery:function(e){var i=this.source;if(this._idToQuery[e.get("id")]=e,e instanceof t.LiveQuery){var n=e.get("Type"),s=b(n);this.fetchAll(n),(this._liveQueries[s]||(this._liveQueries[s]=[])).push(e)}else e instanceof t.RemoteQuery&&(i.fetchQuery(e),this._remoteQueries.push(e));return this},removeQuery:function(e){if(delete this._idToQuery[e.get("id")],e instanceof t.LiveQuery){var i=this._liveQueries,n=b(e.get("Type")),s=i[n];s.length>1?s.erase(e):delete i[n]}else e instanceof t.RemoteQuery&&this._remoteQueries.erase(e);return this},getQuery:function(e,i,n){var s=e&&this._idToQuery[e]||null;return!s&&i&&(s=new i(t.extend(n||{},{id:e,store:this,source:this.source}))),s&&(s.lastAccess=Date.now()),s},getAllRemoteQueries:function(){return this._remoteQueries},_recordDidChange:function(e){var i=b(this._skToType[e]),n=this._typeToChangedSks,s=n[i]||(n[i]={});s[e]=!0,t.RunLoop.queueFn("middle",this.refreshLiveQueries,this)},refreshLiveQueries:function(){var t,e,i,n,s=this._typeToChangedSks,r=this._liveQueries;this._typeToChangedSks={};for(t in s){for(e=Object.keys(s[t]),i=r[t],n=i?i.length:0;n--;)i[n].storeDidChangeRecords(e);this.fire(t,{storeKeys:e})}return this},liveQueriesAreReady:function(t){for(var e=this._liveQueries[b(t)],n=e?e.length:0;n--;)e[n].set("status",i)}});["on","once","off"].forEach(function(e){E.prototype[e]=function(i,n,s){return"string"!=typeof i&&(i=b(i)),t.EventTarget[e].call(this,i,n,s)}}),t.Store=E}(O),function(t){var e=t.Class({init:function(e,i,n){this._index=0,this._store=e,this._restrictions=i,this.isPaused=!1,this.frequency=n||3e4,t.RunLoop.invokeAfterDelay(this.cleanup,this.frequency,this)},cleanup:function(){var e,i=this._index,n=this._restrictions[i],s=n.Type,r=s,o=n.max,a=n.afterCleanup;if(this.isPaused)return void t.RunLoop.invokeAfterDelay(this.cleanup,this.frequency,this);do{if(r===t.Record){e=this.cleanupRecordType(s,o);break}if(r===t.RemoteQuery){e=this.cleanupQueryType(s,o);break}}while(r=r.parent.constructor);a&&a(e),this._index=i=(i+1)%this._restrictions.length,i?t.RunLoop.invokeInNextEventLoop(this.cleanup,this):t.RunLoop.invokeAfterDelay(this.cleanup,this.frequency,this)},cleanupRecordType:function(e,i){var n,s,r=this._store,o=r._skToLastAccess,a=r._skToData,h=Object.keys(r._typeToSkToId[t.guid(e)]||{}),c=h.length,u=c-i,l=[];for(h.sort(function(t,e){return o[e]-o[t]});u>0&&c--;)s=h[c],n=a[s],r.unloadRecord(s)&&(u-=1,n&&l.push(n));return l},cleanupQueryType:function(t,e){var i,n=this._store.getAllRemoteQueries().filter(function(e){return e instanceof t}),s=n.length,r=s-e,o=[];for(n.sort(function(t,e){return e.lastAccess-t.lastAccess});r>0&&s--;)i=n[s],i.hasObservers()||(i.destroy(),o.push(i),r-=1);return o}});t.MemoryManager=e}(O),function(t){var e=1,i=2,n=4,s=16,r=32,o=64,a=128,h=256,c=t.Class({Extends:t.Store,autoCommit:!1,isNested:!0,init:function(t){this._skToRecord={},this._skToData=Object.create(t._skToData),this._skToStatus=Object.create(t._skToStatus),this._skToType=t._skToType,this._typeToSkToId=t._typeToSkToId,this._typeToIdToSk=t._typeToIdToSk,this._skToChanged={},this._skToCommitted={},this._skToRollback={},this._skToLastAccess=t._skToLastAccess,this._created={},this._destroyed={},this._idToQuery={},this._liveQueries={},this._remoteQueries=[],this._queryTypesNeedRefresh=[],this._nestedStores=[],this._typeToChangedSks={},this._typeToStatus=t._typeToStatus,t.addNested(this),this._source=t._source,this._parentStore=t},destroy:function(){this._parentStore.removeNested(this)},commitChanges:function(t){this.fire("willCommit");var c,u,l,d=this._created,f=this._destroyed,g=this._skToData,p=this._skToChanged,v=this._parentStore;for(c in d)u=v.getStatus(c),l=g[c],u===e||u===n?v.createRecord(c,l):(u&~(h|s))===(n|r)?(v._skToData[c]=l,v.setStatus(c,i|o|r)):u&n&&(delete v._destroyed[c],v._skToData[c]=l,v.setStatus(c,u&~(n|a)|i));for(c in p)v.updateData(c,Object.filter(g[c],p[c]),!0);for(c in f)v.destroyRecord(c);return this._skToData=Object.create(v._skToData),this._skToStatus=Object.create(v._skToStatus),this._skToChanged={},this._skToCommitted={},this._created={},this._destroyed={},t&&t(),this.fire("didCommit")},discardChanges:function(){c.parent.discardChanges.call(this);var t=this._parentStore;return this._skToData=Object.create(t._skToData),this._skToStatus=Object.create(t._skToStatus),this},getStatus:function(t){var i=this._skToStatus[t]||e;return this._skToData.hasOwnProperty(t)?i:i&~(o|r|a)},fetchAll:function(t){return this._parentStore.fetchAll(t),this},fetchData:function(t){return this._parentStore.fetchData(t),this},parentDidChangeStatus:function(t,e,c){var u=this._skToStatus;if(e&=~(o|r|a),c&=~(o|r|a),u.hasOwnProperty(t)&&(e=u[t],c&n?(e&n||(this.setData(t,this._skToCommitted[t]),delete this._skToCommitted[t],delete this._skToChanged[t]),delete this._skToData[t],delete u[t]):u[t]=c=e|c&(h|s)),e!==c){(e^c)&i&&this._recordDidChange(t);var l=this._skToRecord[t];l&&l.propertyDidChange("status",e,c),this._nestedStores.forEach(function(i){i.parentDidChangeStatus(t,e,c)})}},parentDidSetData:function(t,e){this._notifyRecordOfChanges(t,e),this._nestedStores.forEach(function(i){i.parentDidSetData(t,e)})},parentDidUpdateData:function(e,i){if(this._skToData.hasOwnProperty(e)){var n,s,h=this._skToData,c=this._skToChanged,u=this._skToCommitted,l=this._parentStore,d=this.rebaseConflicts,f=l.getData(e),g=h[e],p=c[e],v={},m={},y=!0;i=[];for(s in g)n=!t.isEqual(g[s],f[s]),d&&s in p?(n&&(m[s]=!0,y=!1),v[s]=g[s]):(n&&i.push(s),v[s]=f[s]);if(!y)return c[e]=m,u[e]=t.clone(f),void this.setData(e,v);
this.setStatus(e,l.getStatus(e)&~(o|r|a)),delete h[e],delete c[e],delete u[e],delete this._skToStatus[e]}this._notifyRecordOfChanges(e,i),this._nestedStores.forEach(function(t){t.parentDidUpdateData(e,i)}),this._recordDidChange(e)},sourceStateDidChange:null,sourceDidFetchRecords:null,sourceDidFetchPartialRecords:null,sourceCouldNotFindRecords:null,sourceDidFetchUpdates:null,sourceDidModifyRecords:null,sourceDidDestroyRecords:null,sourceCommitDidChangeState:null,sourceDidCommitCreate:null,sourceDidNotCreate:null,sourceDidCommitUpdate:null,sourceDidNotUpdate:null,sourceDidCommitDestroy:null,sourceDidNotDestroy:null});t.NestedStore=c}(O),function(t){var e=t.Class({Extends:t.Object,init:function(t){this._undoStack=[],this._redoStack=[],this._isInUndoState=!1,this.canUndo=!1,this.canRedo=!1,this.maxUndoCount=1,e.parent.init.call(this,t)},_pushState:function(t,e){for(t.push(e);t.length>this.maxUndoCount;)t.shift();this._isInUndoState=!0},dataDidChange:function(){return this._isInUndoState=!1,this._redoStack.length=0,this.set("canRedo",!1).set("canUndo",!0).fire("input")},saveUndoCheckpoint:function(){if(!this._isInUndoState){var t=this.getUndoData();null!==t?this._pushState(this._undoStack,t):(this._isInUndoState=!0,this.set("canUndo",!!this._undoStack.length))}return this},undo:function(){if(this.get("canUndo"))if(this._isInUndoState){var t=this.applyChange(this._undoStack.pop(),!1);t&&this._pushState(this._redoStack,t),this.set("canUndo",!!this._undoStack.length).set("canRedo",!!t).fire("undo")}else this.saveUndoCheckpoint(),this.undo();return this},redo:function(){return this.get("canRedo")&&(this._pushState(this._undoStack,this.applyChange(this._redoStack.pop(),!0)),this.set("canUndo",!0).set("canRedo",!!this._redoStack.length).fire("redo")),this},getUndoData:function(){},applyChange:function(){}}),i=t.Class({Extends:e,init:function(t){i.parent.init.call(this,t),this.get("store").on("willCommit",this,"saveUndoCheckpoint").on("record:user:create",this,"dataDidChange").on("record:user:update",this,"dataDidChange").on("record:user:destroy",this,"dataDidChange")},destroy:function(){this.get("store").off("willCommit",this,"saveUndoCheckpoint").off("record:user:create",this,"dataDidChange").off("record:user:update",this,"dataDidChange").off("record:user:destroy",this,"dataDidChange"),i.parent.destroy.call(this)},getUndoData:function(){var t=this.get("store");return t.hasChanges()?t.getInverseChanges():null},applyChange:function(t){var e,i=this.get("store");return i.applyChanges(t),e=i.getInverseChanges(),i.commitChanges(),e},undo:function(){return(this._isInUndoState||!this.get("store").hasChanges())&&i.parent.undo.call(this),this}});t.UndoManager=e,t.StoreUndoManager=i}(O),function(t,e){var i=0,n=0,s=1,r=2,o=4,a=8,h=16,c="-moz-user-select"===t.UA.cssProps["user-select"]?"-moz-none":"none",u=function(t){return t.render().get("layer")},l=t.Class({Extends:t.Object,syncOnlyInDocument:!0,init:function(t){this._needsRedraw=null,this.id="v"+i++,this.parentView=null,this.isRendered=!1,this.isInDocument=!1,l.parent.init.call(this,t);for(var e=this.get("childViews")||(this.childViews=[]),n=e.length;n--;)e[n].set("parentView",this);this.get("syncOnlyInDocument")&&this.suspendBindings()},destroy:function(){if(this.get("isInDocument"))throw new Error("Cannot destroy a view in the document");for(var t=this.get("childViews"),e=t.length;e--;)t[e].destroy();this.get("isRendered")&&this.willDestroyLayer(this.get("layer")),this.clearPropertyCache(),l.parent.destroy.call(this)},className:e,layerTag:"div",layer:function(){var i=t.Element.create(this.get("layerTag"),{id:this.get("id"),className:this.get("className"),style:Object.toCSSString(this.get("layerStyles")),unselectable:this.get("allowTextSelection")?e:"on"});return this.didCreateLayer(i),i}.property(),didCreateLayer:function(){},willDestroyLayer:function(){this.set("isRendered",!1)},willEnterDocument:function(){this.get("syncOnlyInDocument")&&this.resumeBindings(),this._needsRedraw&&this.redraw();var t,e=this.get("childViews");for(t=0;t<e.length;t+=1)e[t].willEnterDocument();return this},didEnterDocument:function(){this._needsRedraw&&t.RunLoop.queueFn("render",this.redraw,this),this.set("isInDocument",!0),t.ViewEventsController.registerActiveView(this),this.computedPropertyDidChange("pxLayout");var e,i=this.get("childViews");for(e=0;e<i.length;e+=1)i[e].didEnterDocument();return this},willLeaveDocument:function(){this.set("isInDocument",!1),t.ViewEventsController.deregisterActiveView(this);for(var e=this.get("childViews"),i=e.length;i--;)e[i].willLeaveDocument();return this},didLeaveDocument:function(){for(var t=this.get("childViews"),e=t.length;e--;)t[e].didLeaveDocument();return this.get("syncOnlyInDocument")&&this.suspendBindings(),this},nextEventTarget:function(){return this.get("parentView")}.property("parentView"),handleEvent:function(e){t.ViewEventsController.handleEvent(e)},isDraggable:!1,allowTextSelection:!1,_cancelTextSelection:function(t){this.get("allowTextSelection")||t.preventDefault(),t.stopPropagation()}.on("selectstart"),positioning:"relative",layout:{},layerStyles:function(){var i=this.get("allowTextSelection");return t.extend({position:this.get("positioning"),cursor:i?"auto":e,userSelect:i?"text":c},this.get("layout"))}.property("layout","allowTextSelection","positioning"),render:function(){if(!this.get("isRendered")){this.get("syncOnlyInDocument")&&this.resumeBindings(),this.set("isRendered",!0);var e=t.Element,i=e.forView(this),n=this.get("layer"),s=this.draw(n,e,e.create);s&&e.appendChildren(n,s),e.forView(i)}return this},draw:function(){return this.get("childViews").map(u)},propertyNeedsRedraw:function(e,i,n){if(this.get("isRendered")){var s,r,o=this._needsRedraw||(this._needsRedraw=[]);for(s=0,r=o.length;r>s;s+=1)if(o[s][0]===i)return this;o[r]=[i,n],this.get("isInDocument")&&t.RunLoop.queueFn("render",this.redraw,this)}return this}.observes("className","layerStyles"),redraw:function(){var t,e,i,n,s=this._needsRedraw;if(s&&!this.isDestroyed&&this.get("isRendered"))for(t=this.get("layer"),this._needsRedraw=null,e=0,i=s.length;i>e;e+=1)n=s[e],this["redraw"+n[0].capitalise()](t,n[1]);return this},redrawLayer:function(e){for(var i,n,s=t.Element,r=s.forView(this),o=this.get("childViews"),a=o.length;a--;)n=o[a],this.removeView(n),n.destroy();for(;i=e.lastChild;)e.removeChild(i);s.appendChildren(e,this.draw(e,s,s.create)),s.forView(r)},redrawClassName:function(t){t.className=this.get("className")},redrawLayerStyles:function(t){t.style.cssText=Object.toCSSString(this.get("layerStyles")),this.didResize()},parentViewDidResize:function(){this.get("isInDocument")&&this.didResize()},didResize:function(){this.computedPropertyDidChange("pxLayout");for(var t=this.get("childViews"),e=t.length;e--;)t[e].parentViewDidResize()},scrollTop:0,scrollLeft:0,pxLayout:function(){return{top:this.get("pxTop"),left:this.get("pxLeft"),width:this.get("pxWidth"),height:this.get("pxHeight")}}.property(),pxTop:function(){if(!this.get("isInDocument"))return 0;var t=this.get("parentView").get("layer"),e=t.offsetParent,i=this.get("layer"),n=0;do{if(i===e){n-=t.offsetTop;break}n+=i.offsetTop}while(i&&(i=i.offsetParent)!==t);return n}.property("pxLayout"),pxLeft:function(){if(!this.get("isInDocument"))return 0;var t=this.get("parentView").get("layer"),e=t.offsetParent,i=this.get("layer"),n=0;do{if(i===e){n-=t.offsetLeft;break}n+=i.offsetLeft}while(i&&(i=i.offsetParent)!==t);return n}.property("pxLayout"),pxWidth:function(){return this.get("isInDocument")?this.get("layer").offsetWidth:0}.property("pxLayout"),pxHeight:function(){return this.get("isInDocument")?this.get("layer").offsetHeight:0}.property("pxLayout"),visibleRect:function(){return{x:this.get("scrollLeft"),y:this.get("scrollTop"),width:this.get("pxWidth"),height:this.get("pxHeight")}}.property("scrollLeft","scrollTop","pxLayout"),getPositionRelativeTo:function(e){e.syncBackScroll&&e.syncBackScroll();var i=t.Element.getPosition,n=i(this.get("layer")),s=i(e.get("layer"));return n.top-=s.top-e.get("scrollTop"),n.left-=s.left-e.get("scrollLeft"),n},insertView:function(t,e,i){var n,s,r,o,a,h=t.get("parentView"),c=this.get("childViews");return h===this?this:e||"before"!==i&&"after"!==i?(h&&h.removeView(t),t.set("parentView",this),e instanceof l?(n=c.indexOf(e),n=n>-1?"before"===i?n:n+1:c.length,c.splice(n,0,t),e=e.get("layer")):"top"===i?c.unshift(t):c.push(t),this.get("isRendered")&&(e||(e=this.get("layer"),("before"===i||"after"===i)&&(i="")),s=this.get("isInDocument"),o="before"===i||"after"===i?e.parentNode:e,a="before"===i?e:"top"===i?e.firstChild:"after"===i?e.nextSibling:null,r=t.render().get("layer"),s&&t.willEnterDocument(),a?o.insertBefore(r,a):o.appendChild(r),s&&t.didEnterDocument()),this.propertyDidChange("childViews"),this):(this.get("parentView").insertView(t,this,i),this)},replaceView:function(t,e){if(t===e)return this;var i=this.get("childViews"),n=i.indexOf(e),s=t.get("parentView");if(-1===n)return this;if(s&&s.removeView(t),t.set("parentView",this),i.setObjectAt(n,t),this.get("isRendered")){var r=this.get("isInDocument"),o=e.get("layer");t.render(),r&&(e.willLeaveDocument(),t.willEnterDocument()),o.parentNode.replaceChild(t.get("layer"),o),r&&(t.didEnterDocument(),e.didLeaveDocument())}return e.set("parentView",null),this.propertyDidChange("childViews"),this},removeView:function(t){var e,i,n=this.get("childViews"),s=n.lastIndexOf(t);return-1===s?this:(this.get("isRendered")&&(e=this.get("isInDocument"),i=t.get("layer"),e&&t.willLeaveDocument(),i.parentNode.removeChild(i),e&&t.didLeaveDocument()),n.splice(s,1),t.set("parentView",null),this.propertyDidChange("childViews"),this)},detach:function(){var t=this.get("parentView");return t&&t.removeView(this),this},compareViewTreePosition:function(t){if(this===t)return n;for(var e,i,c,u,l,d=this,f=[d],g=[t],p=d;p=p.get("parentView");){if(p===t)return h;f.push(p)}for(p=t;p=p.get("parentView");){if(p===d)return a;g.push(p)}for(e=f.length,i=g.length;e--&&i--;)if((d=f[e])!==(t=g[i])){if(p=f[e+1]){for(c=p.get("childViews"),u=c.length;u--;){if(l=c[u],l===t)return r;if(l===d)return o}break}return s}return s},getParent:function(t){var e=this;do e=e.get("parentView");while(e&&!(e instanceof t));return e||null}});l.LAYOUT_FILL_PARENT={top:0,left:0,bottom:0,right:0},l.POSITION_SAME=n,l.POSITION_DISCONNECTED=s,l.POSITION_PRECEDING=r,l.POSITION_FOLLOWING=o,l.POSITION_CONTAINS=a,l.POSITION_CONTAINED_BY=h,l.peekId=function(){return"v"+i},t.View=l}(O),function(t){var e=t.Class({Extends:t.View,syncOnlyInDocument:!1,layer:null,init:function(t,i){e.parent.init.call(this,i);var n,s,r=9===t.nodeType,o=r?t:t.ownerDocument,a=o.defaultView;for(n=["click","mousedown","mouseup","dblclick","keypress","keydown","keyup","dragstart","selectstart","touchstart","touchmove","touchend","touchcancel","cut"],s=n.length;s--;)t.addEventListener(n[s],this,!1);for(n=["focus","blur","change","input"],s=n.length;s--;)t.addEventListener(n[s],this,!0);for(n=["resize","orientationchange","scroll"],s=n.length;s--;)a.addEventListener(n[s],this,!1);this.isRendered=!0,this.isInDocument=!0,this.layer=r?t.body:t},_onScroll:function(t){var e=this.get("layer"),i="BODY"===e.nodeName,n=e.ownerDocument,s=n.defaultView,r=n.documentElement,o=i?s.pageXOffset||r.scrollLeft||0:e.scrollLeft,a=i?s.pageYOffset||r.scrollTop||0:e.scrollTop;this.beginPropertyChanges().set("scrollLeft",o).set("scrollTop",a).endPropertyChanges(),t.stopPropagation()}.on("scroll"),preventRootScroll:t.UA.isIOS?function(e){var i,n,s=e.targetView,r=t.ScrollView;s instanceof r||s.getParent(r)||(i=this.layer.ownerDocument,n=i.defaultView,this.get("pxHeight")<=n.innerHeight&&!/^(?:INPUT|TEXTAREA)$/.test(i.activeElement.nodeName)&&e.preventDefault())}.on("touchmove"):null,hideAddressBar:function(){window.scrollTo(0,0)},focus:function(){var e=this.get("layer"),i=e.ownerDocument.activeElement,n=t.ViewEventsController.getViewFromNode(i);n instanceof t.AbstractControlView?n.blur():i.blur&&i.blur()},pxTop:0,pxLeft:0,handleEvent:function(e){switch(e.type){case"mousedown":this.get("layer").ownerDocument.addEventListener("mousemove",this,!1);break;case"mouseup":this.get("layer").ownerDocument.removeEventListener("mousemove",this,!1);break;case"orientationchange":this.hideAddressBar();case"resize":return void this.didResize();case"scroll":return void this._onScroll(e)}t.ViewEventsController.handleEvent(e,null,this)}.invokeInRunLoop()});t.RootView=e}(O),function(t){var e=function(t,e){var i=t[0];return e>i?-1:i>e?1:0},i={_activeViews:{},registerActiveView:function(t){return this._activeViews[t.get("id")]=t,this},deregisterActiveView:function(t){return delete this._activeViews[t.get("id")],this},getViewFromNode:function(t){for(var e=this._activeViews,i=t.ownerDocument,n=null;!n&&t&&t!==i;)n=e[t.id],t=t.parentNode;return n},_eventTargets:[],addEventTarget:function(t,i){i||(i=0);for(var n=this._eventTargets,s=n.binarySearch(i,e),r=n.length;r>s&&n[s][0]===i;)s+=1;return n.splice(s,0,[i,t]),this},removeEventTarget:function(t){for(var e=this._eventTargets,i=e.length;i--;)e[i][1]===t&&e.splice(i,1);return this},handleEvent:function(t,e,i){var n,s=this._eventTargets,r=s.length;for(e||(e=this.getViewFromNode(t.target)||i),t.targetView=e;r--&&(n=s[r][1],n===this&&(n=e),!n||(n.fire(t.type,t),!t.propagationStopped)););}.invokeInRunLoop()};i.addEventTarget(i,0),t.ViewEventsController=i}(O),O.DragEffect={NONE:0,COPY:1,MOVE:2,LINK:4,ALL:7,DEFAULT:8,effectToString:["none","copy","move","copyMove","link","copyLink","linkMove","all",""]},function(t){var e=0,i=1,n=2,s=4,r=i|n|s,o=8,a=t.DragEffect.effectToString,h=t.Class({Extends:t.Object,init:function(t){var e=t.event;this._dragCursor=null,this._stylesheet=null,this._scrollBounds=null,this._scrollView=null,this._scrollBy=null,this._scrollInterval=null,this._lastTargetView=null,this.isNative=!1,this.dragSource=null,this.allowedEffects=r,this.dataSource=null,this.dropTarget=null,this.dropEffect=o,this.cursorPosition=this.startPosition={x:e.clientX,y:e.clientY},this.defaultCursor="default",this.dragImage=null,h.parent.init.call(this,t),this._setCursor(!0),this.startDrag()},dragImageOffset:{x:5,y:5},_dragImageDidChange:function(e,i,n,s){if(this.isNative){var r=this.get("dragImageOffset");this.event.dataTransfer.setDragImage(s,r.x,r.y)}else{var o=this._dragCursor;o?n&&o.removeChild(n):(o=this._dragCursor=t.Element.create("div",{style:"position: fixed; z-index: 9999;"}),this._updateDragImagePosition(),document.body.appendChild(o)),o.appendChild(s)}}.observes("dragImage"),_updateDragImagePosition:function(){var t,e,i=this._dragCursor;i&&(t=this.get("cursorPosition"),e=this.get("dragImageOffset"),i.style.left=t.x+Math.max(e.x,5)+"px",i.style.top=t.y+Math.max(e.y,5)+"px")}.queue("render").observes("cursorPosition","dragImageOffset"),_setCursor:function(n){var r=this._stylesheet,o=this.get("defaultCursor");if(r&&(r.parentNode.removeChild(r),r=null),n){switch(this.get("dropEffect")){case e:o="no-drop";break;case i:o="copy";break;case s:o="alias"}r=t.Stylesheet.create("o-drag-cursor","*{cursor:default !important;cursor:"+o+" !important;}")}this._stylesheet=r}.observes("defaultCursor","dropEffect"),dataTypes:function(){var t=this.get("dataSource")||this.get("dragSource");if(t&&t.get("isDragDataSource"))return t.get("dragDataTypes");if(this.isNative){var e,i,n,s=this.event.dataTransfer,r=s.items,o=[],a=!1;if(r){for(e=r.length;e--;)i=r[e],n=i.type,a||(a="file"===i.kind),n&&o.include(n);return a&&o.push("Files"),o}if(s.types)return Array.prototype.slice.call(s.types)}return[]}.property(),hasDataType:function(t){return-1!==this.get("dataTypes").indexOf(t)},getFiles:function(t){var e,i,n,s,r,o=[],a=this.event.dataTransfer;if(a)if(e=a.items){for(i=0,n=e.length;n>i;i+=1)if(s=e[i],r=s.type,"file"===s.kind){if(!r){if(s.getAsEntry&&!s.getAsEntry().isFile)continue;if(s.webkitGetAsEntry&&!s.webkitGetAsEntry().isFile)continue}(!t||t.test(r))&&o.push(s.getAsFile())}}else if(e=a.files)for(i=0,n=e.length;n>i;i+=1)s=e[i],r=s.type,!s.size||t&&!t.test(r)||o.push(s);return o},getDataOfType:function(t,e){var i=this.get("dataSource")||this.get("dragSource"),n=!1;if(i&&i.get("isDragDataSource"))e(i.getDragDataOfType(t,this)),n=!0;else if(this.isNative){var s,r,o,a=this.event.dataTransfer,h=a.items;if(h){for(s=0,r=h.length;r>s;s+=1)if(o=h[s],o.type===t){o.getAsString(e),n=!0;break}}else a.getData&&(e(a.getData(t)),n=!0)}return n||e(null),this},startDrag:function(){t.DragController.register(this),this.fire("dragStarted");var e,i,n,s,r,o=this.get("dragSource");return o&&(o.set("isDragging",!0).dragStarted(this),e=o.get("allowedDragEffects"),this.set("allowedEffects",e),this.isNative&&(i=this.event.dataTransfer,n=this.get("dataSource")||o,s=!1,i.effectAllowed=a[this.get("allowedEffects")],n.get("isDragDataSource")&&n.get("dragDataTypes").forEach(function(t){t.contains("/")&&(r=n.getDragDataOfType(t,this),i.items?i.items.add(r,t):i.setData&&i.setData(t,r),s=!0)}),s||i.setData("x-private",""))),this},endDrag:function(){var e=this.get("dropTarget"),i=this.get("dragSource");return e&&e.dropExited(this),i&&i.set("isDragging",!1).dragEnded(this),this._dragCursor&&(document.body.removeChild(this._dragCursor),this._dragCursor=null),this._scrollInterval&&(t.RunLoop.cancel(this._scrollInterval),this._scrollInterval=null),this._setCursor(!1),this.fire("dragEnded"),t.DragController.deregister(this),this},move:function(t){this.event=t;var e,i,n=t.targetView;return n||(n=this.get("dropTarget")),this.set("cursorPosition",{x:e=t.clientX,y:i=t.clientY}),this._check(n,e,i),this._update(n),this},_check:function(e,i,n){var s,r,o,a=this._scrollBounds,h=this._scrollView,c=15;(!a||i<a.l||i>a.r||n<a.t||n>a.b)&&(a=null,e&&this._lastTargetView!==e&&(this._lastTargetView=h=e,h instanceof t.ScrollView||(h=h.getParent(t.ScrollView)),h&&(s=h.get("layer").getBoundingClientRect(),a={l:s.left-c,r:s.right+c,t:s.top-c,b:s.bottom+c},r=Math.min(75,s.right-s.left>>2),o=Math.min(75,s.bottom-s.top>>2),a.hl=a.l+r,a.hr=a.r-r,a.ht=a.t+o,a.hb=a.b-o),this._scrollView=h,this._scrollBounds=a)),this._scrollInterval&&(t.RunLoop.cancel(this._scrollInterval),this._scrollInterval=null),a&&(r=i<a.hl?-10:i>a.hr?10:0,o=n<a.ht?-10:n>a.hb?10:0,(r||o)&&(this._scrollBy={x:r,y:o},this._scrollInterval=t.RunLoop.invokePeriodically(this._scroll,100,this)))},_scroll:function(){var e=this._scrollView,i=this._scrollBy;if(e.scrollBy(i.x,i.y)){var n=this.get("cursorPosition"),s=document.elementFromPoint(n.x,n.y);s&&this._update(t.ViewEventsController.getViewFromNode(s))}},_update:function(t){for(var e=this.get("dropTarget"),i=this.get("dragSource");t&&!(t===e||t.get("isDropTarget")&&t.willAcceptDrag(this));)t=t.get("parentView")||null;t!==e&&(e&&e.dropExited(this),t&&t.dropEntered(this),e=t,this.set("dropTarget",t)),e&&e.dropMoved(this),i&&i.dragMoved(this)},drop:function(t){this.event=t;var i=this.dropEffect;return this.dropTarget&&i!==e&&i!==o&&this.dropTarget.drop(this),this}});t.Drag=h}(O),function(t){function e(e){var i=e.clientX,n=e.clientY,s=document.elementFromPoint(i,n)||e.target;this.touch=e,this.clientX=i,this.clientY=n,this.target=s,this.targetView=t.ViewEventsController.getViewFromNode(s)}var i={BUTTON:1,INPUT:1,OPTION:1,SELECT:1,TEXTAREA:1},n=t.DragEffect.effectToString,s=t.DragEffect.DEFAULT,r=function(t,e){for(var i,n=t.changedTouches,s=n.length;s--;)if(i=n[s],i.identifier===e)return i;return null},o=new t.Object({_x:0,_y:0,_targetView:null,_ignore:!0,_touchId:null,_drag:null,register:function(t){this._drag&&this._drag.endDrag(),this._drag=t},deregister:function(t){this._drag===t&&(this._drag=null,this._touchId=null)},getNearestDragView:function(t){for(;t&&!t.get("isDraggable");)t=t.get("parentView")||null;return t},handleEvent:function(t){this.fire(t.type,t)}.invokeInRunLoop(),_onMousedown:function(t){t.button||t.metaKey||t.ctrlKey||(i[t.target.nodeName]?this._ignore=!0:(this._x=t.clientX,this._y=t.clientY,this._targetView=t.targetView,this._ignore=!1))}.on("mousedown"),_onMousemove:function(e){var i=this._drag;if(i&&!this._touchId)i.get("isNative")||i.move(e),e.stopPropagation();else if(!this._ignore){var n,s=e.clientX-this._x,r=e.clientY-this._y;s*s+r*r>25&&(n=this.getNearestDragView(this._targetView),n&&new t.Drag({dragSource:n,event:e,startPosition:{x:this._x,y:this._y}}),this._ignore=!0)}}.on("mousemove"),_onMouseup:function(t){this._ignore=!0,this._targetView=null;var e=this._drag;e&&!this._touchId&&e.drop(t).endDrag()}.on("mouseup"),_onHold:function(n){var s=n.touch,r=new e(s),o=this.getNearestDragView(r.targetView);o&&!i[r.target.nodeName]&&(this._drag=new t.Drag({dragSource:o,event:r}),this._touchId=s.identifier)}.on("hold"),_onTouchmove:function(t){var i,n=this._touchId;n&&(i=r(t,n),i&&(this._drag.move(new e(i)),t.preventDefault(),t.stopPropagation()))}.on("touchmove"),_onTouchend:function(t){var i,n=this._touchId;n&&(i=r(t,n),i&&this._drag.drop(new e(i)).endDrag())}.on("touchend"),_onTouchcancel:function(t){var e,i=this._touchId;i&&(e=r(t,i),e&&this._drag.endDrag())}.on("touchcancel"),_onDragstart:function(e){for(var i=e.target,n=!1;i&&i.getAttribute;){if("true"===i.getAttribute("draggable")){n=!0;break}i=i.parentNode}n?new t.Drag({dragSource:this.getNearestDragView(e.targetView),event:e,isNative:!0}):e.preventDefault()}.on("dragstart"),_onDragover:function(e){var i,r=this._drag,o=e.dataTransfer,a=!0;if(e.targetView||(e.targetView=t.ViewEventsController.getViewFromNode(e.target)),r){var h=e.clientX,c=e.clientY;this._x===h&&this._y===c?a=!1:(this._x=h,this._y=c)}else r=new t.Drag({event:e,isNative:!0,allowedEffects:n.indexOf(o.effectAllowed)});a&&r.move(e),i=r.get("dropEffect"),i!==s&&(o.dropEffect=n[i&r.get("allowedEffects")],e.preventDefault())}.on("dragover"),_nativeRefCount:0,_onDragenter:function(){this._nativeRefCount+=1}.on("dragenter"),_onDragleave:function(){var t=this._drag;!(this._nativeRefCount-=1)&&t&&t.endDrag()}.on("dragleave"),_onDrop:function(t){var e=this._drag;e&&(e.get("dropEffect")!==s&&t.preventDefault(),e.drop(t).endDrag())}.on("drop"),_onDragend:function(){var t=this._drag;t&&t.endDrag()}.on("dragend"),_escCancel:function(e){var i=this._drag;i&&"esc"===t.DOMEvent.lookupKey(e)&&i.endDrag()}.on("keydown")});["dragover","dragenter","dragleave","drop","dragend"].forEach(function(t){document.addEventListener(t,o,!1)}),t.ViewEventsController.addEventTarget(o,20),t.DragController=o}(O),function(t){t.DragDataSource={init:function(t){t||(t={}),this._dragData=t,this.dragDataTypes=Object.keys(t),this.get=function(t){return this[t]}},isDragDataSource:!0,allowedDragEffects:t.DragEffect.ALL,dragDataTypes:[],getDragDataOfType:function(t){return this._dragData[t]}}}(O),function(t){t.Draggable={isDraggable:!0,isDragging:!1,dragStarted:function(){},dragMoved:function(){},dragEnded:function(){}}}(O),function(t){t.DropTarget={isDropTarget:!0,hasDragOver:!1,dropEffect:t.DragEffect.MOVE,dropAcceptedDataTypes:{},willAcceptDrag:function(t){for(var e=this.get("dropAcceptedDataTypes"),i=t.get("dataTypes"),n=i.length;n--;)if(e[i[n]])return!0;return!1},dropEntered:function(t){t.set("dropEffect",this.get("dropEffect")),this.set("hasDragOver",!0)},dropMoved:function(){},dropExited:function(e){e.set("dropEffect",t.DragEffect.DEFAULT),this.set("hasDragOver",!1)},drop:function(){}}}(O),function(t){var e="file:"===location.protocol,i=function(t){for(var e,i,n={},s=0;;){for(;/\s/.test(t.charAt(s));)s+=1;if(e=t.indexOf(":",s),0>e)break;for(i=t.slice(s,e),s=e+1;" "===t.charAt(s);)s+=1;for(e=t.indexOf("\n",s),0>e&&(e=t.length);e>s&&/\s/.test(t.charAt(e-1));)e-=1;n[i]=t.slice(s,e),s=e+1}return n},n=t.Class({makeAsyncRequests:!0,init:function(t){var e=new XMLHttpRequest;this._isRunning=!1,this._status=0,this.io=t||null,this.xhr=e,e.upload&&(e.upload.addEventListener("progress",this,!1),e.addEventListener("progress",this,!1))},destroy:function(){this.abort();var t=this.xhr;t.upload&&(t.upload.removeEventListener("progress",this,!1),t.removeEventListener("progress",this,!1))},isRunning:function(){return!!this._isRunning},getHeader:function(t){var e;try{e=this.xhr.getResponseHeader(t)}catch(i){}return e||""},getResponse:function(){var t="";try{t=this.xhr.responseText}catch(e){}return t||""},getResponseType:function(){return this.getHeader("Content-type")},getStatus:function(){return this._status},send:function(t,e,i,n){this._isRunning&&this.abort(),this._isRunning=!0;var s,r=this.xhr,o=this.io,a=this;r.open(t,e,this.makeAsyncRequests);for(s in n||{})"Content-type"===s&&i instanceof FormData||r.setRequestHeader(s,n[s]);return r.onreadystatechange=function(){a._xhrStateDidChange(this)},r.send(i),o&&o.fire("io:begin"),this},_xhrStateDidChange:function(t){var n,s,r,o,a,h,c=t.readyState,u=this.io;if(!(3>c)&&this._isRunning){if(3===c)return void(u&&u.set("uploadProgress",100).fire("io:loading"));this._isRunning=!1,t.onreadystatechange=function(){},n=t.status,this._status=n=1223===n?204:!n&&e?200:n,u&&(s=t.getAllResponseHeaders(),r=!!s&&n>=200&&300>n,o=i(s),a=this.getResponseType(),h=this.getResponse(),u.set("uploadProgress",100).set("progress",100).set("status",n).set("responseHeaders",o).set("responseType",a).set("response",h).fire(r?"io:success":"io:failure",{status:n,headers:o,type:a,data:h}).fire("io:end"))}}.invokeInRunLoop(),handleEvent:function(t){var e,i=this.io;i&&"progress"===t.type&&(e=t.target===this.xhr?"progress":"uploadProgress",i.set(e,Math.min(99,~~(t.loaded/t.total*100))).fire("io:"+e,t))}.invokeInRunLoop(),abort:function(){if(this._isRunning){this._isRunning=!1;var t=this.xhr,e=this.io;t.abort(),t.onreadystatechange=function(){},e&&e.fire("io:abort").fire("io:end")}return this}});t.XHR=n}(O),function(t,e){var i=0,n=1,s=2,r=e?t.Class({Extends:t.Object,url:"",init:function(e){this._then=0,this._tick=null,this.readyState=s,r.parent.init.call(this,e);var i,n=["open","message","error"],o=t.meta(this).observers;for(i in o)/^__event__/.test(i)&&n.include(i.slice(9));this._eventTypes=n},on:function(t){var e=this._eventTypes,i=this._eventSource;-1===e.indexOf(t)&&(e.push(t),i&&i.addEventListener(t,this,!1)),r.parent.on.apply(this,arguments)},handleEvent:function(t){this.set("readyState",this._eventSource.readyState),this.fire(t.type,t)}.invokeInRunLoop(),_check:function(){var e=Date.now();e-this._then>67500?this.fire("restart").close().open():(this._then=e,this._tick=t.RunLoop.invokeAfterDelay(this._check,6e4,this),this.set("readyState",this._eventSource.readyState))},_startStopCheck:function(){var e=this._tick;this.get("readyState")!==s?e||(this._then=Date.now(),this._check()):e&&(t.RunLoop.cancel(e),this._tick=null)}.observes("readyState"),open:function(){if(this.get("readyState")===s){var t=this._eventSource=new e(this.get("url"));this._eventTypes.forEach(function(e){t.addEventListener(e,this,!1)},this),this.set("readyState",t.readyState)}return this},close:function(){return this.set("readyState",s)},_sourceDidClose:function(){if(this.get("readyState")===s){var t=this._eventSource,e=this._eventTypes,i=e.length;for(t.close();i--;)t.removeEventListener(e[i],this,!1);this._eventSource=null}}.observes("readyState")}):t.Class({Extends:t.Object,readyState:i,init:function(e){r.parent.init.call(this,e),this._xhr=new t.XHR(this)},open:function(){var t={Accept:"text/event-stream","Cache-Control":"no-cache"};return this._lastEventId&&(t["Last-Event-ID"]=this._lastEventId),this._poll&&(t["X-Nginx-PushStream-Mode"]="long-polling"),this.set("readyState",i),this._data="",this._eventName="",this._processedIndex=0,this._lastNewLineIndex=0,this._xhr.send("GET",this.get("url"),null,t),this},close:function(){return this.get("readyState")!==s&&(this._xhr.abort(),this.set("readyState",s)),this},_reconnectAfter:3e4,_lastEventId:"",_poll:!!t.UA.msie&&t.UA.msie<10,_dataDidArrive:function(){var t=this._xhr,e=t.getResponseType();e&&e.indexOf("text/event-stream")?this._failConnection():(this._openConnection(),this._processData(t.getResponse()))}.on("io:loading"),_requestDidSucceed:function(t){this._openConnection(),this._processData(t.data+"\n\n"),this._reconnect()}.on("io:success"),_requestDidFail:function(){this._failConnection()}.on("io:failure"),_openConnection:function(){this.get("readyState")===i&&this.set("readyState",n).fire("open")},_failConnection:function(){this.close().fire("error")},_reconnect:function(){this._poll?this.open():t.RunLoop.invokeAfterDelay(this.open,this._reconnectAfter,this)},_processData:function(t){var e,i=this._lastNewLineIndex,n=/\u000d\u000a?|\u000a/g;for(i||"\ufeff"!==t.charAt(0)||(i=1),n.lastIndex=this._processedIndex;e=n.exec(t);)this._processLine(t.slice(i,e.index)),i=n.lastIndex;this._lastNewLineIndex=i,this._processedIndex=t.length},_processLine:function(t){if(/^\s*$/.test(t))this._dispatchEvent();else{var e=t.indexOf(":"),i=t,n="";if(!e)return;switch(e>0&&(i=t.slice(0,e),n=t.slice(" "===t.charAt(e+1)?e+2:e+1)),i){case"event":this._eventName=n;break;case"data":this._data+=n+"\n";break;case"id":this._lastEventId=n;break;case"retry":/^\d+$/.test(n)&&(this._reconnectAfter=parseInt(n,10))}}},_dispatchEvent:function(){var t=this._data,e=this._eventName;t&&("\n"===t.slice(-1)&&(t=t.slice(0,-1)),this.fire(e||"message",{data:t,lastEventId:this._lastEventId})),this._data="",this._eventName=""}});r.extend({CONNECTING:i,OPEN:n,CLOSED:s}),t.EventSource=r}(O,"undefined"!=typeof EventSource?EventSource:null),function(t){var e={position:"absolute",top:-1e3,left:-1e3};t.FormUploader=window.FormData?t.XHR:t.Class({io:null,init:function(t){this._isSuccess=!1,this._isRunning=!1,this._response="",this.io=t||null},isRunning:function(){return this._isRunning},getResponse:function(){return this._response},getResponseType:function(){return"application/json"},getStatus:function(){return this._isRunning?0:this._isSuccess?200:400},send:function(i,n,s){if(!(s instanceof window.FormData))throw new Error("IFrameTransport only sends FormData objects");this._isRunning&&this.abort(),this._isRunning=!0,this._isSuccess=!1,this._response="";var r=this,o=document.body,a=this._transactionId="upload"+Date.now(),h="frame-"+a,c=this._iframe=t.Element.create("iframe",{id:h,name:h,styles:e}),u=this._form=s.form;return n+=(n.contains("?")?"&":"?")+"callback=top."+a,u.action=this._targetUrl=n,u.target=h,c.addEventListener("load",this._loadfn=function(){r._formFrameDidLoad()},!1),window[a]=function(t){var e=200,i="application/json",n=JSON.stringify(t),s=r.io;r._response=n,r._isSuccess=!0,s&&s.set("uploadProgress",100).set("progress",100).set("status",e).set("responseType",i).set("response",n).fire("io:success",{status:e,headers:{},type:i,data:n}).fire("io:end")}.invokeInRunLoop(),o.appendChild(c),o.appendChild(u),u.submit(),this},_formFrameDidLoad:function(){var t,e;try{t=this._iframe.contentWindow.location.href}catch(i){}"about:blank"!==t&&(this._isRunning=!1,this._isSuccess||(e=this.io,e.set("uploadProgress",100).set("progress",100).set("status",400).fire("io:failure",{status:400,headers:{},type:"",data:""}).fire("io:end")),this._complete())}.invokeInRunLoop(),abort:function(){return this._isRunning&&(this._isRunning=!1,this._complete(),this.io.fire("io:abort").fire("io:end")),this},_complete:function(){var t=document.body;t.removeChild(this._form),t.removeChild(this._iframe),this._iframe.removeEventListener("load",this._loadfn,!1),window[this._transactionId]=null,this._iframe=this._form=this._loadfn=null}}),window.FormData||(window.FormData=t.Class({init:function(){this.form=t.Element.create("form",{method:"post",enctype:"multipart/form-data",styles:e})},append:function(e,i){if("string"==typeof i)this.form.appendChild(t.Element.create("input",{type:"hidden",name:e,value:i}));else{var n=i.file;n.nodeType&&(n.name=e,this.form.appendChild(n))}}}),window.FormData.isFake=!0)}(O),function(t){var e=[],i=function(){return e.pop()||new t.XHR},n=function(t){e.push(t)},s=t.Class({Extends:t.Object,timeout:0,method:"GET",url:location.pathname,contentType:"application/x-www-form-urlencoded",headers:{Accept:"application/json, */*"},init:function(t){this._transport=null,this._timer=null,this._lastActivity=0,this.uploadProgress=0,this.progress=0,this.status=0,
this.responseType="",this.responseHeaders={},this.response="",s.parent.init.call(this,t)},setTimeout:function(){var e=this.get("timeout");e&&(this._lastActivity=Date.now(),this._timer=t.RunLoop.invokeAfterDelay(this.didTimeout,e,this))}.on("io:begin"),resetTimeout:function(){this._lastActivity=Date.now()}.on("io:uploadProgress","io:loading","io:progress"),clearTimeout:function(){var e=this._timer;e&&t.RunLoop.cancel(e)}.on("io:end"),didTimeout:function(){this._timer=null;var e=this.get("timeout"),i=Date.now()-this._lastActivity,n=e-i;10>n?this.fire("io:timeout").abort():this._timer=t.RunLoop.invokeAfterDelay(this.didTimeout,n,this)},send:function(){var e,n=this.get("method").toUpperCase(),s=this.get("url"),r=this.get("data")||null,o=this.get("headers"),a=r instanceof FormData&&t.FormUploader!==t.XHR?new t.FormUploader:i();return r&&"GET"===n&&(s+=(s.contains("?")?"&":"?")+r,r=null),e=o["Content-type"],e&&"POST"===n&&"string"==typeof r&&-1===e.indexOf(";")&&(o["Content-type"]+=";charset=utf-8"),this._transport=a,a.io=this,a.send(n,s,r,o),this},abort:function(){var t=this._transport;t&&t.io===this&&t.abort()},_releaseXhr:function(){var e=this._transport;e instanceof t.XHR&&(n(e),e.io=null,this._transport=null)}.on("io:success","io:failure","io:abort")});t.HttpRequest=s}(O),function(t){var e=1,i=2,n=3,s=t.Class({Extends:t.Object,link:e,maxConnections:1,init:function(t){this._queue=[],this._recent=null,this.activeConnections=0,s.parent.init.call(this,t)},send:function(t){if(this.get("activeConnections")>=this.get("maxConnections"))switch(this.get("link")){case e:this._queue.push(t);case i:return this;case n:this._recent.abort();break;default:throw new Error("Invalid O.IOQueue link type.")}return this.increment("activeConnections",1),t.get("nextEventTarget")||t.set("nextEventTarget",this),this._recent=t.send(),this},abort:function(t){return this._queue.erase(t),t.abort(),this},_complete:function(t){var e=t.target;this._recent===e&&(this._recent=null),e.get("nextEventTarget")===this&&e.set("nextEventTarget",null),this.increment("activeConnections",-1),this._queue.length&&this.send(this._queue.shift())}.on("io:end")});s.QUEUE=1,s.IGNORE=2,s.ABORT=3,t.IOQueue=s}(O),function(t){var e=function(t){var e,i,n,s,r,o,a,h="",c=0,u=0,l=t.length;t:for(;;){if(e=t.indexOf("[",u),-1===e)e=l;else{for(o=e;o--&&"~"===t[o];);if((e-o)%2===0){u=e+1;continue}}if(n=t.slice(c,e).replace(/~(.)/g,"$1"),n&&(h&&(h+="+"),h+='"',h+=n.replace(/\\/g,"\\").replace(/"/g,'\\"'),h+='"'),e===l)break;for(c=u=e+1;;){if(e=t.indexOf("]",u),-1===e){h="";break t}for(o=e;o--&&"~"===t[o];);if((e-o)%2)break;u=e+1}for(i=t.slice(c,e).split(","),a=i.length,h&&(h+="+"),a>1&&(h+='lang.macros["'),r=0;a>r;r+=1){for(r>1&&(h+=","),n=i[r],s=n.length;s&&"~"===n[s-1];)r+=1,n+=",",n+=i[r],s=n.length;n=n.replace(/~(.)/g,"$1"),/^_(?:\*|\d+)$/.test(n)?(n=n.slice(1),h+="args",h+="*"===n?"":"["+(parseInt(n,10)-1)+"]"):r?(h+='"',h+=n.replace(/\\/g,"\\").replace(/"/g,'\\"'),h+='"'):(h+="*"===n?"quant":"#"===n?"numf":n,h+='"].call(lang,')}a>1&&(h+=")"),c=u=e+1}return new Function("lang","args","return "+(h||'""')+";")},i=function(t,e){var i=t+"";return i.length>3&&(i=i.replace(/(\d+?)(?=(?:\d{3})+$)/g,"$1"+e.thousandsSeparator)),i},n=t.Class({init:function(e){["macros","dateFormats"].forEach(function(t){this[t]=Object.create(this[t])},this),this.compiled={},t.merge(this,e)},code:"xx",decimalPoint:".",thousandsSeparator:",",fileSizeUnits:["B","KB","MB","GB"],getFormattedNumber:function(t){var e=t+"",n="",s=e.indexOf(".");return s>-1&&(n=e.slice(s+1),e=e.slice(0,s)),i(e,this)+(n&&this.decimalPoint+n)},getFormattedOrdinal:function(t){return t+"."},getFormattedFileSize:function(t,e){for(var i,n=this.fileSizeUnits,s=n.length-1,r=0,o=1e3;s>r&&t>=o;)t/=o,r+=1;return i=2>r?Math.round(t)+"":t.toFixed(e||0),this.getFormattedNumber(i)+" "+n[r]},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",use24hClock:!0,dateElementOrder:"dmy",dateFormats:{date:"%d/%m/%Y",time:function(t,e,i){return t.format(e.use24hClock?this.time24:this.time12,i)},time12:"%-I:%M %p",time24:"%H:%M",fullDate:"%A, %-d %B %Y",fullDateAndTime:"%A, %-d %B %Y %H:%M",abbreviatedFullDate:"%a, %-d %b %Y",shortDayMonth:"%-d %b",shortDayMonthYear:"%-d %b ’%y"},datePatterns:{},getFormattedDate:function(t,e,i){var n=this.dateFormats,s=n[e]||n.date;return s instanceof Function?n[e](t,this,i):t.format(s,i)},macros:{"*1":function(t,e,n){return(t||void 0===n?e:n).replace("%n",i(t,this))},"*2":function(t,e,n,s){return(1===t?e:t||void 0===s?n:s).replace("%n",i(t,this))},"*2a":function(t,e,n,s){return(t>1?n:t||void 0===s?e:s).replace("%n",i(t,this))},"*2b":function(t,e,n,s){return(t?/(?:[368]|20|30|60|80|[^0]00|0{6,})$/.test(t+"")?e:n:void 0!==s?s:e).replace("%n",i(t,this))},"*3a":function(t,e,n,s){return(t?t%10===1&&t%100!==11?n:s:e).replace("%n",i(t,this))},"*3b":function(t,e,n,s,r){var o=t%100;return(t||void 0===r?1===t?e:!t||o>=1&&19>=o?n:s:r).replace("%n",i(t,this))},"*3c":function(t,e,n,s,r){var o=t%10,a=t%100;return(t||void 0===r?1===o&&11!==a?e:0===o||a>=10&&20>=a?n:s:r).replace("%n",i(t,this))},"*3d":function(t,e,n,s,r){var o=t%10,a=t%100;return(t||void 0===r?1===o&&11!==a?e:o>=2&&4>=o&&(12>a||a>14)?n:s:r).replace("%n",i(t,this))},"*3e":function(t,e,n,s,r){return(t||void 0===r?1===t?e:t>=2&&4>=t?n:s:r).replace("%n",i(t,this))},"*3f":function(t,e,n,s,r){var o=t%10,a=t%100;return(t||void 0===r?1===t?e:o>=2&&4>=o&&(12>a||a>14)?n:s:r).replace("%n",i(t,this))},"*4a":function(t,e,n,s,r,o){var a=t%100;return(t||void 0===o?1===a?e:2===a?n:3===a||4===a?s:r:o).replace("%n",i(t,this))},"*4b":function(t,e,n,s,r,o){return(t||void 0===o?1===t||11===t?e:2===t||12===t?n:t>=3&&19>=t?s:r:o).replace("%n",i(t,this))},"*5":function(t,e,n,s,r,o,a){return(t||void 0===a?1===t?e:2===t?n:t>=3&&6>=t?s:t>=7&&10>=t?r:o:a).replace("%n",i(t,this))},"*6":function(t,e,n,s,r,o,a){var h=t%100;return(t?1===t?n:2===t?s:h>=3&&10>=h?r:h>=11&&99>=h?o:a:e).replace("%n",i(t,this))},quant:function(t,e,i,n){return t||void 0===n?1===t?"1 "+e:t+" "+(i||e+"s"):n},numerate:function(t,e,i){return 1!==t?i||e+"s":e},numf:function(t){var e=(t+"").split(".");return e[0]=e[0].replace(/(\d+?)(?=(?:\d{3})+$)/g,"$1"+this.thousandsSeparator),e.join(this.decimalPoint)},sprintf:function(t){return String.prototype.format.apply(t,Array.prototype.slice.call(arguments,1))}},translations:{},translate:function(t){var i,n,s,r,o,a=this.translations[t],h=!0,c=[];for(void 0===a&&(a=t),i=1,n=arguments.length;n>i;i+=1)s=arguments[i],"object"==typeof s&&(h=!1),c[i-1]=s;if(h)return(r=this.compiled[t]||(this.compiled[t]=e(a)))(this,c);for(o=a.split(/\[_(\d)\]/),i=1,n=o.length;n>i;i+=2)o[i]=c[o[i]-1]||null;return o}});t.Locale=n}(O),function(t,e){var i={xx:new t.Locale({code:"xx"})},n={A:"[AaªÀ-Åà-åĀ-ąǍǎȀ-ȃȦȧᴬᵃḀḁẚẠ-ảₐ℀℁℻⒜Ⓐⓐ㍱-㍴㎀-㎄㎈㎉㎩-㎯㏂㏊㏟㏿Ａａ]",B:"[BbᴮᵇḂ-ḇℬ⒝Ⓑⓑ㍴㎅-㎇㏃㏈㏔㏝Ｂｂ]",C:"[CcÇçĆ-čᶜ℀ℂ℃℅℆ℭⅭⅽ⒞Ⓒⓒ㍶㎈㎉㎝㎠㎤㏄-㏇Ｃｃ]",D:"[DdĎďǄ-ǆǱ-ǳᴰᵈḊ-ḓⅅⅆⅮⅾ⒟Ⓓⓓ㋏㍲㍷-㍹㎗㎭-㎯㏅㏈Ｄｄ]",E:"[EeÈ-Ëè-ëĒ-ěȄ-ȇȨȩᴱᵉḘ-ḛẸ-ẽₑ℡ℯℰⅇ⒠Ⓔⓔ㉐㋍㋎Ｅｅ]",F:"[FfᶠḞḟ℉ℱ℻⒡Ⓕⓕ㎊-㎌㎙ﬀ-ﬄＦｆ]",G:"[GgĜ-ģǦǧǴǵᴳᵍḠḡℊ⒢Ⓖⓖ㋌㋍㎇㎍-㎏㎓㎬㏆㏉㏒㏿Ｇｇ]",H:"[HhĤĥȞȟʰᴴḢ-ḫẖℋ-ℎ⒣Ⓗⓗ㋌㍱㎐-㎔㏊㏋㏗Ｈｈ]",I:"[IiÌ-Ïì-ïĨ-İĲĳǏǐȈ-ȋᴵᵢḬḭỈ-ịⁱℐℑℹⅈⅠ-ⅣⅥ-ⅨⅪⅫⅰ-ⅳⅵ-ⅸⅺⅻ⒤Ⓘⓘ㍺㏌㏕ﬁﬃＩｉ]",J:"[JjĲ-ĵǇ-ǌǰʲᴶⅉ⒥ⒿⓙⱼＪｊ]",K:"[KkĶķǨǩᴷᵏḰ-ḵK⒦Ⓚⓚ㎄㎅㎉㎏㎑㎘㎞㎢㎦㎪㎸㎾㏀㏆㏍-㏏Ｋｋ]",L:"[LlĹ-ŀǇ-ǉˡᴸḶḷḺ-ḽℒℓ℡Ⅼⅼ⒧Ⓛⓛ㋏㎈㎉㏐-㏓㏕㏖㏿ﬂﬄＬｌ]",M:"[MmᴹᵐḾ-ṃ℠™ℳⅯⅿ⒨Ⓜⓜ㍷-㍹㎃㎆㎎㎒㎖㎙-㎨㎫㎳㎷㎹㎽㎿㏁㏂㏎㏐㏔-㏖㏘㏙㏞㏟Ｍｍ]",N:"[NnÑñŃ-ŉǊ-ǌǸǹᴺṄ-ṋⁿℕ№⒩Ⓝⓝ㎁㎋㎚㎱㎵㎻㏌㏑Ｎｎ]",O:"[OoºÒ-Öò-öŌ-őƠơǑǒǪǫȌ-ȏȮȯᴼᵒỌ-ỏₒ℅№ℴ⒪Ⓞⓞ㍵㏇㏒㏖Ｏｏ]",P:"[PpᴾᵖṔ-ṗℙ⒫Ⓟⓟ㉐㍱㍶㎀㎊㎩-㎬㎰㎴㎺㏋㏗-㏚Ｐｐ]",Q:"[Qqℚ⒬Ⓠⓠ㏃Ｑｑ]",R:"[RrŔ-řȐ-ȓʳᴿᵣṘ-ṛṞṟ₨ℛ-ℝ⒭Ⓡⓡ㋍㍴㎭-㎯㏚㏛Ｒｒ]",S:"[SsŚ-šſȘșˢṠ-ṣ₨℁℠⒮Ⓢⓢ㎧㎨㎮-㎳㏛㏜ﬆＳｓ]",T:"[TtŢ-ťȚțᵀᵗṪ-ṱẗ℡™⒯Ⓣⓣ㉐㋏㎔㏏ﬅﬆＴｔ]",U:"[UuÙ-Üù-üŨ-ųƯưǓǔȔ-ȗᵁᵘᵤṲ-ṷỤ-ủ℆⒰Ⓤⓤ㍳㍺Ｕｕ]",V:"[VvᵛᵥṼ-ṿⅣ-Ⅷⅳ-ⅷ⒱Ⓥⓥⱽ㋎㍵㎴-㎹㏜㏞Ｖｖ]",W:"[WwŴŵʷᵂẀ-ẉẘ⒲Ⓦⓦ㎺-㎿㏝Ｗｗ]",X:"[XxˣẊ-ẍₓ℻Ⅸ-Ⅻⅸ-ⅻ⒳Ⓧⓧ㏓Ｘｘ]",Y:"[YyÝýÿŶ-ŸȲȳʸẎẏẙỲ-ỹ⒴Ⓨⓨ㏉Ｙｙ]",Z:"[ZzŹ-žǱ-ǳᶻẐ-ẕℤℨ⒵Ⓩⓩ㎐-㎔Ｚｚ]"},s=i.xx,r={activeLocaleCode:"xx",addLocale:function(t){return i[t.code]=t,this},setLocale:function(t){return i[t]&&(s=i[t],this.activeLocaleCode=t,"undefined"!=typeof Intl&&(this.compare=new Intl.Collator(t,{sensitivity:"base"}).compare)),this},getLocale:function(t){return t?i[t]||null:s},get:function(t){return s[t]},localise:function(t){if(1===arguments.length){var i=s.translations[t];return i!==e?i:t}return s.translate.apply(s,arguments)},date:function(t,e,i){return s.getFormattedDate(t,e,i)},number:function(t){return s.getFormattedNumber(t)},ordinal:function(t){return s.getFormattedOrdinal(t)},fileSize:function(t,e){return s.getFormattedFileSize(t,e)},compare:function(t,e){return t.toLowerCase().localeCompare(e.toLowerCase())},makeSearchRegExp:function(t){return new RegExp("(?:^|\\W)"+t.escapeRegExp().replace(/[A-Z]/gi,function(t){return n[t.toUpperCase()]}),"i")}};t.LocaleController=t.i18n=r,t.loc=r.localise}(O),function(t){var e=Date.formatDuration=function(e,i){var n,s,r,o,a,h=Math.abs(Math.floor(e/1e3));return 60>h?n=t.loc("less than a minute"):3600>h?n=t.loc("[*2,_1,%n minute,%n minutes]",~~(h/60)):86400>h?(i?(o=Math.round(h/3600),a=0):(o=~~(h/3600),a=~~(h/60%60)),n=t.loc("[*2,_1,%n hour,%n hours,] [*2,_2,%n minute,%n minutes,]",o,a)):(i?1814400>h:604800>h)?(i?(r=Math.round(h/86400),o=0):(r=~~(h/86400),o=~~(h/3600%24)),n=t.loc("[*2,_1,%n day,%n days,] [*2,_2,%n hour,%n hours,]",r,o)):(i?(s=Math.round(h/604800),r=0):(s=~~(h/604800),r=~~(h/86400)%7),n=t.loc("[*2,_1,%n week,%n weeks,] [*2,_2,%n day,%n days,]",s,r)),n.trim()};Date.implement({relativeTo:function(i,n){i||(i=new Date);var s,r,o,a=i-this,h=0>a;return h&&(a=-a),864e5>a?s=e(a,n):36288e5>a?(n&&(a=new Date(i.getFullYear(),i.getMonth(),i.getDate())-new Date(this.getFullYear(),this.getMonth(),this.getDate())),s=e(a,n)):(r=i.getFullYear()-this.getFullYear(),o=i.getMonth()-this.getMonth(),h&&(r=-r,o=-o),0>o&&(r-=1,o+=12),s=t.loc("[*2,_1,%n year,%n years,] [*2,_2,%n month,%n months,]",r,o).trim()),h?t.loc("[_1] from now",s):t.loc("[_1] ago",s)}})}(O),function(t){var e=t.Class({init:function(t,e){this.string=t,this.tokens=e||[]},clone:function(){return new e(this.string,this.tokens.slice())},assimilate:function(t){this.string=t.string,this.tokens=t.tokens}});e.define=function(t,e,i){return function(n){var s,r=n.string,o=e.exec(r);return o&&(s=o[0],n.tokens.push([t,s,i||null]),n.string=r.slice(s.length)),!!o}},e.optional=function(t){return function(e){return t(e),!0}},e.not=function(t){return function(e){var i=e.clone();return!t(i)}},e.repeat=function(t,e,i){return i||(i=2147483647),function(n){var s=n.clone(),r=0;do{if(!t(s))break;r+=1}while(i>r);return r>=e?(r&&n.assimilate(s),!0):!1}},e.sequence=function(t){return function(e){for(var i=e.clone(),n=0,s=t.length;s>n;n+=1)if(!t[n](i))return!1;return e.assimilate(i),!0}},e.firstMatch=function(t){return function(e){for(var i=0,n=t.length;n>i;i+=1)if(t[i](e))return!0;return!1}},e.longestMatch=function(t){return function(e){var i,n,s,r=[];for(i=0,n=t.length;n>i&&(s=e.clone(),!t[i](s)||(r.push(s),s.string));i+=1);if(n=r.length,n--){for(s=r[n];n--;)r[n].string.length<=s.string.length&&(s=r[n]);return e.assimilate(s),!0}return!1}},t.Parse=e,t.parse={}}(O),function(t){var e=1,i=2,n=3,s=function(n,s){var r=t.Parse,o=r.define,a=r.optional,h=r.not,c=r.sequence,u=r.firstMatch,l=r.longestMatch,d=n.datePatterns,f=function(t,e){return u(e.split(" ").map(function(e){return o(t,d[e],e)}))},g=o("whitespace",/^(?:[\s"']+|$)/),p=o("hour",/^(?:2[0-3]|[01]?\d)/),v=o("minute",/^[0-5][0-9]/),m=o("second",/^[0-5][0-9]/),y=u([o("am",d.am),o("pm",d.pm)]),w=c([a(g),y]),_=o("timeDelimiter",/^[:.]/),b=o("timeContext",d.timeContext),T=c([p,a(c([_,v,a(c([_,m]))])),a(w),g]);if(s===e)return u([T,c([p,v]),g]);var D=o("ordinalSuffix",d.ordinalSuffix),S=f("weekday","sun mon tue wed thu fri sat"),C=c([o("day",/^(?:[0-2]\d|3[0-1]|\d)/),a(D),h(b)]),O=c([o("month",/^(?:1[0-2]|0\d|\d)/),h(u([b,D]))]),x=f("monthname","jan feb mar apr may jun jul aug sep oct nov dec"),k=u([O,x]),E=o("year",/^\d{4}/),I=c([o("year",/^\d\d(?:\d\d)?/),h(u([b,D]))]),V=f("searchMethod","past future"),R=o("dateDelimiter",/^(?:[\s\-\.\,\'\/]|of)+/),F=f("relativeDate","yesterday tomorrow today now"),L=c(n.dateFormats.date.split(/%\-?([dmbY])/).map(function(t,e){if(1&e)switch(t){case"d":return C;case"m":return O;case"b":return x;case"Y":return I}else if(t)return o("dateDelimiter",new RegExp("^"+t.escapeRegExp()));return null}).filter(function(t){return!!t})),A=c([C,R,k,R,I]),P=c([C,R,k]),M=c([k,R,I,h(b)]),N=c([k,R,C,R,I]),U=c([k,R,C]),j=c([I,R,k,R,C]),B=c([I,R,k]),K=c([u([L,l("dmy"===n.dateElementOrder?[A,P,M,N,U,j,B]:"mdy"===n.dateElementOrder?[N,U,M,A,P,j,B]:[j,B,A,P,M,N,U])]),h(o("",/^\d/))]);return u(s===i?[K,S,E,x,C,F,V,g]:[K,T,S,E,x,C,F,V,g])},r="jan feb mar apr may jun jul aug sep oct nov dec".split(" ").reduce(function(t,e,i){return t[e]=i,t},{}),o="sun mon tue wed thu fri sat".split(" ").reduce(function(t,e,i){return t[e]=i,t},{}),a=Date.isLeapYear,h=Date.getDaysInMonth,c=0,u=-1,l=1,d={interpret:function(t,e){var i,n,s,r,o={};for(i=0,n=t.length;n>i;i+=1)s=t[i],r=s[0],this[r]&&this[r](o,s[1],s[2],t);return this.findDate(o,o.searchMethod||e)},findDate:function(t,e){var i=Object.keys(t);if(!i.length)return null;var n=new Date,s=n.getDate();n.setDate(1),n.setHours(t.hour||0),n.setMinutes(t.minute||0),n.setSeconds(t.second||0),n.setMilliseconds(0);var r,o,c,d=t.day,f=t.month,g=t.year,p=t.weekday,v=!(!f&&0!==f),m=!(!p&&0!==p),y=864e5;if(d&&v&&g)d>h(f,g)?n=null:(n.setFullYear(g),n.setMonth(f),n.setDate(d));else if(v&&g)n.setFullYear(g),n.setMonth(f),m?e!==u?d=(p-n.getDay()).mod(7)+1:(n.setDate(d=h(f,g)),d-=(n.getDay()-p).mod(7)):d=1,n.setDate(d);else if(d&&v){if(r=n.getMonth(),g=n.getFullYear(),e===l&&(r>f||f===r&&s>=d)&&(g+=1),e===u&&(f>r||f===r&&d>=s)&&(g-=1),n.setFullYear(g),n.setMonth(f),n.setDate(d),m){if(o=29===d&&1===f){for(;!a(g);)g+=e||1;n.setFullYear(g)}for(c=(o?4:1)*(e||1);n.getDay()!==p;){do g+=c;while(o&&!a(g));n.setFullYear(g)}}}else if(d){if(g=n.getFullYear(),f=n.getMonth(),n.setDate(d),m)for(;n.getDay()!==p||n.getDate()!==d;)e===u?f?f-=1:(g-=1,f=11):11>f?f+=1:(g+=1,f=0),n.setFullYear(g),n.setMonth(f),n.setDate(d)}else v?(g=n.getFullYear(),r=n.getMonth(),e===l&&r>=f&&(g+=1),e===u&&f>r&&(g-=1),n.setFullYear(g),n.setMonth(f),m&&(e!==u?d=(p-n.getDay()).mod(7)+1:(n.setDate(d=h(f,g)),d-=(n.getDay()-p).mod(7)),n.setDate(d))):g?(n.setFullYear(g),n.setMonth(0),m&&(e!==u?d=(p-n.getDay()).mod(7)+1:(n.setMonth(11),n.setDate(d=h(11,g)),d-=(n.getDay()-p).mod(7)),n.setDate(d))):m&&(n.setDate(s),e===u?(n.setTime(n.getTime()-y),n.setTime(n.getTime()-y*(n.getDay()-p).mod(7))):(n.setTime(n.getTime()+y),n.setTime(n.getTime()+y*(p-n.getDay()).mod(7))));return n},weekday:function(t,e,i){t.weekday=o[i]},day:function(t,e){t.day=+e},month:function(t,e){t.month=+e-1},monthname:function(t,e,i){t.month=r[i]},year:function(t,e){var i=+e;2===e.length&&(i+=2e3,i>(new Date).getFullYear()+30&&(i-=100)),t.year=i},hour:function(t,e){t.hour=+e;var i=t.meridian;i&&this[i](t)},minute:function(t,e){t.minute=+e},second:function(t,e){t.second=+e},am:function(t){t.meridian="am";var e=t.hour;e&&12===e&&(t.hour=0)},pm:function(t){t.meridian="pm";var e=t.hour;e&&12>e&&(t.hour=e+12)},searchMethod:function(t,e,i){t.searchMethod="past"===i?u:l},relativeDate:function(t,e,i){var n=new Date,s=864e5;switch(i){case"yesterday":n.setTime(n.getTime()-s);break;case"tomorrow":n.setTime(n.getTime()+s)}t.day=n.getDate(),t.month=n.getMonth(),t.year=n.getFullYear()}},f=t.Parse.define("unknown",/^[^\s]+/),g={},p=function(e,i,n){i||(i=t.i18n.getLocale());for(var r=i.code+n,o=g[r]||(g[r]=s(i,n)),a=new t.Parse(e.trim());a.string.length;)o(a)||f(a);return a.tokens};t.parse.tokeniseDateTime=p,t.parse.interpretDateTime=function(t,e){return d.interpret(t,e||c)},t.parse.time=function(t,i){var n=p(t,i,e);return d.interpret(n)},t.parse.date=function(t,e,n){var s=p(t,e,i);return d.interpret(s,n?u:c)},t.parse.dateTime=function(t,e,i){var s=p(t,e,n);return d.interpret(s,i?u:c)}}(O),function(t){var e=t.Class({Extends:t.Object,content:t.bind("view.content"),init:function(t){this._selectionId=0,this._lastSelectedIndex=0,this._selectedIds={},this.isLoadingSelection=!1,this.view=null,this.length=0,e.parent.init.call(this,t);var i=this.get("content");i&&i.on("query:updated",this,"contentWasUpdated")},contentDidChange:function(t,e,i,n){i&&i.off("query:updated",this,"contentWasUpdated"),n&&n.on("query:updated",this,"contentWasUpdated"),this._selectedIds={},this.set("length",0).propertyDidChange("selectedIds")}.observes("content"),contentWasUpdated:function(t){for(var e,i=this._selectedIds,n=this.get("length"),s=t.removed||[],r=t.added.reduce(function(t,e){return t[e]=!0,t},{}),o=s.length;o--;)e=s[o],i[e]&&!r[e]&&(n-=1,delete i[e]);this.set("length",n).propertyDidChange("selectedIds")},selectedIds:function(){return Object.keys(this._selectedIds)}.property().nocache(),isIdSelected:function(t){return!!this._selectedIds[t]},updateViews:function(){for(var t,e,i=this.getFromPath("view.childViews"),n=i?i.length:0,s=this._selectedIds;n--;)t=i[n],e=t.getFromPath("content.id"),e&&t.set("isSelected",!!s[e])}.observes("selectedIds"),selectIds:function(t,e,i){if(!i||i===this._selectionId){e=!!e;for(var n,s,r=this._selectedIds,o=0,a=t.length;a--;)n=t[a],s=!!r[n],e!==s&&(e?r[n]=!0:delete r[n],o+=1);o&&this.increment("length",e?o:-o).propertyDidChange("selectedIds"),this.set("isLoadingSelection",!1)}},selectIndex:function(t,e,i){var n=this._lastSelectedIndex,s=i?Math.min(t,n):t,r=(i?Math.max(t,n):t)+1;return this._lastSelectedIndex=t,this.selectRange(s,r,e)},selectRange:function(t,e,i){var n=this.get("content"),s=this._selectionId+=1,r=n.getIdsForObjectsInRange(t,e=Math.min(e,n.get("length")||0),function(t,e,n){this.selectIds(t,i,s,e,n)}.bind(this));return r&&this.set("isLoadingSelection",!0),this},selectAll:function(t){var e=this.get("content"),i=this._selectionId+=1;if(t){var n=e.getIdsForAllObjects(function(t,e,n){this.selectIds(t,!0,i,e,n)}.bind(this));n&&this.set("isLoadingSelection",!0)}else this._selectedIds={},this.set("length",0).propertyDidChange("selectedIds").set("isLoadingSelection",!1);return this}});t.SelectionController=e}(O),function(t){var e=t.Status.READY,i=t.Class({Extends:t.Object,allowNoSelection:!0,init:function(t){this._ignore=!1,this._range={start:-1,end:0},this.content=null,this.record=null,this.index=-1,this.isFetchingIndex=!1,i.parent.init.call(this,t);var e=this.get("content");e&&this.contentDidChange(null,"",null,e)},destroy:function(){var t=this.get("content");t&&(t.off("query:reset",this,"contentWasReset").off("query:updated",this,"contentWasUpdated"),t.removeObserverForRange(this._range,this,"recordAtIndexDidChange")),i.parent.destroy.call(this)},recordAtIndexDidChange:function(){if(!this.get("record")){var t=this.get("content");this.set("record",t&&t.getObjectAt(this.get("index"))||null)}}.queue("before"),_indexDidChange:function(){var t,e=this.get("content"),i=e?e.get("length"):0,n=this.get("index"),s=this._range;s.start=n,s.end=n+1,this._ignore||(0>n&&!this.get("allowNoSelection")||!i&&n>0?this.set("index",0):i>0&&n>=i?this.set("index",i-1):(i&&n>-1&&(t=e.getObjectAt(n)),this._ignore=!0,this.set("record",t||null),this._ignore=!1))}.observes("index"),_recordDidChange:function(){if(!this._ignore){var e=this.get("record"),i=this.get("content"),n=t.meta(this).bindings.content;n&&(this._ignore=!0,n.sync(),this._ignore=!1),e&&i?(this.set("isFetchingIndex",!0),i.indexOfId(e.toIdOrStoreKey(),0,function(t){this.get("record")===e&&this.get("content")===i&&(this._ignore=!0,this.set("index",t),this._ignore=!1,this.set("isFetchingIndex",!1))}.bind(this))):(e||this.get("allowNoSelection"))&&(this._ignore=!0,this.set("index",-1),this._ignore=!1)}}.observes("record"),setRecordInNewContent:function(e){if(!this.get("isFetchingIndex")){var i=t.meta(this).bindings.record;if(!(i&&i.isNotInSync&&i.willSyncForward)){var n=this.get("allowNoSelection"),s=this.get("record"),r=n?-1:0;e===this.get("content")&&(s&&(r=e.indexOfId(s.toIdOrStoreKey()),!n&&0>r&&(r=0)),r===this.get("index")?(s=e.getObjectAt(r),this.set("record",s||null)):this.set("index",r))}}},contentDidChange:function(t,i,n,s){var r=this._range;n&&(n.off("query:reset",this,"contentWasReset").off("query:updated",this,"contentWasUpdated"),n.removeObserverForRange(r,this,"recordAtIndexDidChange"),n.removeObserverForKey("status",this,"contentBecameReady")),s&&(s.addObserverForRange(r,this,"recordAtIndexDidChange"),s.on("query:updated",this,"contentWasUpdated").on("query:reset",this,"contentWasReset"),this.set("isFetchingIndex",!1),this._ignore||(s.is(e)?this.setRecordInNewContent(s):s.addObserverForKey("status",this,"contentBecameReady")))}.observes("content"),contentBecameReady:function(i,n){i.is(e)&&(i.removeObserverForKey(n,this,"contentBecameReady"),t.RunLoop.queueFn("before",this.setRecordInNewContent.bind(this,i)))},contentWasUpdated:function(t){var e,i,n=this.get("record"),s=n?t.added.indexOf(n.get("id")):-1,r=t.removedIndexes,o=t.addedIndexes,a=this.get("content"),h=0;if(n){if(s>-1)s=o[s];else{if(s=this.get("index"),-1===s)return;for(e=0,i=r.length;i>e&&r[e]<s;e+=1)h+=1;for(s-=h,e=0,i=o.length;i>e&&o[e]<=s;e+=1)s+=1}s=Math.min(s,(a&&a.get("length")||1)-1),s===this.get("index")?(n=a&&a.getObjectAt(s),this.set("record",n||null)):this.set("index",s)}},contentWasReset:function(){this._recordDidChange()}});t.SingleSelectionController=i}(O),function(t,e){var i={setItem:function(){},getItem:function(){}},n=t.Class({Extends:t.Object,init:function(t,e){this._name=t+".",this._store="file:"===location.protocol?i:e?sessionStorage:localStorage,n.parent.init.call(this)},get:function(t){if(!(t in this)){var i;try{i=this._store.getItem(this._name+t)}catch(s){}return i?this[t]=JSON.parse(i):e}return n.parent.get.call(this,t)},set:function(t,e){try{this._store.setItem(this._name+t,JSON.stringify(e))}catch(i){}return n.parent.set.call(this,t,e)}});t.LocalStorage=n}(O),function(t){var e=function(t,e,i){var n,s,r=t.length-1;for(n=t[r];r--&&(s=t[r],!(s[0]<e-(i?0:s[1])));)n=s;return n},i=function(t,e,n,s,r){for(var o,a,h,c,u,l,d,f,g=t.length,p=n.getUTCFullYear(),v=null;g--&&(o=t[g],!(o[1]<p));)o[0]<=p&&(u=o[2],l=o[3]||Date.getDaysInMonth(u,p),a=new Date(Date.UTC(p,u,l,o[5],o[6],o[7])),(d=o[4])&&(f=(Math.abs(d)-a.getUTCDay()+6)%7,f&&a.add(1>d?f-7:f)),h=!o[8],h!==s&&(a.add((h?1:-1)*e,"second"),2===o[8]&&Math.abs(a-n)<=108e5&&a.add((h?1:-1)*i(t,e,new Date(n-864e5),s,!0)[9],"second")),s||(a.add(o[9],"second"),Math.abs(a-n)<=108e5&&a.add(i(t,e,new Date(n-864e5),s,!0)[9],"second")),n>=a&&(!c||a>c)&&(v=o,c=a));return!v&&r?i(t,e,new Date(Date.UTC(p-1,11,31,12,0,0)),s,!1):v},n=t.Class({init:function(e){t.extend(this,e)},convert:function(t,s){var r=e(this.periods,t),o=r[1],a=i(n.rules[r[2]]||[],o,t,s,!0);return a&&(o+=a[9]),s||(o=-o),new Date(+t+1e3*o)},convertDateToUTC:function(t){return this.convert(t,!1)},convertDateToTimeZone:function(t){return this.convert(t,!0)},getSuffix:function(t){var s=e(this.periods,t,!1),r=s[1],o=i(n.rules[s[2]],r,t,!1,!0),a=s[3],h=a.indexOf("/");return o&&h>-1&&(a=o[9]?a.slice(h+1):a.slice(0,h),o=null),a.format(o?o[10]:"")},toJSON:function(){return this.id}});n.fromJSON=function(t){return n[t]||n.UTC},n.isEqual=function(t,e){return t.id===e.id},n.rules={"-":[]},n.areas={},n.load=function(e){var i,s,r,o,a,h,c=e.zones,u=e.link,l=n.areas;for(s in c){for(i=new n({id:s,periods:c[s]}),n[s]=i,o=l,r=s.replace(/_/g," ").split("/"),h=r.length-1,a=0;h>a;a+=1)o=o[r[a]]||(o[r[a]]={});o[r[h]]=i}for(s in u){for(i=new n({id:s,periods:c[u[s]]}),n[s]=i,o=l,r=s.replace(/_/g," ").split("/"),h=r.length-1,a=0;h>a;a+=1)o=o[r[a]]||(o[r[a]]={});o[r[h]]=i}t.extend(n.rules,e.rules)},t.TimeZone=n}(O),function(t){var e=new t.Object({_gestures:[],register:function(t){this._gestures.push(t)},deregister:function(t){this._gestures.erase(t)},isMouseDown:!1,fire:function(t,e){if(/^touch/.test(t)){var i=this._gestures,n=i.length;for(t=t.slice(5);n--;)i[n][t](e)}return e.button||("mousedown"===t&&this.set("isMouseDown",!0),"mouseup"===t&&this.set("isMouseDown",!1)),!1}});t.ViewEventsController.addEventTarget(e,30),t.GestureManager=e}(O),function(t){t.Gesture=t.Class({init:function(e){t.extend(this,e),t.GestureManager.register(this)},destroy:function(){t.GestureManager.deregister(this)},cancel:function(){},start:function(){},move:function(){},end:function(){}})}(O),function(t){var e=t.Class({init:function(e,i){this.target=e,this.stop=i,this.time=Date.now(),t.ViewEventsController.addEventTarget(this,40)},fire:function(e,i){var n="click"===e&&!i.originalType,s=n||/^mouse/.test(e);return"touchstart"===e||Date.now()-this.time>1e3?(t.ViewEventsController.removeEventTarget(this),!1):(s&&(this.stop||i.target!==this.target)&&i.preventDefault(),s)}}),i=t.Class({Extends:t.Event,originalType:"tap"}),n=function(e,i,n,s){this.x=e,this.y=i,this.time=n;var r=this.activeEls=[];do/^(?:A|BUTTON|INPUT|LABEL)$/.test(s.nodeName)&&(r.push(s),t.Element.addClass(s,"tap-active"));while(s=s.parentNode)};n.prototype.done=function(){var e,i,n=this.activeEls;for(e=0,i=n.length;i>e;e+=1)t.Element.removeClass(n[e],"tap-active")},t.Tap=new t.Gesture({_tracking:{},cancel:function(){var t,e=this._tracking;for(t in e)e[t].done();this._tracking={}},start:function(t){var e,i,s,r,o=t.changedTouches,a=this._tracking,h=Date.now();for(e=0,i=o.length;i>e;e+=1)s=o[e],r=s.identifier,a[r]||(a[r]=new n(s.screenX,s.screenY,h,s.target))},move:function(t){var e,i,n,s,r,o,a,h=t.changedTouches,c=this._tracking;for(e=0,i=h.length;i>e;e+=1)n=h[e],s=n.identifier,r=c[s],r&&(o=n.screenX-r.x,a=n.screenY-r.y,o*o+a*a>25&&(r.done(),delete c[s]))},end:function(n){var s,r,o,a,h,c,u,l,d,f=n.changedTouches,g=this._tracking,p=Date.now(),v=t.ViewEventsController;for(s=0,r=f.length;r>s;s+=1)o=f[s],a=o.identifier,h=g[a],h&&(p-h.time<200&&(c=o.target,u=new i("tap",c),v.handleEvent(u),l=new i("click",c),l.defaultPrevented=u.defaultPrevented,v.handleEvent(l),d=c.nodeName,"INPUT"!==d&&"TEXTAREA"!==d&&"SELECT"!==d&&n.preventDefault(),new e(c,l.defaultPrevented)),h.done(),delete g[a])}})}(O),function(t){var e=t.Class({Extends:t.Event,init:function(t){e.parent.init.call(this,"hold",t.target),this.touch=t}}),i=function(){this._ignore||t.ViewEventsController.handleEvent(new e(this.touch))},n=function(e){this.touch=e,this.x=e.screenX,this.y=e.screenY,this.target=e.target,this._ignore=!1,t.RunLoop.invokeAfterDelay(i,750,this)};n.prototype.done=function(){this._ignore=!0},t.Hold=new t.Gesture({_tracking:{},cancel:t.Tap.cancel,start:function(t){var e,i,s,r,o=t.changedTouches,a=this._tracking;for(e=0,i=o.length;i>e;e+=1)s=o[e],r=s.identifier,a[r]||(a[r]=new n(s))},move:t.Tap.move,end:function(t){var e,i,n,s,r,o=t.changedTouches,a=this._tracking;for(e=0,i=o.length;i>e;e+=1)n=o[e],s=n.identifier,r=a[s],r&&(r.done(),delete a[s])}})}(O),function(t){var e=t.Class({Extends:t.Object,init:function(t){e.parent.init.call(this,t),this._seenMouseDown=!1},inView:function(t){for(var e=t.targetView,i=this.get("view");e&&e!==i;)e=e.get("parentView");return!!e},handleMouse:function(t){var e,i=t.type;t.seenByModal||this.inView(t)||(t.stopPropagation(),"mousedown"===i||"tap"===i?this._seenMouseDown=!0:"click"===i&&(t.preventDefault(),this._seenMouseDown&&(e=this.get("view"),e.clickedOutside&&e.clickedOutside(t)))),t.seenByModal=!0}.on("click","mousedown","mouseup","tap"),handleScroll:function(){this._seenMouseDown=!1}.on("scroll"),handleKeys:function(t){if(!t.seenByModal&&!this.inView(t)){t.stopPropagation();var e=this.get("view");e.keyOutside&&e.keyOutside(t)}t.seenByModal=!0}.on("keypress","keydown","keyup"),handleTouch:function(t){t.seenByModal||this.inView(t)||(t.preventDefault(),t.stopPropagation()),t.seenByModal=!0}.on("touchstart")});t.ModalEventHandler=e}(O),function(t){var e=t.Class({Extends:t.View,className:"v-PopOver",positioning:"absolute",isVisible:!1,parentPopOverView:null,show:function(i){if(i.alignWithView===this)return this.get("subPopOverView").show(i);this.hide(),this._options=i;var n,s,r,o=this.get("eventHandler"),a=i.view,h=i.alignWithView,c=i.atNode||h.get("layer"),u=c.offsetWidth,l=c.offsetHeight,d=i.positionToThe||"bottom",f=i.alignEdge||"left",g=i.inParent,p=0,v=0,m=t.Element,y=m.create,w=t.RootView,_=t.ScrollView;if(!g)for(g=i.atNode?h:h.get("parentView");!(g instanceof w||g instanceof _||g instanceof e);)g=g.get("parentView");switch(n=m.getPosition(c,g instanceof _?g.get("scrollLayer"):g.get("layer")),d){case"right":n.left+=u;case"left":switch(f){case"middle":l>>=1;case"bottom":n.top+=l}break;case"bottom":n.top+=l;case"top":switch(f){case"centre":u>>=1;case"right":n.left+=u}}n.top+=i.offsetTop||0,n.left+=i.offsetLeft||0;for(r in n)n[r]=Math.round(n[r]);switch(this.set("layout",n),this.insertView(a),this.render(),s=this.get("layer"),i.showCallout&&s.appendChild(y("b",{className:"v-PopOver-callout v-PopOver-callout--"+d.charAt(0)+" v-PopOver-callout--"+f},[this._callout=y("b",{className:"v-PopOver-triangle v-PopOver-triangle--"+d.charAt(0)})])),g.insertView(this),d){case"left":p-=s.offsetWidth;case"right":switch(f){case"middle":v-=s.offsetHeight>>1;break;case"bottom":v-=s.offsetHeight}break;case"top":v-=s.offsetHeight;case"bottom":switch(f){case"centre":p-=s.offsetWidth>>1;break;case"right":p-=s.offsetWidth}}return this.adjustPosition(p,v),o&&t.ViewEventsController.addEventTarget(o,10),this.set("isVisible",!0),this},adjustPosition:function(i,n){var s,r,o=t.Element,a=this.get("parentView"),h=this.get("layer"),c=this.get("layout"),u=this._options.positionToThe||"bottom",l=this._callout,d=0,f="top"===u||"bottom"===u;i||(i=0),n||(n=0),a instanceof e&&(a=a.getParent(t.ScrollView)||a.getParent(t.RootView)),s=o.getPosition(h,a.get("layer")),a.get("showScrollbarX")||(r=a.get("pxWidth")-s.left-i-h.offsetWidth,0>r&&(i+=r,i-=10,l&&f&&(d+=r,d-=10))),r=s.left+i,0>r&&(i-=r,i+=10,l&&f&&(d-=r,d+=10)),a.get("showScrollbarY")||(r=a.get("pxHeight")-s.top-n-h.offsetHeight,0>r&&(n+=r,n-=10,l&&!f&&(d+=r,d-=10))),r=s.top+n,0>r&&(n-=r,n+=10,l&&!f&&(d-=r,d+=10)),(i||n)&&this.set("layout",{top:c.top+n,left:c.left+i}).redraw(),d&&o.setStyle(l,f?"left":"top",-d+"px")},didLeaveDocument:function(){return e.parent.didLeaveDocument.call(this),this.hide(),this},hide:function(){if(this.get("isVisible")){var e,i,n,s=this.hasSubView()?this.get("subPopOverView"):null,r=this.get("eventHandler"),o=this._options;s&&s.hide(),this.set("isVisible",!1),i=this.get("childViews")[0],this.detach(),this.removeView(i),o.showCallout&&(n=this.get("layer"),n.removeChild(n.firstChild),this._callout=null),r&&(t.ViewEventsController.removeEventTarget(r),r._seenMouseDown=!1),this._options=null,(e=o.onHide)&&e(o,this)}return this},hasSubView:function(){return!!t.meta(this).cache.subPopOverView&&this.get("subPopOverView").get("isVisible")},subPopOverView:function(){return new t.PopOverView({parentPopOverView:this})}.property(),eventHandler:function(){return this.get("parentPopOverView")?null:new t.ModalEventHandler({view:this})}.property(),clickedOutside:function(){this.hide()},keyOutside:function(t){for(var e=this;e.hasSubView();)e=e.get("subPopOverView");e.get("childViews")[0].fire(t.type,t),"keydown"===t.type&&e.closeOnEsc(t)},closeOnEsc:function(e){"esc"===t.DOMEvent.lookupKey(e)&&this.hide()}.on("keydown"),stopEvents:function(t){t.stopPropagation()}.on("click","mousedown","mouseup","keypress","keydown","keyup","tap")});t.PopOverView=e}(O),function(t,e){var i=t.Class({Extends:t.View,isDisabled:!1,isFocussed:!1,label:"",name:e,value:!1,tabIndex:e,shortcut:"",tooltip:function(){var e=this.get("shortcut");return e?t.loc("Shortcut: [_1]",e.split(" ").map(t.formatKeyForPlatform).join(" "+t.loc("or")+" ")):""}.property("shortcut"),didEnterDocument:function(){var e=this.get("shortcut");return e&&e.split(" ").forEach(function(e){t.ViewEventsController.kbShortcuts.register(e,this,"activate")},this),i.parent.didEnterDocument.call(this)},willLeaveDocument:function(){var e=this.get("shortcut");return e&&e.split(" ").forEach(function(e){t.ViewEventsController.kbShortcuts.deregister(e,this,"activate");
},this),i.parent.willLeaveDocument.call(this)},layerTag:"label",_domControl:null,_domLabel:null,draw:function(t,i,n){var s=this._domControl,r=this.get("name"),o=this.get("shortcut"),a=this.get("tabIndex");return s.id||(s.id=this.get("id")+"-input"),s.disabled=this.get("isDisabled"),r!==e&&(s.name=r),a!==e&&(s.tabIndex=a),o&&/^\w$/.test(o)&&(s.accessKey=o),t.title=this.get("tooltip"),this._domLabel=n("span.label",[this.get("label")])},abstractControlNeedsRedraw:function(t,e,i){return this.propertyNeedsRedraw(t,e,i)}.observes("isDisabled","label","name","tooltip","tabIndex"),redrawIsDisabled:function(){this._domControl.disabled=this.get("isDisabled")},redrawLabel:function(){for(var e,i=this._domLabel;e=i.firstChild;)i.removeChild(e);t.Element.appendChildren(i,[this.get("label")])},redrawName:function(){this._domControl.name=this.get("name")},redrawTooltip:function(t){t.title=this.get("tooltip")},redrawTabIndex:function(){this._domControl.tabIndex=this.get("tabIndex")},focus:function(){return this.get("isInDocument")&&(this._domControl.focus(),this.get("isFocussed")||this.fire("focus")),this},blur:function(){return this.get("isInDocument")&&(this._domControl.blur(),this.get("isFocussed")&&this.fire("blur")),this},_updateIsFocussed:function(t){this.set("isFocussed","focus"===t.type)}.on("focus","blur"),activate:function(){}});t.AbstractControlView=i}(O),function(t){var e=t.Class({Extends:t.AbstractControlView,isActive:!1,type:"",icon:"",tabIndex:-1,layerTag:"button",className:function(){var t=this.get("type");return"v-Button"+(t?" "+t:"")+(this.get("icon")?" v-Button--hasIcon":"")+(this.get("shortcut")?" v-Button--hasShortcut":"")+(this.get("isActive")?" is-active":"")+(this.get("isDisabled")?" is-disabled":"")}.property("type","icon","shortcut","isActive","isDisabled"),draw:function(t,i,n){var s=this.get("icon");return this._domControl=t,[n("i",{className:s?"icon "+s:"u-hidden"}),e.parent.draw.call(this,t,i,n)]},buttonNeedsRedraw:function(t,e,i){return this.propertyNeedsRedraw(t,e,i)}.observes("icon"),redrawIcon:function(t){var e=this.get("icon");t.firstChild.className=e?"icon "+e:"u-hidden"},target:null,action:null,method:null,activate:function(){if(!this.get("isDisabled")){var t,e=this.get("target")||this;(t=this.get("action"))?e.fire(t,{originView:this}):(t=this.get("method"))&&e[t](this),this.fire("button:activate")}},_ignoreUntil:0,_setIgnoreUntil:function(){this._ignoreUntil=Date.now()+200},_activateOnClick:function(e){this._ignoreUntil>Date.now()||e.button||e.metaKey||e.ctrlKey||("mouseup"!==e.type||this.getParent(t.MenuView))&&(this._ignoreUntil=41024448e5,t.RunLoop.invokeInNextEventLoop(this._setIgnoreUntil,this),this.activate(),e.preventDefault())}.on("mouseup","click"),_activateOnEnter:function(e){"enter"===t.DOMEvent.lookupKey(e)&&(this.activate(),e.stopPropagation())}.on("keypress")});t.ButtonView=e}(O),function(t){var e=t.Class({Extends:t.AbstractControlView,type:"",className:function(){var t=this.get("type");return"v-Checkbox "+(this.get("value")?"is-checked":"is-unchecked")+(this.get("isDisabled")?" is-disabled":"")+(t?" "+t:"")}.property("type","value","isDisabled"),draw:function(t,i,n){return[this._domControl=n("input",{className:"v-Checkbox-input",type:"checkbox",checked:this.get("value")}),e.parent.draw.call(this,t,i,n)]},checkboxNeedsRedraw:function(t,e,i){return this.propertyNeedsRedraw(t,e,i)}.observes("value"),redrawValue:function(){this._domControl.checked=this.get("value")},activate:function(){this.get("isDisabled")||this.toggle("value")},syncBackValue:function(t){var e="tap"===t.type;if((e||!t.originalType)&&t.targetView===this&&!this.get("isDisabled")){var i=this._domControl,n=i.checked;(e||t.target!==i)&&(t.preventDefault(),n=!n),this.set("value",n)}}.on("click","tap")});t.CheckboxView=e}(O),function(t,e){var i=FormData.isFake?null:"multiple",n=t.Class({Extends:t.ButtonView,acceptMultiple:!1,acceptOnlyTypes:"",layerTag:"label",type:"v-FileButton",draw:function(n,s,r){var o=this.get("icon");return[r("i",{className:o?"icon "+o:"u-hidden"}),this._domControl=r("input",{className:"v-FileButton-input",type:"file",accept:this.get("acceptOnlyTypes")||e,multiple:this.get("acceptMultiple")&&i}),t.AbstractControlView.prototype.draw.call(this,n,s,r)]},_activateOnClick:null,_activateOnEnter:null,activate:function(){this._domControl.click()},_fileWasChosen:function(n){var s,r,o,a,h=this._domControl;n.target===h&&(h.parentNode.replaceChild(this._domControl=t.Element.create("input",{className:"v-FileButton-input",type:"file",disabled:this.get("isDisabled"),tabIndex:this.get("tabIndex"),accept:this.get("acceptOnlyTypes")||e,multiple:this.get("acceptMultiple")&&i}),h),!FormData.isFake&&h.files?s=Array.prototype.slice.call(h.files):(r=h.value.replace(/\\/g,"/"),s=[{name:r.slice(r.lastIndexOf("/")+1),size:0,type:"",file:h}]),this.get("isDisabled")||(o=this.get("target")||this,(a=this.get("action"))?o.fire(a,{originView:this,files:s}):(a=this.get("method"))&&o[a](s,this),this.fire("button:activate")))}.on("change")});t.FileButtonView=n}(O),function(t){var e=t.Class({Extends:t.View,layerTag:"span",value:"",tooltip:"",draw:function(t){t.title=this.get("tooltip"),t.textContent=this.get("value")},labelNeedsRedraw:function(t,e,i){return this.propertyNeedsRedraw(t,e,i)}.observes("tooltip","value"),redrawTooltip:function(t){t.title=this.get("tooltip")},redrawValue:function(t){t.textContent=this.get("value")}});t.LabelView=e}(O),function(t){var e=t.Class({Extends:t.ButtonView,type:"v-MenuButton",popOverView:null,popOverOptions:{},menuView:null,alignMenu:"left",isInMenu:function(){return this.get("parentView")instanceof t.MenuOptionView}.property("parentView"),didCreateLayer:function(t){t.setAttribute("aria-expanded","false")},ariaNeedsRedraw:function(t,e,i){return this.propertyNeedsRedraw(t,"aria",i)}.observes("isActive"),redrawAria:function(t){t.setAttribute("aria-controls",this.getFromPath("menuView.id")),t.setAttribute("aria-expanded",this.get("isActive")+"")},activate:function(){if(!this.get("isActive")&&!this.get("isDisabled")){this.set("isActive",!0);var e,i,n,s=this,r=t.extend({view:this.get("menuView"),alignWithView:s,alignEdge:this.get("alignMenu"),onHide:function(){s.set("isActive",!1),i&&i.removeObserverForKey("isFocussed",e,"hide")}},this.get("popOverOptions"));this.get("isInMenu")?(e=this.getParent(t.PopOverView),i=this.get("parentView"),n=s.getParent(t.RootView),r.alignWithView=e,r.atNode=this.get("layer"),r.positionToThe=s.getPositionRelativeTo(n).left+s.get("pxWidth")+180<n.get("pxWidth")?"right":"left",r.alignEdge="top",r.offsetTop=r.view.get("showFilter")?-35:-5):e=this.get("popOverView"),e=e.show(r),i&&i.addObserverForKey("isFocussed",e,"hide")}},_activateOnMousedown:function(t){t.button||t.metaKey||t.ctrlKey||this.activate()}.on("mousedown")});t.MenuButtonView=e}(O),function(t){var e=t.Class({Extends:t.Object,options:[],canSelect:function(t){return!t.get("isHidden")&&!t.get("isDisabled")},focussedOption:null,getAdjacentOption:function(t){var e,i=this.get("options"),n=i.get("length"),s=i.indexOf(this.get("focussedOption"));0>s&&0>t&&(s=n),e=s.mod(n);do s=(s+t).mod(n);while(n&&!this.canSelect(i.getObjectAt(s))&&s!==e);return i.getObjectAt(s)},focusPrevious:function(t){return t&&t.preventDefault(),this.focusOption(this.getAdjacentOption(-1))},focusNext:function(t){return t&&t.preventDefault(),this.focusOption(this.getAdjacentOption(1))},focusOption:function(t){var e=this.get("focussedOption");return e!==t&&(e&&e.set("isFocussed",!1),t&&(this.canSelect(t)?t.set("isFocussed",!0):t=null),this.set("focussedOption",t)),this},blurOption:function(t){return this.get("focussedOption")===t&&this.focusOption(null),this},selectFocussed:function(t){t&&t.preventDefault();var e=this.get("focussedOption");return e&&this.canSelect(e)&&e.activate(this),this},filter:"",filterDidChange:function(){for(var e=this.get("filter").escapeRegExp(),i=e?t.i18n.makeSearchRegExp(e):null,n=this.get("options"),s=n.get("length"),r=this.get("focussedOption");s--;)n.getObjectAt(s).filter(i);r&&this.canSelect(r)||this.focusOption(null).focusNext()}.observes("filter"),keyBindings:{esc:"onEscape",enter:"selectFocussed",up:"focusPrevious",down:"focusNext",left:"closeIfSub",right:"activateIfMenu"},triggerKeyBinding:function(e){var i=t.DOMEvent.lookupKey(e),n=this.get("keyBindings");n[i]&&(e.stopPropagation(),this[n[i]](e,i))}.on("keydown"),onEscape:function(t){t.preventDefault();var e=this.get("filter");e?this.set("filter",""):this.get("view").hide()},closeIfSub:function(){var e,i=this.get("view");!i.get("showFilter")&&(e=i.getParent(t.PopOverView))&&e.get("parentPopOverView")&&i.hide()},activateIfMenu:function(){var e=this.get("focussedOption");e&&e.get("button")instanceof t.MenuButtonView&&this.selectFocussed()}}),i=t.Class({Extends:t.View,isHidden:!1,isDisabled:function(){return this.getFromPath("button.isDisabled")}.property("button.isDisabled"),isFocussed:!1,isFocussable:function(){return!this.get("isHidden")&&!this.get("isDisabled")}.property("isHidden","isDisabled"),layerTag:"li",className:function(){return"v-MenuOption"+(this.get("isFocussed")?" is-focussed":"")+(this.get("isHidden")?" u-hidden":"")}.property("isFocussed","isHidden"),init:function(t,e){this.childViews=[t],this.button=t,this.controller=e,i.parent.init.call(this)},scrollIntoView:function(){if(this.get("isFocussed")){var e=this.getParent(t.ScrollView);if(e){var i=e.get("pxHeight"),s=e.get("scrollTop"),r=this.getPositionRelativeTo(e).top,o=this.get("pxHeight");s>r?e.scrollTo(0,r-(o>>1),!0):r+o>s+i&&e.scrollTo(0,r+o-i+(o>>1),!0)}this.getParent(n).get("showFilter")||this.button.focus()}}.observes("isFocussed"),_focusTimeout:null,takeFocus:function(){this.get("isInDocument")&&this.get("controller").focusOption(this).activateIfMenu()},mouseMove:function(){if(!this.get("isFocussed")&&!this._focusTimeout){var e=this.getParent(t.PopOverView);e&&e.hasSubView()?this._focusTimeout=t.RunLoop.invokeAfterDelay(this.takeFocus,75,this):this.takeFocus()}}.on("mousemove"),mouseOut:function(){this._focusTimeout&&(t.RunLoop.cancel(this._focusTimeout),this._focusTimeout=null),this.get("button").get("isActive")||this.get("controller").blurOption(this)}.on("mouseout"),filter:function(t){var e=this.get("button").get("label");this.set("isHidden",!!t&&!t.test(e))},activate:function(){var t=this.get("button");t.activate&&t.activate()}}),n=t.Class({Extends:t.View,className:"v-Menu",showFilter:!1,closeOnActivate:!0,didCreateLayer:function(t){n.parent.didCreateLayer.call(this,t),t.addEventListener("mousemove",this,!1),t.addEventListener("mouseout",this,!1)},willDestroyLayer:function(t){t.removeEventListener("mouseout",this,!1),t.removeEventListener("mousemove",this,!1),n.parent.willDestroyLayer.call(this,t)},didEnterDocument:function(){n.parent.didEnterDocument.call(this);var e,i,s,r,o=this._scrollView;return o&&(e=(this.getParent(t.ScrollView)||this.getParent(t.RootView)).get("pxHeight"),i=this.get("layer").getBoundingClientRect().bottom-e,o.set("layout",{maxHeight:Math.max(o.get("pxHeight")-i-10,e/2)}).redraw()),this.get("showFilter")&&(s=this.get("controller"),r=this._input,s.get("focussedOption")||s.focusNext(),t.RunLoop.invokeInNextFrame(function(){r.focus().set("selection",{start:0,end:r.get("value").length})})),this},didLeaveDocument:function(){var t=this.get("controller");return this.get("showFilter")?t.set("filter",""):t.focusOption(null),n.parent.didLeaveDocument.call(this)},mayHaveResized:function(){this.parentViewDidResize()}.queue("after").observes("controller.filter"),nextEventTarget:function(){return this.get("controller")}.property("controller"),controller:function(){return new e({view:this})}.property(),ItemView:i,draw:function(e,i,n){var s=this.get("controller"),r=this.get("ItemView"),o=this.get("options").map(function(t){return new r(t,s)});return s.set("options",o),[this.get("showFilter")?n("div.v-Menu-filter",[this._input=new t.SearchTextView({blurOnEscape:!1,value:t.bindTwoWay("filter",this.get("controller"))})]):null,this._scrollView=new t.ScrollView({positioning:"relative",layout:{},layerTag:"ul",childViews:o})]},hide:function(){var e=this.get("parentView");e&&t.RunLoop.invokeInNextFrame(e.hide,e)},hideAll:function(){if(this.get("closeOnActivate")){var e,i=this.getParent(t.PopOverView)||this.get("parentView");if(i){for(;e=i.get("parentPopOverView");)i=e;t.RunLoop.invokeInNextFrame(i.hide,i)}}}.on("button:activate"),fireShortcut:function(e){if(!this.get("showFilter")){var i,n,s,r=t.DOMEvent.lookupKey(e),o=t.ViewEventsController.kbShortcuts.getHandlerForKey(r);if(o&&(i=n=o[0],s=o[1],n instanceof t.View)){for(;i&&i!==this;)i=i.get("parentView");i&&(n[s](e),e.preventDefault())}}}.on("keypress")});t.MenuController=e,t.MenuOptionView=i,t.MenuView=n}(O),function(t){var e=t.Class({Extends:t.AbstractControlView,type:"",className:function(){var t=this.get("type");return"v-Radio "+(this.get("value")?"is-checked":"is-unchecked")+(this.get("isDisabled")?" is-disabled":"")+(t?" "+t:"")}.property("type","value","isDisabled"),draw:function(t,i,n){return[this._domControl=n("input",{className:"v-Radio-input",type:"radio",checked:this.get("value")}),e.parent.draw.call(this,t,i,n)]},radioNeedsRedraw:t.CheckboxView.prototype.checkboxNeedsRedraw,redrawValue:t.CheckboxView.prototype.redrawValue,activate:function(){this.get("isDisabled")||this.set("value",!0)}.on("click")});t.RadioView=e}(O),function(t,e){var i=function(t){return function(e){var i=this.get("editor");return i&&i[t](e),this}},n=function(t,e){return function(){var i=this.get("path");return"(selection)"===i?this.get("editor").hasFormat(t):e.test(i)}.property("path")},s=RegExp.email,r=/^(?:https?:\/\/)?[\w.]+[.][a-z]{2,4}(?:\/[^\s()<>]+|\([^\s()<>]+\))*/i,o=new t.PopOverView,a=t.ButtonView,h=t.Transform.isEqualToValue,c=t.Class({Extends:t.View,Mixin:t.DropTarget,isFocussed:!1,isExpanding:!1,showToolbar:!t.UA.isIOS,editor:null,styles:null,_value:"",value:function(t){var i=this.get("editor");return i?t!==e?i.setHTML(t):t=i.getHTML():t!==e?this._value=t:t=this._value,t}.property().nocache(),willEnterDocument:function(){return this.set("path",""),c.parent.willEnterDocument.call(this)},didEnterDocument:function(){if(this.get("showToolbar")&&this.get("isExpanding")){var e=this.getParent(t.ScrollView);e&&e.addObserverForKey("scrollTop",this,"_calcToolbarPosition")}return c.parent.didEnterDocument.call(this)},willLeaveDocument:function(){if(this.get("showToolbar")&&this.get("isExpanding")){var e=this.getParent(t.ScrollView);e&&e.removeObserverForKey("scrollTop",this,"_calcToolbarPosition"),this._setToolbarPosition(e,this.get("toolbarView"),!1)}var i=this.get("editor");return i&&(this._value=i.getHTML(this.get("isFocussed")),i.destroy(),this.set("editor",null)),c.parent.willLeaveDocument.call(this)},className:function(){return"v-RichText"+(t.UA.isIOS?" v-RichText--iOS":"")+(this.get("showToolbar")?"":" v-RichText--noToolbar")}.property(),draw:function(e,i,n){var s=this,r=n("iframe.v-RichText-input"),o=function(){var e=r.contentDocument;if("CSS1Compat"!==e.compatMode&&(e.open(),e.write("<!DOCTYPE html><title></title>"),e.close()),!s.get("editor")){var i=new Squire(e);i.didError=t.RunLoop.didError,s.set("editor",i.addStyles(s.get("styles")).setHTML(s._value).addEventListener("load",s).addEventListener("keydown",s).addEventListener("keypress",s).addEventListener("keyup",s).addEventListener("mousedown",s).addEventListener("click",s).addEventListener("focus",s).addEventListener("blur",s).addEventListener("input",s).addEventListener("dragenter",s).addEventListener("dragleave",s).addEventListener("dragover",s).addEventListener("drop",s).addEventListener("select",s).addEventListener("pathChange",s).addEventListener("undoStateChange",s)).set("path",i.getPath()).expand(),s.get("isFocussed")&&i.focus()}}.invokeInRunLoop();return r.addEventListener("load",o,!1),[this.get("showToolbar")?this.get("toolbarView"):null,n("div.v-RichText-content",[r])]},expand:function(){if(!t.UA.isIOS&&this.get("isExpanding")){var e=this.get("editor"),i=e&&e.getDocument(),n=i&&i.body,s=n&&n.lastChild;if(!s)return;var r=this._chromeHeight||(this._chromeHeight=this.get("pxHeight")-n.offsetHeight),o=s.offsetTop+s.offsetHeight+r+30,a=this.get("layout");a.height!==o&&(a=t.clone(a),a.height=o,this.set("layout",a))}}.queue("after").on("input","load"),_calcToolbarPosition:function(t,e,i,n){var s,r=this.get("toolbarView"),o=this._offsetHeight,a=this._offsetTop,h=Date.now(),c=r.get("parentView")!==this;(!a||this._offsetExpiry<h)&&(this._offsetHeight=o=this.get("layer").offsetHeight,this._offsetTop=a=Math.floor(this.getPositionRelativeTo(t).top)),this._offsetExpiry=h+500,s=n>a&&n<a+o-(t.get("pxHeight")>>2),s!==c&&this._setToolbarPosition(t,r,s)},_setToolbarPosition:function(t,e,i){if(i){var n=t.get("parentView"),s=e.getPositionRelativeTo(n),r=t.getPositionRelativeTo(n);e.set("className","v-Toolbar v-RichText-toolbar is-sticky").set("layout",{top:t.get("pxTop"),left:s.left-r.left,width:e.get("pxWidth")}),n.insertView(e)}else e.set("className","v-Toolbar v-RichText-toolbar").set("layout",{top:0,left:0,right:0}),this.insertView(e,null,"top")},toolbarConfig:{left:["bold","italic","underline","strikethrough","-","font","size","-","colour","bgcolour","-","image","-","link","-","ul","ol","-","quote","unquote","-","left","centre","right","justify","-","ltr","rtl","-","unformat"],right:[]},toolbarView:function(){var e=t.bind,i=this;return new t.ToolbarView({className:"v-Toolbar v-RichText-toolbar",positioning:"absolute",layout:{overflow:"hidden",zIndex:1,top:0,left:0,right:0},preventOverlap:!0}).registerViews({bold:new a({type:"v-Button--iconOnly",icon:"icon-bold",isActive:e("isBold",this),label:t.loc("Bold"),tooltip:t.loc("Bold")+"\n"+t.formatKeyForPlatform("cmd-b"),activate:function(){i.get("isBold")?i.removeBold():i.bold(),this.fire("button:activate")}}),italic:new a({type:"v-Button--iconOnly",icon:"icon-italic",isActive:e("isItalic",this),label:t.loc("Italic"),tooltip:t.loc("Italic")+"\n"+t.formatKeyForPlatform("cmd-i"),activate:function(){i.get("isItalic")?i.removeItalic():i.italic(),this.fire("button:activate")}}),underline:new a({type:"v-Button--iconOnly",icon:"icon-underline",isActive:e("isUnderlined",this),label:t.loc("Underline"),tooltip:t.loc("Underline")+"\n"+t.formatKeyForPlatform("cmd-u"),activate:function(){i.get("isUnderlined")?i.removeUnderline():i.underline(),this.fire("button:activate")}}),strikethrough:new a({type:"v-Button--iconOnly",icon:"icon-strikethrough",isActive:e("isStriked",this),label:t.loc("Strikethrough"),tooltip:t.loc("Strikethrough")+"\n"+t.formatKeyForPlatform("cmd-shift-7"),activate:function(){i.get("isStriked")?i.removeStrikethrough():i.strikethrough(),this.fire("button:activate")}}),size:new a({type:"v-Button--iconOnly",icon:"icon-font-size",label:t.loc("Font Size"),tooltip:t.loc("Font Size"),target:this,method:"showFontSizeMenu"}),font:new a({type:"v-Button--iconOnly",icon:"icon-font",label:t.loc("Font Face"),tooltip:t.loc("Font Face"),target:this,method:"showFontFaceMenu"}),colour:new a({type:"v-Button--iconOnly",icon:"icon-palette",label:t.loc("Text Color"),tooltip:t.loc("Text Color"),target:this,method:"showTextColourMenu"}),bgcolour:new a({type:"v-Button--iconOnly",icon:"icon-highlight",label:t.loc("Text Highlight"),tooltip:t.loc("Text Highlight"),target:this,method:"showTextHighlightColourMenu"}),link:new a({type:"v-Button--iconOnly",icon:"icon-link",isActive:e("isLink",this),label:t.loc("Link"),tooltip:t.loc("Link")+"\n"+t.formatKeyForPlatform("cmd-k"),activate:function(){i.get("isLink")?i.removeLink():i.showLinkOverlay(this),this.fire("button:activate")}}),image:new t.FileButtonView({type:"v-FileButton v-Button--iconOnly",icon:"icon-image",label:t.loc("Insert Image"),tooltip:t.loc("Insert Image"),acceptMultiple:!0,acceptOnlyTypes:"image/jpeg, image/png, image/gif",target:this,method:"insertImagesFromFiles"}),left:new a({type:"v-Button--iconOnly",icon:"icon-paragraph-left",isActive:e("alignment",this,h("left")),label:t.loc("Left"),tooltip:t.loc("Left"),activate:function(){i.setTextAlignment("left"),this.fire("button:activate")}}),centre:new a({type:"v-Button--iconOnly",icon:"icon-paragraph-centre",isActive:e("alignment",this,h("center")),label:t.loc("Center"),tooltip:t.loc("Center"),activate:function(){i.setTextAlignment("center"),this.fire("button:activate")}}),right:new a({type:"v-Button--iconOnly",icon:"icon-paragraph-right",isActive:e("alignment",this,h("right")),label:t.loc("Right"),tooltip:t.loc("Right"),activate:function(){i.setTextAlignment("right"),this.fire("button:activate")}}),justify:new a({type:"v-Button--iconOnly",icon:"icon-paragraph-justify",isActive:e("alignment",this,h("justify")),label:t.loc("Justify"),tooltip:t.loc("Justify"),activate:function(){i.setTextAlignment("justify"),this.fire("button:activate")}}),ltr:new a({type:"v-Button--iconOnly",icon:"icon-lefttoright",isActive:e("direction",this,h("ltr")),label:t.loc("Text Direction: Left to Right"),tooltip:t.loc("Text Direction: Left to Right"),activate:function(){i.setTextDirection("ltr"),this.fire("button:activate")}}),rtl:new a({type:"v-Button--iconOnly",icon:"icon-righttoleft",isActive:e("direction",this,h("rtl")),label:t.loc("Text Direction: Right to Left"),tooltip:t.loc("Text Direction: Right to Left"),activate:function(){i.setTextDirection("rtl"),this.fire("button:activate")}}),quote:new a({type:"v-Button--iconOnly",icon:"icon-quotes-left",label:t.loc("Quote"),tooltip:t.loc("Quote")+"\n"+t.formatKeyForPlatform("cmd-]"),target:i,method:"increaseQuoteLevel"}),unquote:new a({type:"v-Button--iconOnly",icon:"icon-quotes-right",label:t.loc("Unquote"),tooltip:t.loc("Unquote")+"\n"+t.formatKeyForPlatform("cmd-["),target:i,method:"decreaseQuoteLevel"}),ul:new a({type:"v-Button--iconOnly",icon:"icon-list",isActive:e("isUnorderedList",this),label:t.loc("Unordered List"),tooltip:t.loc("Unordered List")+"\n"+t.formatKeyForPlatform("cmd-shift-8"),activate:function(){i.get("isUnorderedList")?i.removeList():i.makeUnorderedList(),this.fire("button:activate")}}),ol:new a({type:"v-Button--iconOnly",icon:"icon-numbered-list",isActive:e("isOrderedList",this),label:t.loc("Ordered List"),tooltip:t.loc("Ordered List")+"\n"+t.formatKeyForPlatform("cmd-shift-9"),activate:function(){i.get("isOrderedList")?i.removeList():i.makeOrderedList(),this.fire("button:activate")}}),unformat:new a({type:"v-Button--iconOnly",icon:"icon-clear-formatting",label:t.loc("Clear Formatting"),tooltip:t.loc("Clear Formatting"),activate:function(){i.removeAllFormatting(),this.fire("button:activate")}})}).registerConfig("standard",this.get("toolbarConfig"))}.property(),fontSizeMenuView:function(){var e=this;return new t.MenuView({showFilter:!1,options:[[t.loc("Small"),"10px"],[t.loc("Medium"),"13px"],[t.loc("Large"),"16px"],[t.loc("Huge"),"22px"]].map(function(t){return new a({layout:{fontSize:t[1]},label:t[0],method:"setFontSize",setFontSize:function(){e.setFontSize(t[1])}})})})}.property(),showFontSizeMenu:function(e){e.getParent(t.MenuView)&&(e=this.get("toolbarView").getView("overflow")),o.show({view:this.get("fontSizeMenuView"),alignWithView:e,alignEdge:"centre",showCallout:!0,offsetTop:2})},fontFaceMenuView:function(){var e=this;return new t.MenuView({showFilter:!1,options:[["Arial","arial, sans-serif"],["Georgia","georgia, serif"],["Helvetica","helvetica, arial, sans-serif"],["Monospace",'menlo, consolas, "courier new", monospace'],["Tahoma","tahoma, sans-serif"],["Times New Roman",'"Times New Roman", times, serif'],["Trebuchet MS",'"Trebuchet MS", sans-serif'],["Verdana","verdana, sans-serif"]].map(function(t){return new a({layout:{fontFamily:t[1]},label:t[0],method:"setFontFace",setFontFace:function(){e.setFontFace(t[1])}})})})}.property(),showFontFaceMenu:function(e){e.getParent(t.MenuView)&&(e=this.get("toolbarView").getView("overflow")),o.show({view:this.get("fontFaceMenuView"),alignWithView:e,alignEdge:"centre",showCallout:!0,offsetTop:2})},_colourText:!0,textColourMenuView:function(){var e=this;return new t.MenuView({className:"v-ColourMenu",showFilter:!1,options:"000000 b22222 ff0000 ffa07a fff0f5 800000 a52a2a ff8c00 ffa500 faebd7 8b4513 daa520 ffd700 ffff00 ffffe0 2f4f4f 006400 008000 00ff00 f0fff0 008080 40e0d0 00ffff afeeee f0ffff 000080 0000cd 0000ff add8e6 f0f8ff 4b0082 800080 ee82ee dda0dd e6e6fa 696969 808080 a9a9a9 d3d3d3 ffffff".split(" ").map(function(t){return t="#"+t,new a({layout:{backgroundColor:t},label:t,method:"setColour",setColour:function(){e._colourText?e.setTextColour(t):e.setHighlightColour(t)}})})})}.property(),showTextColourMenu:function(e){this._colourText=!0,e.getParent(t.MenuView)&&(e=this.get("toolbarView").getView("overflow")),o.show({view:this.get("textColourMenuView"),alignWithView:e,alignEdge:"centre",showCallout:!0,offsetTop:2})},showTextHighlightColourMenu:function(e){this._colourText=!1,e.getParent(t.MenuView)&&(e=this.get("toolbarView").getView("overflow")),o.show({view:this.get("textColourMenuView"),alignWithView:e,alignEdge:"centre",showCallout:!0,offsetTop:2})},linkOverlayView:function(){var e=this;return new t.View({className:"v-UrlPicker",value:"",draw:function(e,i,n){return[n("h3.u-bold",[t.loc("Add a link to the following URL or email:")]),this._input=new t.TextView({value:t.bindTwoWay("value",this),placeholder:"e.g. www.example.com"}),n("p.u-alignRight",[new a({type:"v-Button--destructive v-Button--size13",label:t.loc("Cancel"),target:o,method:"hide"}),new a({type:"v-Button--constructive v-Button--size13",label:t.loc("Add Link"),target:this,method:"addLink"})])]},focus:function(){this.get("isInDocument")&&(this._input.set("selection",this.get("value").length).focus(),this._input.fire("focus"))}.nextFrame().observes("isInDocument"),addLinkOnEnter:function(e){e.stopPropagation(),"enter"===t.DOMEvent.lookupKey(e)&&this.addLink()}.on("keyup"),addLink:function(){var t,i=this.get("value").trim();/^(?:javascript|data):/i.test(i)||(/[a-z][\w\-]+:/i.test(i)||(t=s.exec(i),i=t?"mailto:"+t[0]:"http://"+i),e.makeLink(i),o.hide(),e.focus())}})}.property(),showLinkOverlay:function(e){var i=this.get("linkOverlayView"),n=this.getSelectedText().trim();r.test(n)||s.test(n)||(n=""),i.set("value",n),e.getParent(t.MenuView)&&(e=this.get("toolbarView").getView("overflow")),o.show({view:i,alignWithView:e,showCallout:!0,offsetTop:2,offsetLeft:-4})},focus:function(){var t=this.get("editor");return t?t.focus():this.set("isFocussed",!0),this},blur:function(){var t=this.get("editor");return t?t.blur():this.set("isFocussed",!1),this},undo:i("undo"),redo:i("redo"),bold:i("bold"),italic:i("italic"),underline:i("underline"),strikethrough:i("strikethrough"),removeBold:i("removeBold"),removeItalic:i("removeItalic"),removeUnderline:i("removeUnderline"),removeStrikethrough:i("removeStrikethrough"),makeLink:i("makeLink"),removeLink:i("removeLink"),setFontFace:i("setFontFace"),setFontSize:i("setFontSize"),setTextColour:i("setTextColour"),setHighlightColour:i("setHighlightColour"),setTextAlignment:i("setTextAlignment"),setTextDirection:i("setTextDirection"),increaseQuoteLevel:i("increaseQuoteLevel"),decreaseQuoteLevel:i("decreaseQuoteLevel"),makeUnorderedList:i("makeUnorderedList"),makeOrderedList:i("makeOrderedList"),removeList:i("removeList"),increaseListLevel:i("increaseListLevel"),decreaseListLevel:i("decreaseListLevel"),removeAllFormatting:i("removeAllFormatting"),insertImage:i("insertImage"),insertImagesFromFiles:function(t){window.FileReader&&t.forEach(function(t){var e=this.get("editor").insertImage(),i=new FileReader;i.onload=function(){e.src=i.result,i.onload=null},i.readAsDataURL(t)},this)},getSelectedText:function(){var t=this.get("editor");return t?t.getSelectedText():""},kbShortcuts:function(e){var i=t.UA.isMac;switch(t.DOMEvent.lookupKey(e)){case i?"meta-k":"ctrl-k":e.preventDefault(),this.showLinkOverlay(this.get("toolbarView").getView("link"));break;case"pagedown":if(!i&&this.get("isExpanding")){var n=this.getParent(t.ScrollView);n&&n.scrollToView(this,{y:32+this.get("pxHeight")-n.get("pxHeight")},!0)}}}.on("keydown"),_forEachBlock:i("forEachBlock"),canUndo:!1,canRedo:!1,setUndoState:function(t){this.set("canUndo",t.canUndo).set("canRedo",t.canRedo),t.stopPropagation()}.on("undoStateChange"),path:"",setPath:function(t){this.set("path",t.path),t.stopPropagation()}.on("pathChange"),onSelect:function(){this.propertyDidChange("path")}.on("select"),isBold:n("B",/>B\b/),isItalic:n("I",/>I\b/),isUnderlined:n("U",/>U\b/),isStriked:n("S",/>S\b/),isLink:n("A",/>A\b/),alignment:function(){var t,e=this.get("path"),i=/\.align\-(\w+)/.exec(e);return"(selection)"===e?(t="",this._forEachBlock(function(e){var i=e.style.textAlign||"left";return t&&i!==t?(t="",!0):(t=i,!1)})):t=i?i[1]:"left",t}.property("path"),direction:function(){var t,e=this.get("path"),i=/\[dir=(\w+)\]/.exec(e);return"(selection)"===e?(t="",this._forEachBlock(function(e){var i=e.dir||"ltr";return t&&i!==t?(t="",!0):(t=i,!1)})):t=i?i[1]:"ltr",t}.property("path"),isUnorderedList:n("UL",/>UL\b/),isOrderedList:n("OL",/>OL\b/),handleEvent:function(e){t.ViewEventsController.handleEvent(e,this)},_onFocus:function(){this.set("isFocussed",!0)}.on("focus"),_onBlur:function(){this.set("isFocussed",!1)}.on("blur"),blurOnEsc:function(t){27===(t.keyCode||t.which)&&this.blur()}.on("keydown"),dropAcceptedDataTypes:{"image/gif":!0,"image/jpeg":!0,"image/png":!0,"image/tiff":!0},dropEffect:t.DragEffect.COPY,drop:function(t){var e,i=this.get("dropAcceptedDataTypes");for(e in i)if(t.hasDataType(e)){this.insertImagesFromFiles(t.getFiles(/^image\/.*/));break}}});c.isSupported="contentEditable"in document.body&&!t.UA.operaMobile&&(!t.UA.msie||t.UA.msie>8)&&(!t.UA.isIOS||!!window.indexedDB),t.RichTextView=c}(O),function(t,e){var i="placeholder"in document.createElement("input"),n=t.Class({Extends:t.AbstractControlView,init:function(t){n.parent.init.call(this,t),this._settingFromInput=!1},isMultiline:!1,isExpanding:!1,isValid:!0,isHighlighted:!1,inputType:"text",placeholder:"",value:"",inputAttributes:{autocomplete:"off"},selection:function(t){var i=this._domControl,n="number"==typeof t,s=t?n?t:t.start:0,r=t?n?t:t.end||s:s;if(t!==e){this.redraw();try{i.setSelectionRange(s,r)}catch(o){}}else try{s=i.selectionStart,r=i.selectionEnd}catch(o){}return t||{start:s,end:r}}.property().nocache(),blurOnEscape:!0,allowTextSelection:!0,type:"",className:function(){var t=this.get("type");return"v-Text"+(this.get("isHighlighted")?" is-highlighted":"")+(this.get("isFocussed")?" is-focussed":"")+(this.get("isValid")?"":" is-invalid")+(this.get("isDisabled")?" is-disabled":"")+(t?" "+t:"")}.property("type","isHighlighted","isFocussed","isValid","isDisabled"),layerStyles:function(){return t.extend({position:this.get("positioning"),display:this.get("isMultiline")?"block":"inline-block",cursor:"text",userSelect:"text"},this.get("layout"))}.property("layout","positioning"),draw:function(n,s,r){var o=this.get("value"),a=this.get("placeholder"),h=this.get("isMultiline"),c=this._domControl=r(h?"textarea":"input",{id:this.get("id")+"-input",className:"v-Text-input",rows:h?"1":e,name:this.get("name"),type:this.get("inputType"),disabled:this.get("isDisabled"),tabIndex:this.get("tabIndex"),value:o});return this.redrawInputAttributes(),a&&(i?c.placeholder=a:o||(this._placeholderShowing=!0,t.Element.addClass(c,"v-Text-input--placeholder"),c.value=a)),n.title=this.get("tooltip"),[this._domLabel=r("span",[this.get("label")]),c]},textNeedsRedraw:function(t,e,i){var n="value"===e;n&&this._settingFromInput||this.propertyNeedsRedraw(t,e,i),n&&this.get("isExpanding")&&this.propertyNeedsRedraw(t,"textHeight",i)}.observes("value","placeholder","inputAttributes"),redrawValue:function(){var t=this.get("value");this._domControl.value=t,i||this.get("isFocussed")||this._setPlaceholder()},redrawPlaceholder:function(){var t=this.get("placeholder"),e=this._domControl;i?e.placeholder=t:this._placeholderShowing&&(e.value=t)},redrawInputAttributes:function(){var t,e=this.get("inputAttributes"),i=this._domControl;for(t in e)i.set(t,e[t])},redrawTextHeight:function(){var e,i=this._domControl,n=i.style,s=this.getParent(t.ScrollView);
n.height="auto",e=i.scrollHeight,e&&(n.height=e+"px"),s&&s.redrawScroll()},activate:function(){this.focus()},savedSelection:null,didEnterDocument:function(){if(n.parent.didEnterDocument.call(this),this.get("isExpanding")&&this.redrawTextHeight(),this.get("isMultiline")){var t=this._domControl,e=this.get("scrollLeft"),i=this.get("scrollTop");e&&(t.scrollLeft=e),i&&(t.scrollTop=i),t.addEventListener("scroll",this,!1)}var s=this.get("savedSelection");return s&&this.set("selection",s).focus(),this},willLeaveDocument:function(){return this.get("isFocussed")&&(this.set("savedSelection",this.get("selection")),this.blur()),this.get("isMultiline")&&this._domControl.removeEventListener("scroll",this,!1),n.parent.willLeaveDocument.call(this)},_syncBackScrolls:function(t){var e=this._domControl,i=e.scrollLeft,n=e.scrollTop;this.beginPropertyChanges().set("scrollLeft",i).set("scrollTop",n).endPropertyChanges(),t.stopPropagation()}.on("scroll"),syncBackValue:function(){this._settingFromInput=!0,(i||!this._placeholderShowing)&&this.set("value",this._domControl.value),this._settingFromInput=!1}.on("input"),_setPlaceholder:i?null:function(e,i,n,s){var r,o=this._domControl;s?this._placeholderShowing&&(this._placeholderShowing=!1,t.Element.removeClass(o,"v-Text-input--placeholder"),o.value=""):(r=this.get("placeholder"),r&&!this.get("value")&&(this._placeholderShowing=!0,t.Element.addClass(o,"v-Text-input--placeholder"),o.value=r))}.observes("isFocussed"),_onClick:function(t){t.target===this.get("layer")&&this.set("selection",this.get("value").length).focus()}.on("click"),_onKeypress:function(t){var e=t.keyCode||t.which;13!==e||this.get("isMultiline")||t.preventDefault()}.on("keypress"),_blurOnEsc:function(t){var e=t.keyCode||t.which;27===e&&this.get("blurOnEscape")&&this.blur()}.on("keydown")});8<=t.UA.msie&&t.UA.msie<=9&&n.implement({_ieSyncBackValue:function(e){var i="cut"===e.type?"delete":t.DOMEvent.lookupKey(e);(8===t.UA.msie||"backspace"===i||"delete"===i)&&this.fire("input")}.on("keyup","cut")}),t.TextView=n}(O),function(t){var e=t.Class({Extends:t.TextView,type:"v-SearchText",draw:function(i,n,s){var r=e.parent.draw.call(this,i,n,s);return r.push(s("i.icon.icon-search"),new t.ButtonView({type:t.bind(this,"value",function(t){return t?"v-SearchText-reset v-Button--iconOnly":"u-hidden"}),icon:"icon-clear",positioning:"absolute",label:t.loc("Clear Search"),shortcut:"ctrl-/",target:this,method:"reset"})),r},reset:function(){this.set("value","").blur()}});t.SearchTextView=e}(O),function(t){var e=t.Class({Extends:t.AbstractControlView,options:[],type:"",className:function(){var t=this.get("type");return"v-Select"+(this.get("isFocussed")?" is-focussed":"")+(this.get("isDisabled")?" is-disabled":"")+(t?" "+t:"")}.property("type","isFocussed","isDisabled"),draw:function(t,i,n){var s=this._domControl=this._drawSelect(this.get("options"));return[e.parent.draw.call(this,t,i,n),s]},_drawSelect:function(e){var i=this.get("value"),n=t.Element.create,s=n("select",{className:"v-Select-input",disabled:this.get("isDisabled")},e.map(function(t,e){return n("option",{text:t.text,value:e,selected:t.value===i,disabled:!!t.isDisabled})}));return s},selectNeedsRedraw:function(t,e,i){return this.propertyNeedsRedraw(t,e,i)}.observes("options","value"),redrawOptions:function(e,i){var n,s=this.get("options");t.isEqual(s,i)||(n=this._drawSelect(s),e.replaceChild(n,this._domControl),this._domControl=n)},redrawValue:function(){for(var t=this.get("value"),e=this.get("options"),i=e.length;i--;)if(e[i].value===t)return void(this._domControl.value=i+"");this.get("isFocussed")&&this.blur().focus()},syncBackValue:function(){var t=this._domControl.selectedIndex;this.set("value",this.get("options").getObjectAt(t).value)}.on("change")});t.SelectView=e}(O),function(t){var e=t.Class({Extends:t.View,content:null,index:0,itemHeight:32,selection:null,isSelected:!1,animateIn:!1,init:function(t){var i=t.selection,n=t.content;i&&n&&(this.isSelected=i.isIdSelected(n.get("id"))),e.parent.init.call(this,t)},positioning:"absolute",layout:(t.UA.cssProps.transform3d?function(){var t=this.get("index"),e=this.get("itemHeight"),i=this.get("animateIn")&&!this.get("isInDocument"),n=(t-(i?1:0))*e;return{transform:"translate3d(0,"+n+"px,0)",opacity:i?0:1}}:function(){var t=this.get("index"),e=this.get("itemHeight");return{top:t*e}}).property("index","itemHeight"),resetLayout:function(){this.get("animateIn")&&this.computedPropertyDidChange("layout")}.nextFrame().observes("isInDocument")});t.ListItemView=e}(O),function(t,e){var i=t.Class({Extends:t.View,selection:null,singleSelection:null,index:t.bind("singleSelection*index"),record:t.bind("singleSelection*record"),itemHeight:32,keys:{j:"goNext",k:"goPrev",x:"select","shift-x":"select",o:"trigger",enter:"trigger",s:"star"},className:"v-ListKBFocus",positioning:"absolute",layout:function(){var t=this.get("itemHeight"),e=this.get("index"),i=this.get("singleSelection"),n=i.get("content");return e>-1&&n&&n.getObjectAt(e)!==this.get("record")&&(e=-1),{top:t*e,height:0>e?0:t}}.property("itemHeight","index","record"),didEnterDocument:function(){var e,n=this.get("keys"),s=t.ViewEventsController.kbShortcuts;for(e in n)s.register(e,this,n[e]);return this.checkInitialScroll(),i.parent.didEnterDocument.call(this)},willLeaveDocument:function(){var e,n=this.get("keys"),s=t.ViewEventsController.kbShortcuts;for(e in n)s.deregister(e,this,n[e]);return i.parent.willLeaveDocument.call(this)},checkInitialScroll:function(){this.get("distanceFromVisRect")&&this.scrollIntoView(0,!1)}.queue("after"),checkScroll:function(){var t=this.get("distanceFromVisRect");t&&this.scrollIntoView(0>t?-.6:.6,!0)}.queue("after"),distanceFromVisRect:function(){var e=this.getParent(t.ScrollView);if(e){var i=e.get("scrollTop"),n=this.get("layout"),s=n.top,r=s-i;if(0>r)return r;var o=e.get("pxHeight"),a=s+n.height-i-o;if(a>0)return a}return 0}.property().nocache(),scrollIntoView:function(e,i){var n=this.getParent(t.ScrollView);if(n){var s=n.get("pxHeight"),r=this.get("layout"),o=r.height,a=r.top;e&&e>=-1&&1>=e&&(e=e*(s-o)>>1),n.scrollTo(0,Math.max(0,a+(o-s>>1)+(e||0)),i)}},go:function(t){var e=this.get("index"),i=this.get("singleSelection"),n=i.get("content"),s=n&&n.get("length")||0;1===t&&e>-1&&n&&n.getObjectAt(e)!==this.get("record")&&(t=0),t?i.set("index",(e+t).limit(0,s-1)):i.propertyDidChange("index"),this.get("isInDocument")&&this.checkScroll()},goNext:function(){this.go(1)},goPrev:function(){this.go(-1)},select:function(t){var e=this.get("index"),i=this.get("selection"),n=this.get("record");i&&n&&i.selectIndex(e,!i.isIdSelected(n.get("id")),t.shiftKey)},trigger:function(){},star:function(){}});t.ListKBFocusView=i}(O),function(t){var e=function(t,e){return t.get("index")-e.get("index")},i=function(t,e){var i,n;for(i=0,n=t.length;n>i;i+=1)e[t[i]]=!0;return e},n=t.Class({Extends:t.View,content:null,contentLength:t.bind("content.length"),renderInOrder:!0,ItemView:null,itemHeight:0,init:function(t){this._added=null,this._removed=null,this._rendered={},this._renderRange={start:0,end:2147483647},this.selection=null,n.parent.init.call(this,t);var e=this.get("selection");e&&e.set("view",this)},destroy:function(){if(this.get("isRendered")){var t=this.get("content");t&&(t.removeObserverForRange(this._renderRange,this,"_redraw"),t.off("query:updated",this,"contentWasUpdated"))}n.parent.destroy.call(this)},contentDidChange:function(t,e,i,n){if(this.get("isRendered")){var s=this._renderRange;i&&(i.removeObserverForRange(s,this,"_redraw"),i.off("query:updated",this,"contentWasUpdated")),n&&(n.addObserverForRange(s,this,"_redraw"),n.on("query:updated",this,"contentWasUpdated")),this._redraw()}}.observes("content"),contentWasUpdated:function(t){this.get("isInDocument")&&(this._added=i(t.added,this._added||{}),this._removed=i(t.removed,this._removed||{}))},layout:function(){var t=this.get("itemHeight");return t?{height:t*(this.get("contentLength")||0)}:{}}.property("itemHeight","contentLength"),draw:function(t,e){var i=n.parent.draw.call(this,t),s=this.get("content");i&&e.appendChildren(t,i),s&&(s.addObserverForRange(this._renderRange,this,"_redraw"),s.on("query:updated",this,"contentWasUpdated"),this.redrawLayer(t))},_redraw:function(){this.propertyNeedsRedraw(this,"layer")},isCorrectItemView:function(t,e){return t.get("content")===e},createItemView:function(t,e,i,n){var s=this.get("ItemView");return new s({parentView:this,content:t,index:e,list:i,isAdded:n,selection:this.get("selection")})},destroyItemView:function(t){t.destroy()},calculateDirtyRange:function(t,e,i){for(var n,s,r=null,o=this.get("childViews"),a=o.length;i&&a&&(n=o[a-1],s=t.getObjectAt(i-1),this.isCorrectItemView(n,s,i-1));)r=n,a-=1,i-=1;for(;i>e&&a>e&&(n=o[e],s=t.getObjectAt(e),this.isCorrectItemView(n,s,e));)e+=1;return[e,i,r]},redrawLayer:function(i){var n,s,r,o,a,h,c,u,l,d,f,g,p=this.get("content")||[],v=this.get("childViews"),m=this._renderRange,y=this.get("renderInOrder"),w=Math.max(0,m.start),_=Math.min(p.get("length"),m.end),b=null,T=this._rendered,D={},S=[],C=this._added,O=this._removed,x=this.get("isInDocument"),k=i.ownerDocument.createDocumentFragment();for(y&&(n=this.calculateDirtyRange(p,w,_),s=n[0],r=n[1],b=n[2]),o=w,a=_;a>o;o+=1)h=p.getObjectAt(o),c=h?t.guid(h):"null:"+o,u=T[c],u&&this.isCorrectItemView(u,h,o)&&(D[c]=u);for(this.beginPropertyChanges(),g=Object.keys(T),o=0,a=g.length;a>o;o+=1)c=g[o],u=T[c],D[c]||(d=O&&(h=u.get("content"))?O[h.get("id")]:!1,u.detach(d),this.destroyItemView(u));for(this._rendered=D,o=w,a=_;a>o;o+=1)h=p.getObjectAt(o),c=h?t.guid(h):"null:"+o,u=D[c],u?(f=y&&o>=s&&r>o,f&&(x&&u.willLeaveDocument(),i.removeChild(u.get("layer")),x&&u.didLeaveDocument()),u.set("index",o).set("list",p)):(l=C&&h?C[h.get("id")]:!1,u=this.createItemView(h,o,p,l),u&&(D[c]=u,v.include(u)),f=!!u&&!u.get("isInDocument")),f&&(k.appendChild(u.render().get("layer")),x&&u.willEnterDocument(),S.push(u));if(S.length&&(b?i.insertBefore(k,b.get("layer")):i.appendChild(k),x))for(o=0,a=S.length;a>o;o+=1)S[o].didEnterDocument();y&&v.sort(e),this._added=null,this._removed=null,this.propertyDidChange("childViews"),this.endPropertyChanges()},insertView:null,replaceView:null});t.ListView=n}(O),function(t){t.TrueVisibleRect={visibleRect:function(){if(!this.get("isInDocument"))return{x:0,y:0,width:0,height:0};var t=this.get("pxLeft"),e=this.get("pxTop"),i=this.get("pxWidth"),n=this.get("pxHeight"),s=this.get("parentView").get("visibleRect"),r=Math.max(t,s.x),o=Math.min(t+i,s.x+s.width),a=Math.max(e,s.y),h=Math.min(e+n,s.y+s.height),c=Math.max(o-r,0),u=Math.max(h-a,0);return{x:r-t+this.get("scrollLeft"),y:a-e+this.get("scrollTop"),width:c,height:u}}.property("scrollTop","scrollLeft","pxLayout","parentView.visibleRect","isInDocument")}}(O),function(t){var e=t.Class({Extends:t.ListView,Mixin:t.TrueVisibleRect,renderInOrder:!1,batchSize:10,triggerInPx:200,init:function(t){e.parent.init.call(this,t),this._renderRange.end=0},contentWasUpdated:function(i){var n=this.getParent(t.ScrollView);if(n){var s,r,o,a,h=this.get("itemHeight"),c=Math.max(this.get("visibleRect").y,0),u=~~(c/h),l=i.removedIndexes,d=i.addedIndexes,f=this._rendered,g=0;if(u>2){for(s=0,r=l.length;r>s&&l[s]<u;s+=1)g-=1;for(u+=g,s=0,r=d.length;r>s&&d[s]<=u;s+=1)g+=1}if(g){for(o in f)a=f[o],a.set("animateLayer",!1).set("index",a.get("index")+g).redraw().set("animateLayer",!0);n.scrollBy(0,g*h),n.redraw()}}return e.parent.contentWasUpdated.call(this,i)},_simulateScroll:function(e,i,n,s){s||(s=0),n>s&&t.RunLoop.invokeInNextEventLoop(this.fire.bind(this,"scroll",null,null))}.observes("contentLength"),visibleRectDidChange:function(){if(this.get("isInDocument")){var t=this.get("visibleRect"),e=this.get("triggerInPx"),i=this.get("batchSize"),n=this.get("itemHeight")*i,s=t.y,r=Math.max(0,~~((s-e)/n)*i),o=~~((s+t.height+e)/n)*i+i,a=this._renderRange;(r!==a.start||o!==a.end)&&(a.start=r,a.end=o,this._redraw())}}.queue("middle").observes("visibleRect","itemHeight")});t.ProgressiveListView=e}(O),function(t){var e=t.View,i=t.Element,n=function(t,i,n){for(var s,r=t?t.length:0;r--;)s=t[r],s instanceof e&&!s.isDestroyed&&(n?s[i].apply(s,n):s[i]())},s=function(t,e){return e instanceof Array?e.reduce(s,t):e&&t.push(e),t},r=t.Class({Extends:e,init:function(t){this._oldView=null,this._index=-1,this.index=0,this.views=[],this.subViews=[],r.parent.init.call(this,t),this.isRendered=!0;for(var e,i=this.get("views"),n=i.length;n--;)e=i[n],!e||e instanceof Array||(i[n]=[e])},destroy:function(){for(var t=this.get("views"),e=t.length;e--;)n(t[e],"destroy");for(t=this.get("subViews"),e=t.length;e--;)n(t[e],"destroy");r.parent.destroy.call(this)},layer:function(){return document.createComment("SwitchView "+this.get("id"))}.property(),willEnterDocument:function(){return this.resumeBindings(),this.redraw(),this},didEnterDocument:function(){return this.get("index")!==this._index&&this.switchNeedsRedraw(),this.set("isInDocument",!0)},willLeaveDocument:function(){return this.set("isInDocument",!1)},didLeaveDocument:function(){return this.suspendBindings()},redraw:function(){var t,e=this._index,i=this.get("index");!this.isDestroyed&&e>-1&&e!==i&&(t=this.get("parentView"),t&&(this._remove(t),this._add()))},switchNeedsRedraw:function(){this.get("isInDocument")&&t.RunLoop.queueFn("render",this.redraw,this)}.observes("index"),parentViewDidChange:function(t,e,i,n){i&&(i.removeObserverForKey("childViews",this,"_add"),this._remove(i)),n&&(n.get("isRendered")&&!this.get("layer").parentNode?n.addObserverForKey("childViews",this,"_add"):this._add())}.observes("parentView"),_add:function(){var t,i,s,r=this.get("index"),o=this.get("views")[r],a=this.get("subViews")[r],h=this.get("parentView"),c=h.get("isInDocument"),u=this.get("layer"),l=u.parentNode;if(h.removeObserverForKey("childViews",this,"_add"),-1===this._index){for(this._index=r,a&&(n(a,"set",["parentView",h]),c&&n(a,"willEnterDocument")),t=o?o.length:0;t--;)i=o[t],i instanceof e?h.insertView(i,this,"after"):("object"!=typeof i&&(i=o[t]=document.createTextNode(i)),s=u.nextSibling,s?l.insertBefore(i,s):l.appendChild(i));a&&(c&&n(a,"didEnterDocument"),Array.prototype.push.apply(h.get("childViews"),a),h.propertyDidChange("childViews"))}},_remove:function(t){var i,s,r,o,a,h,c=this._index,u=this.get("views")[c],l=this.get("subViews")[c],d=t.get("isInDocument");for(d&&l&&n(l,"willLeaveDocument"),i=u?u.length:0;i--;)s=u[i],s instanceof e?t.removeView(s):s.parentNode.removeChild(s);if(l){for(d&&n(l,"didLeaveDocument"),n(l,"set",["parentView",null]),r=t.get("childViews"),i=l.length;i--;)if(o=l[i],a=r.lastIndexOf(o),h=1,a>-1){for(;i>0&&a>0&&l[i-1]===r[a-1];)i-=1,a-=1,h+=1;r.splice(a,h)}t.propertyDidChange("childViews")}this._index=-1},insertView:function(t,e){this.childViews.push(t);var i=t.get("parentView");return i&&i.removeView(t),e.appendChild(t.render().get("layer")),this},_addCondition:function(t,e){t=t?t instanceof Array?t:[t]:null,this.views[e]=t&&t.reduce(s,[]);var i=this.childViews;return i.length&&(this.subViews[e]=i,this.childViews=[]),this},show:function(t){return this._addCondition(t,0)},otherwise:function(t){return this._addCondition(t,1)},end:function(){return i.forView(this._oldView),this._oldView=null,this}});t.SwitchView=r;var o=function(t){return t?0:1},a=function(t){return t?1:0},h=function(e,n,s){var o=new r({index:t.bind(e,n,s)});return o._oldView=i.forView(o),o};i.when=function(t,e,i){var n=i?function(t,e){return o(i(t,e))}:o;return h(t,e,n)},i.unless=function(t,e,i){var n=i?function(t,e){return a(i(t,e))}:a;return h(t,e,n)}}(O),function(t){var e=function(e){return"-"===e?t.Element.create("span.v-Toolbar-divider"):this._views[e]},i=t.Class({Extends:t.MenuButtonView,didEnterDocument:function(){return i.parent.didEnterDocument.call(this),this.setShortcuts(null,"",{},this.get("shortcuts")),this},willLeaveDocument:function(){return this.setShortcuts(null,"",this.get("shortcuts"),{}),i.parent.willLeaveDocument.call(this)},shortcuts:function(){var t=this.getFromPath("menuView.options");return t?t.reduce(function(t,e){var i=e.get("shortcut");return i&&i.split(" ").forEach(function(i){t[i]=e}),t},{}):{}}.property("menuView"),setShortcuts:function(e,i,n,s){if(this.get("isInDocument")){var r,o=t.ViewEventsController.kbShortcuts;s||(s=this.get("shortcuts"));for(r in n)o.deregister(r,this,"activateButton");for(r in s)o.register(r,this,"activateButton")}}.observes("shortcuts"),activateButton:function(e){var i=t.DOMEvent.lookupKey(e),n=this.get("shortcuts")[i];n instanceof t.MenuButtonView&&this.activate(),n.activate()}}),n=t.Class({Extends:t.View,className:"v-Toolbar",config:"standard",minimumGap:20,preventOverlap:!1,init:function(e){n.parent.init.call(this,e),this._views={overflow:new i({label:t.loc("More"),popOverView:e.popOverView||new t.PopOverView})},this._configs={standard:{left:[],right:[]}},this._measureView=null,this._widths={}},registerView:function(t,e,i){return this._views[t]=e,!i&&this.get("isInDocument")&&this.get("preventOverlap")&&this.preMeasure().postMeasure(),this},registerViews:function(t){for(var e in t)this.registerView(e,t[e],!0);return this.get("isInDocument")&&this.get("preventOverlap")&&this.preMeasure().postMeasure(),this},registerConfig:function(t,e){return this._configs[t]=e,this.get("config")===t&&this.computedPropertyDidChange("config"),this},registerConfigs:function(t){for(var e in t)this.registerConfig(e,t[e]);return this},getView:function(t){return this._views[t]},leftConfig:function(){var t=this._configs,e=t[this.get("config")];return e&&e.left||t.standard.left}.property("config"),rightConfig:function(){var t=this._configs,e=t[this.get("config")];return e&&e.right||t.standard.right}.property("config"),left:function(){var i,n,s=this.get("leftConfig"),r=this.get("rightConfig"),o=this.get("pxWidth"),a=this._widths;if(a&&o&&this.get("preventOverlap")){for(o-=this.get("minimumGap"),i=0,n=r.length;n>i;i+=1)o-=a[r[i]];for(i=0,n=s.length;n>i;i+=1)o-=a[s[i]];if(0>o){for(o-=a["-"],o-=a.overflow;0>o&&n--;)o+=a[s[n]];0>n&&(n=0),this._views.overflow.set("menuView",new t.MenuView({showFilter:!1,options:s.slice(n).map(e,this).filter(function(e){return e instanceof t.View})})),n>0?("-"===s[n-1]&&(n-=1),s=s.slice(0,n),s.push("-"),s.push("overflow")):(s=["overflow"],n=0)}}return s.map(e,this)}.property("leftConfig","rightConfig","pxWidth"),right:function(){return this.get("rightConfig").map(e,this)}.property("rightConfig"),preMeasure:function(){return this.insertView(this._measureView=new t.View({className:"v-Toolbar-section v-Toolbar-section--measure",layerStyles:{},childViews:Object.values(this._views).filter(function(t){return!t.get("parentView")}),draw:function(e,i,n){return[n("span.v-Toolbar-divider"),t.View.prototype.draw.call(this,e,i,n)]}}),this.get("layer").lastChild,"before"),this},postMeasure:function(){var t,e,i=this._widths,n=this._views,s=this._measureView,r=s.get("childViews"),o=s.get("layer"),a=o.getBoundingClientRect(),h=r.length?r[0].get("layer"):null;for(t in n)i[t]=n[t].get("pxWidth")||i[t];for(i["-"]=(h?h.getBoundingClientRect().left:a.right)-a.left,this.removeView(s),e=r.length;e--;)s.removeView(r[e]);return s.destroy(),this._measureView=null,this},willEnterDocument:function(){return this.get("preventOverlap")&&this.preMeasure(),n.parent.willEnterDocument.call(this)},didEnterDocument:function(){return this.beginPropertyChanges(),n.parent.didEnterDocument.call(this),this.get("preventOverlap")&&this.postMeasure(),this.endPropertyChanges(),this},draw:function(t,e,i){return[i("div.v-Toolbar-section.v-Toolbar-section--left",this.get("left")),i("div.v-Toolbar-section.v-Toolbar-section--right",this.get("right"))]},toolbarNeedsRedraw:function(t,e,i){return this.propertyNeedsRedraw(t,e,i)}.observes("left","right"),redrawLeft:function(t,e){this.redrawSide(t.firstChild,e,this.get("left"))},redrawRight:function(t,e){this.redrawSide(t.lastChild,e,this.get("right"))},redrawSide:function(e,i,n){var s,r,o,a,h=t.View,c=0,u=!0;for(s=c,r=i.length;r>s;s+=1)o=i[s],o instanceof h?u&&o===n[s]?c+=1:(u=!1,o.get("layer").parentNode===e&&this.removeView(o)):!u||n[s]instanceof h?e.removeChild(o):(c+=1,n[s]=o);for(s=c,r=n.length;r>s;s+=1)o=n[s],o instanceof h?((a=o.get("parentView"))&&a.removeView(o),this.insertView(o,e)):e.appendChild(o)}});t.ToolbarView=n}(O),function(t){var e=t.Class({Extends:t.Animation,duration:250,prepare:function(t){var e=this.object,i=this.startX=e.get("scrollLeft"),n=this.startY=e.get("scrollTop"),s=this.endX=t.x||0,r=this.endY=t.y||0,o=this.deltaX=s-i,a=this.deltaY=r-n;return!(!o&&!a)},drawFrame:function(t){var e=1>t?this.startX+t*this.deltaX:this.endX,i=1>t?this.startY+t*this.deltaY:this.endY;this.object._scrollTo(e,i)}}),i=t.Class({Extends:t.View,showScrollbarX:!1,showScrollbarY:!0,positioning:"absolute",layout:t.View.LAYOUT_FILL_PARENT,layerStyles:function(){var e=t.View.prototype.layerStyles.call(this);return e.overflowX=this.get("showScrollbarX")?"auto":"hidden",e.overflowY=this.get("showScrollbarY")?"auto":"hidden",e.WebkitOverflowScrolling="touch",e}.property("layout","allowTextSelection","positioning","showScrollbarX","showScrollbarY"),keys:{},didCreateLayer:function(t){this.scrollLayer=t},didEnterDocument:function(){this.get("scrollLayer").addEventListener("scroll",this,!1);var e,n=this.get("keys"),s=t.ViewEventsController.kbShortcuts;for(e in n)s.register(e,this,n[e]);return i.parent.didEnterDocument.call(this)},willLeaveDocument:function(){var e,n=this.get("keys"),s=t.ViewEventsController.kbShortcuts;for(e in n)s.deregister(e,this,n[e]);return this.get("scrollLayer").removeEventListener("scroll",this,!1),i.parent.willLeaveDocument.call(this)},_restoreScroll:function(){if(this.get("isInDocument")){var t=this.get("scrollLayer");t.scrollLeft=this.get("scrollLeft"),t.scrollTop=this.get("scrollTop")}}.queue("render").observes("isInDocument"),scrollAnimation:function(){return new e({object:this})}.property(),scrollPage:function(){return this.scrollBy(0,this.get("pxHeight")-50,!0)},reverseScrollPage:function(){return this.scrollBy(0,50-this.get("pxHeight"),!0)},scrollLine:function(){return this.scrollBy(0,40)},reverseScrollLine:function(){return this.scrollBy(0,-40)},scrollBy:function(t,e,i){var n=this.get("scrollLeft"),s=this.get("scrollTop");return t+=n,e+=s,this.scrollTo(t,e,i),s!==this.get("scrollTop")||n!==this.get("scrollLeft")},scrollToView:function(t,e,i){var n=t.getPositionRelativeTo(this);return this.scrollTo(n.left+(e&&e.x||0),n.top+(e&&e.y||0),i)},scrollTo:function(t,e,i){0>t&&(t=0),0>e&&(e=0);var n=this.get("scrollAnimation");return n.stop(),i?n.animate({x:t,y:e}):this.beginPropertyChanges().set("scrollLeft",t).set("scrollTop",e).propertyNeedsRedraw(this,"scroll").endPropertyChanges(),this},_scrollTo:function(t,e){this.set("scrollLeft",t).set("scrollTop",e),this.redrawScroll()},redrawScroll:function(){var e=this.get("scrollLayer"),i=this.get("scrollLeft"),n=this.get("scrollTop");e.scrollLeft=i,e.scrollTop=n,(i||n)&&t.RunLoop.queueFn("after",this.syncBackScroll,this)},syncBackScroll:function(e){if(!this._needsRedraw){var i=this.get("scrollLayer"),n=i.scrollLeft,s=i.scrollTop;this.beginPropertyChanges().set("scrollLeft",n).set("scrollTop",s).endPropertyChanges(),e&&(e.stopPropagation(),t.Tap&&t.Tap.cancel())}}.on("scroll")});t.UA.isIOS&&i.implement({isFixedDimensions:function(){var t=this.get("positioning");return"absolute"===t||"fixed"===t}.property("positioning"),draw:function(e,n,s){var r,o=this.get("isFixedDimensions"),a=1,h=null,c=t.UA.safari;r=i.parent.draw.call(this,e,n,s),c>0&&8>c&&(h=this.scrollLayer=s("div",{style:"position:relative;height:100%;-webkit-overflow-scrolling:touch;overflow-x:"+(this.get("showScrollbarX")?"auto;":"hidden;")+"overflow-y:"+(this.get("showScrollbarY")?"auto;":"hidden;")}),e.appendChild(h),e=h),c>=8&&(a=2,e.appendChild(s("div",{style:"height:1px"})),this.on("scroll",this,"_setNotAtEnd").addObserverForKey("isInDocument",this,"_setNotAtEnd")),n.appendChildren(e,r),o&&e.appendChild(s("div",{style:"position:absolute;top:100%;left:0px;width:1px;height:"+a+"px;"}))},_setNotAtEnd:function(){if(this.get("isInDocument")){var t=this.get("scrollTop"),e=this.get("scrollLeft");t?t+this.get("pxHeight")===this.get("layer").scrollHeight&&this.scrollTo(e,t-1):this.scrollTo(e,1)}}.queue("after"),preventRootScroll:function(t){if(!this.get("isFixedDimensions")){var e=this.get("layer");e.scrollHeight<=e.offsetHeight&&t.preventDefault()}}.on("touchmove"),insertView:function(e,n,s){return!n&&this.get("isRendered")&&(n=this.scrollLayer,"top"===s?t.UA.safari>=8&&(n=n.firstChild,s="after"):"bottom"===s&&this.get("isFixedDimensions")&&(n=n.lastChild,s="before")),i.parent.insertView.call(this,e,n,s)}}),t.ScrollView=i}(O),function(t){var e=1,i=2,n=4,s=8,r="auto",o=t.Class({Extends:t.Object,direction:e,flex:n,staticPaneLength:200,minStaticPaneLength:0,maxStaticPaneLength:32767,topLeftLayout:function(t){var s=this.get("direction"),o=this.get("flex"),a=this.get("staticPaneLength");return t||{top:0,left:0,right:s===e&&o===n?a:r,width:s===i?"100%":o===n?r:a,bottom:s===i&&o===n?a:r,height:s===e?"100%":o===n?r:a}}.property("flex","direction","staticPaneLength"),bottomRightLayout:function(t){var n=this.get("direction"),o=this.get("flex"),a=this.get("staticPaneLength");return t||{bottom:0,right:0,left:n===e&&o===s?a:r,width:n===i?"100%":o===s?r:a,top:n===i&&o===s?a:r,height:n===e?"100%":o===s?r:a}}.property("flex","direction","staticPaneLength")});o.extend({VERTICAL:e,HORIZONTAL:i,TOP_LEFT:n,BOTTOM_RIGHT:s}),t.SplitViewController=o}(O),function(t){var e=t.SplitViewController.VERTICAL,i=t.Class({Extends:t.View,Mixin:t.Draggable,className:"v-SplitDivider",thickness:10,offset:t.bindTwoWay("controller.staticPaneLength"),min:t.bind("controller.minStaticPaneLength"),max:t.bind("controller.maxStaticPaneLength"),direction:t.bind("controller.direction"),flex:t.bind("controller.flex"),anchor:function(){var i=this.get("flex")===t.SplitViewController.TOP_LEFT,n=this.get("direction")===e;return n?i?"right":"left":i?"bottom":"top"}.property("flex","direction"),positioning:"absolute",layout:function(){var t,i=this.get("thickness");return t=this.get("direction")===e?{top:0,bottom:0,width:i}:{left:0,right:0,height:i},t[this.get("anchor")]=this.get("offset")-i/2,t}.property("direction","anchor","thickness","offset"),dragStarted:function(){this._offset=this.get("offset"),this._dir=this.get("direction")===e?"x":"y"},dragMoved:function(t){var e=this._dir,i=t.get("cursorPosition")[e]-t.get("startPosition")[e];this.set("offset",(this._offset+i).limit(this.get("min"),this.get("max")))}});t.SplitDividerView=i}(O);
